/*
// BEGIN__HARVEST_EXCEPTION_ZSTRING
<javascriptresource>
<name>[ss] einsa Portfoilo Workflow</name>
<about>um die Portfoilo-Bilder umzufärben | By Simon Adrian | https://www.SimonAdrian.de</about>
<category>SimonScript</category>
</javascriptresource>
// END__HARVEST_EXCEPTION_ZSTRING
*/

run();

function run() {
    if (!app.documents.length > 0) {
        alert("Abbruch!\nkein Dokument geöffnet");
        return;
    }
    if (!app.selection.length > 0) {
        alert("Abbruch!\nWähle das zubearbeitende Bild aus");
        return;
    }

    var doc_ID = app.activeDocument;
    var doc_IDPath = doc_ID.filePath;

    var subFolder = "RGB";
    var saveFolder = new Folder(doc_IDPath + "/" + subFolder);
    if (!saveFolder.exists) saveFolder.create();


    for (var i = 0; i < app.selection.length; i++) {
        if (app.selection[i] instanceof Image && app.selection[i].parent.graphics.length > 0) {
            var selection = app.selection[i].parent;
        } else {
            var selection = app.selection[i];
        }

        var imageLink = selection.graphics[0].itemLink;
        var imagePath = imageLink.filePath;
        var imageName_only = GetFileNameOnly(decodeURI(imageLink.name));

        if (imageName_only.match("__RGB")) {
            var alreadyRGB = "yes";
        } else {
            var alreadyRGB = "no";
        }

        var file_RGB = saveFolder + "/" + imageName_only + "__RGB.psd";

        var color_array = [];
        if (selection.hasOwnProperty('fillColor')) {
            swatch = selection.fillColor;
            if (swatch instanceof Color && swatch.space == ColorSpace.RGB) {
                var color = swatch.colorValue.join(',');
                var color_array = color.split(',');
            }
            else {
                var color_array = [127, 127, 127];
            }
        }


        // selection.fillColor = "None";


        runID(imagePath, imageLink, file_RGB, saveFolder, color_array, alreadyRGB)


    }



}

function GetFileNameOnly(_fileName) {
    var myString = "";
    var myResult = _fileName.lastIndexOf(".");
    if (myResult == -1) {
        myString = _fileName;
    } else {
        myString = _fileName.substr(0, myResult);
    }
    return myString
}


function runID(_imagePath, _imageLink, _file_RGB, _saveFolder, _color_array, _alreadyRGB) {
    // alert("check" +
    //     "\n_imagePath: " + _imagePath +
    //     "\n_file_RGB: " + _file_RGB +
    //     "\n_alreadyRGB: " + _alreadyRGB
    // )
    // $.writeln("_saveFolder: " + _saveFolder);

    BridgeTalk_runPS(_imagePath, _file_RGB, _saveFolder, _color_array, _alreadyRGB);
    Relink(_imageLink, _file_RGB);

}

function BridgeTalk_runPS(_imagePath, _file_RGB, _saveFolder, _color_array, _alreadyRGB) {
    var bt = new BridgeTalk();
    bt.target = 'photoshop';
    bt.body = runPS.toSource() + "('" + _imagePath + "','" + _file_RGB + "','" + _saveFolder + "','" + _color_array + "','" + _alreadyRGB + "');";
    bt.onResult = function (resObj) { };
    bt.send(30);
}

function Relink(_imageLink, _file_RGB) {
    var newFile = new File(_file_RGB);
    if (newFile.exists) {
        var originalLinkFile = new File(_imageLink.filePath);
        _imageLink.relink(newFile);
        try {
            if (_imageLink.status == LinkStatus.linkOutOfDate) {
                _imageLink.update();
            }
        } catch (err) {
            alert("Error relink \n" + err)
        }
    } else {
        try {
            if (_imageLink.status == LinkStatus.linkOutOfDate) {
                _imageLink.update();
            }
        } catch (err) {
            alert("Error relink \n" + err)
        }
    }
}

function runPS(_imagePath, _file_RGB, _saveFolder, _color_array, _alreadyRGB) {
    function GetFileNameOnly(e){var t=e.lastIndexOf(".");return-1==t?e:e.substr(0,t)}function SmartObject_edit(){var e=new ActionDescriptor;executeAction(sTID("placedLayerEditContents"),e,DialogModes.NO)}function SmartOject_placeItem(e){var t=new ActionDescriptor;t.putPath(cTID("null"),new File(e)),executeAction(sTID("placedLayerReplaceContents"),t,DialogModes.NO)}function c2t(e){return app.charIDToTypeID(e)}function cTID(e){return app.charIDToTypeID(e)}function s2t(e){return app.stringIDToTypeID(e)}function sTID(e){return app.stringIDToTypeID(e)}function t2s(e){return app.typeIDToStringID(e)}function adjustHue(e,t){return(e+t+360)%360}function adjustLayer_curves_set(e,t,n,r){var o=new ActionDescriptor,s=new ActionDescriptor,i=new ActionDescriptor,c=new ActionDescriptor,a=new ActionDescriptor,u=new ActionList,l=new ActionList,p=new ActionReference,D=new ActionReference;p.putEnumerated(s2t("adjustmentLayer"),s2t("ordinal"),s2t("targetEnum")),o.putReference(s2t("null"),p),s.putEnumerated(s2t("presetKind"),s2t("presetKindType"),s2t("presetKindCustom")),D.putEnumerated(s2t("channel"),s2t("channel"),s2t("composite")),i.putReference(s2t("channel"),D),c.putDouble(s2t("horizontal"),e),c.putDouble(s2t("vertical"),t),l.putObject(s2t("paint"),c),a.putDouble(s2t("horizontal"),n),a.putDouble(s2t("vertical"),r),l.putObject(s2t("paint"),a),i.putList(s2t("curve"),l),u.putObject(s2t("curvesAdjustment"),i),s.putList(s2t("adjustment"),u),o.putObject(s2t("to"),s2t("curves"),s),executeAction(s2t("set"),o,DialogModes.NO)}function adjustLayer_levels_autoLevels(e,t){adjustLayer_levels_edit(null);var n=new ActionDescriptor,r=new ActionDescriptor,o=new ActionDescriptor,s=new ActionList,i=new ActionReference,c=new ActionReference;i.putEnumerated(s2t("adjustmentLayer"),s2t("ordinal"),s2t("targetEnum")),n.putReference(s2t("null"),i),c.putEnumerated(s2t("channel"),s2t("channel"),s2t("composite")),o.putReference(s2t("channel"),c),"autoContrast"==e&&o.putBoolean(s2t("autoContrast"),!0),"auto"==e&&o.putBoolean(s2t("auto"),!0),"autoBlackWhite"==e&&o.putBoolean(s2t("autoBlackWhite"),!0),"autoMachineLearning"==e&&(o.putBoolean(s2t("autoMachineLearning"),!0),o.putBoolean(s2t("autoFaces"),!0)),t&&o.putBoolean(s2t("autoNeutrals"),t),s.putObject(s2t("levelsAdjustment"),o),r.putList(s2t("adjustment"),s),n.putObject(s2t("to"),s2t("levels"),r),executeAction(s2t("set"),n,DialogModes.NO)}function adjustLayer_levels_autoLevels_wrapper(e,t){var n=layer_selectedIDX_get();"LayerKind.LEVELS"==doc.activeLayer.kind?makeVisible():layer_checkExistence("AutoTonwert")?(gotoLayer("AutoTonwert"),makeVisible()):alert("keine TonWert-Ebene ausgewählt bzw vorbereitet"),adjustLayer_levels_autoLevels(e,t),layer_selectedIDX_set(n)}function adjustLayer_levels_edit(e,t,n,r,o,s,t,i,c,a,u,l,p,D,d,I,T,f,g,m){var A=new ActionDescriptor,y=new ActionDescriptor,v=new ActionDescriptor,h=new ActionDescriptor,w=new ActionDescriptor,R=new ActionDescriptor,E=new ActionList,b=new ActionList,L=new ActionList,M=new ActionList,O=new ActionList,S=new ActionList,x=new ActionList,C=new ActionList,N=new ActionList,j=new ActionReference,P=new ActionReference,_=new ActionReference,k=new ActionReference,B=new ActionReference;null==e&&(e=0),null==t&&(t=255),null==n&&(n=0),null==r&&(r=255),null==o&&(o=1),null==s&&(s=0),null==t&&(t=255),null==i&&(i=0),null==c&&(c=255),null==a&&(a=1),null==u&&(u=0),null==l&&(l=255),null==p&&(p=0),null==D&&(D=255),null==d&&(d=1),null==I&&(I=0),null==T&&(T=255),null==f&&(f=0),null==g&&(g=255),null==m&&(m=1),j.putEnumerated(s2t("adjustmentLayer"),s2t("ordinal"),s2t("targetEnum")),A.putReference(s2t("null"),j),y.putEnumerated(s2t("presetKind"),s2t("presetKindType"),s2t("presetKindDefault")),P.putEnumerated(s2t("channel"),s2t("channel"),s2t("composite")),v.putReference(s2t("channel"),P),b.putInteger(e),b.putInteger(t),v.putList(s2t("input"),b),v.putDouble(s2t("gamma"),o),L.putInteger(n),L.putInteger(r),v.putList(s2t("output"),L),E.putObject(s2t("levelsAdjustment"),v),_.putEnumerated(s2t("channel"),s2t("channel"),s2t("red")),h.putReference(s2t("channel"),_),M.putInteger(s),M.putInteger(t),h.putList(s2t("input"),M),h.putDouble(s2t("gamma"),a),O.putInteger(i),O.putInteger(c),h.putList(s2t("output"),O),E.putObject(s2t("levelsAdjustment"),h),k.putEnumerated(s2t("channel"),s2t("channel"),s2t("grain")),w.putReference(s2t("channel"),k),S.putInteger(u),S.putInteger(l),w.putList(s2t("input"),S),w.putDouble(s2t("gamma"),d),x.putInteger(p),x.putInteger(D),w.putList(s2t("output"),x),E.putObject(s2t("levelsAdjustment"),w),B.putEnumerated(s2t("channel"),s2t("channel"),s2t("blue")),R.putReference(s2t("channel"),B),C.putInteger(I),C.putInteger(T),R.putList(s2t("input"),C),R.putDouble(s2t("gamma"),m),N.putInteger(f),N.putInteger(g),R.putList(s2t("output"),N),E.putObject(s2t("levelsAdjustment"),R),y.putList(s2t("adjustment"),E),A.putObject(s2t("to"),s2t("levels"),y),executeAction(s2t("set"),A,DialogModes.NO)}function adjustLayer_sat_eyedropper(){var e=new ActionDescriptor,t=new ActionReference;t.putClass(s2t("eyedropper2Tool")),e.putReference(s2t("null"),t);try{executeAction(s2t("select"),e,DialogModes.NO)}catch(e){alert("Error: "+e)}}function adjustLayer_sat_set(e,t,n,r,o,s,i,c){var a=new ActionDescriptor,u=new ActionDescriptor,l=new ActionDescriptor,p=new ActionList,D=new ActionReference;s=s||0,i=i||0,c=c||0;D.putEnumerated(s2t("adjustmentLayer"),s2t("ordinal"),s2t("targetEnum")),a.putReference(s2t("null"),D),u.putEnumerated(s2t("presetKind"),s2t("presetKindType"),s2t("presetKindCustom")),l.putInteger(s2t("localRange"),e),l.putInteger(s2t("beginRamp"),t),l.putInteger(s2t("beginSustain"),n),l.putInteger(s2t("endSustain"),r),l.putInteger(s2t("endRamp"),o),l.putInteger(s2t("hue"),s),l.putInteger(s2t("saturation"),i),l.putInteger(s2t("lightness"),c),p.putObject(s2t("hueSatAdjustmentV2"),l),u.putList(s2t("adjustment"),p),a.putObject(s2t("to"),s2t("hueSaturation"),u),executeAction(s2t("set"),a,DialogModes.NO)}function app_getColor(e,t){var n=[];if("vordergrund"==t||"foreground"==t)var r=app.foregroundColor;else r=app.backgroundColor;if("rgb"==e){var o=r.rgb;n.push(Math.round(o.red)),n.push(Math.round(o.green)),n.push(Math.round(o.blue))}else if("hsb"==e||"hsl"==e){o=r.hsb;n.push(Math.round(o.hue)),n.push(Math.round(o.saturation)),n.push(Math.round(o.brightness))}return n}function app_getForegroundColor(){var e=[],t=app.foregroundColor;return e.push(Math.round(t.rgb.red)),e.push(Math.round(t.rgb.green)),e.push(Math.round(t.rgb.blue)),e}function app_simulateKeyPress_alt3(){try{app.bringToFront();app.system("osascript -e 'tell application 'System Events' to keystroke '3' using {option down}'")}catch(e){}}function arrayCorrect(e){if("function"!=typeof Array.isArray&&(Array.isArray=function(e){return null!=e&&e.constructor==Array}),!Array.isArray(e)){var t=e.toString();e=[],e=t.split(",")}return e}function array_contains(e,t){if(e)for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}function assignProfile(e){var t=new ActionDescriptor,n=new ActionReference;n.putEnumerated(sTID("document"),sTID("ordinal"),sTID("targetEnum")),t.putReference(sTID("null"),n),t.putString(sTID("profile"),e),executeAction(sTID("assignProfile"),t,DialogModes.NO)}function blendif(e,t,n,r,o){var s=new ActionDescriptor,i=new ActionReference;isNaN(e)?i.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")):i.putIndex(s2t("layer"),e),s.putReference(sTID("null"),i);var c=new ActionDescriptor,a=new ActionList,u=new ActionDescriptor,l=new ActionReference;l.putEnumerated(sTID("channel"),sTID("channel"),sTID("gray")),u.putReference(sTID("channel"),l),u.putInteger(sTID("srcBlackMin"),0),u.putInteger(sTID("srcBlackMax"),0),u.putInteger(sTID("srcWhiteMin"),255),u.putInteger(sTID("srcWhiteMax"),255),u.putInteger(sTID("destBlackMin"),t),u.putInteger(sTID("destBlackMax"),n),u.putInteger(sTID("destWhiteMin"),r),u.putInteger(sTID("desaturate"),o),a.putObject(sTID("blendRange"),u),c.putList(sTID("blendRange"),a),s.putObject(sTID("to"),sTID("layer"),c),executeAction(sTID("set"),s,DialogModes.NO)}function checkTransparency(){return doc.suspendHistory("Transparent Check","checkTransparency_inner()"),undoSteps(1),!!transp}function checkTransparency_inner(){prefSave(),transp=!0;var e=function(e){return app.stringIDToTypeID(e)},t=new ActionDescriptor,n=new ActionDescriptor,r=new ActionReference,o=new ActionReference,s=new ActionReference;r.putProperty(e("channel"),e("selection")),t.putReference(e("null"),r),o.putEnumerated(e("channel"),e("channel"),e("transparencyEnum")),o.putEnumerated(e("layer"),e("ordinal"),e("merged")),n.putReference(e("to"),o),s.putEnumerated(e("channel"),e("channel"),e("transparencyEnum")),s.putEnumerated(e("layer"),e("ordinal"),e("merged")),n.putReference(e("source2"),s),t.putObject(e("to"),e("calculation"),n);try{executeAction(e("set"),t,DialogModes.NO),activeDocument.selection.invert();try{activeDocument.selection.bounds}catch(e){transp=!1}}catch(e){transp=!1}return prefReset(),activeDocument.selection.deselect(),transp}function clearAllGuides(){executeAction(sTID("clearAllGuides"),void 0,DialogModes.NO)}function cm2pt(e){return 28.3464566929*e}function cmyk2rgb(){doc.mode==DocumentMode.CMYK&&doc.convertProfile("eciRGB v2 ICCv4",Intent.RELATIVECOLORIMETRIC,!0,!1)}function copy(){executeAction(cTID("copy"),void 0,DialogModes.NO)}function createColorLayer(e,t,n,r,o,s,i,c){try{var a=new ActionDescriptor,u=new ActionReference;u.putClass(sTID("contentLayer")),a.putReference(sTID("null"),u);var l=new ActionDescriptor;l.putString(sTID("name"),e),l.putUnitDouble(sTID("opacity"),sTID("percentUnit"),r),l.putEnumerated(sTID("mode"),sTID("blendMode"),sTID(t)),l.putEnumerated(sTID("color"),sTID("color"),sTID(n));var p=new ActionDescriptor,D=new ActionDescriptor;if(D.putDouble(sTID("red"),s),D.putDouble(sTID("green"),i),D.putDouble(sTID("blue"),c),p.putObject(sTID("color"),sTID("RGBColor"),D),l.putObject(sTID("type"),sTID("solidColorLayer"),p),a.putObject(sTID("using"),sTID("contentLayer"),l),executeAction(sTID("make"),a,DialogModes.NO),gotoMask(),"invert"==o)return void executeAction(sTID("invert"),void 0,DialogModes.NO);if("none"==o)return void deleteMask();if("black"==o||"white"==o||"gray"==o)return void fill(o,"normal",100)}catch(e){logger(arguments.callee.name)}}function createGroup(e,t,n,r,o){try{var s=new ActionDescriptor,i=new ActionReference;if(i.putClass(sTID("layerSection")),s.putReference(sTID("null"),i),o){var c=new ActionReference;c.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),s.putReference(sTID("from"),c)}var a=new ActionDescriptor;a.putString(sTID("name"),e),a.putUnitDouble(sTID("opacity"),sTID("percentUnit"),r),a.putEnumerated(sTID("color"),sTID("color"),sTID(n)),a.putEnumerated(sTID("mode"),sTID("blendMode"),sTID(t)),s.putObject(sTID("using"),sTID("layerSection"),a),s.putInteger(sTID("layerSectionStart"),351),s.putInteger(sTID("layerSectionEnd"),352),s.putString(sTID("name"),"Gruppe 3"),executeAction(sTID("make"),s,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}function createLayer(e,t,n,r,o,s,i,c){try{var a=new ActionDescriptor,u=new ActionReference;u.putClass(sTID("adjustmentLayer")),a.putReference(sTID("null"),u);var l=new ActionDescriptor;if(l.putString(sTID("name"),e),l.putUnitDouble(sTID("opacity"),sTID("percentUnit"),o),l.putEnumerated(sTID("mode"),sTID("blendMode"),sTID(n)),l.putEnumerated(sTID("color"),sTID("color"),sTID(r)),l.putBoolean(sTID("group"),i),"levels"==t&&c){var p=new ActionDescriptor;p.putEnumerated(sTID("presetKind"),sTID("presetKindType"),sTID("presetKindDefault"));var D=new ActionList,d=new ActionDescriptor,I=new ActionReference;I.putEnumerated(sTID("channel"),sTID("channel"),sTID("composite")),d.putReference(sTID("channel"),I),d.putBoolean(sTID("auto"),!0),D.putObject(sTID("levelsAdjustment"),d),p.putList(sTID("adjustment"),D),l.putObject(sTID("type"),sTID(t),p)}else l.putClass(sTID("type"),sTID(t));if(a.putObject(sTID("using"),sTID("adjustmentLayer"),l),executeAction(sTID("make"),a,DialogModes.NO),"invert"==s)return void executeAction(sTID("invert"),void 0,DialogModes.NO);if("none"==s)return void deleteMask();if("black"==s||"white"==s||"gray"==s)return void fill(s,"normal",100)}catch(e){logger(arguments.callee.name)}}function createMask(){var e=new ActionDescriptor,t=new ActionReference;e.putClass(s2t("new"),s2t("channel")),t.putEnumerated(s2t("channel"),s2t("channel"),s2t("mask")),e.putReference(s2t("at"),t),e.putEnumerated(s2t("using"),c2t("UsrM"),s2t("revealAll")),executeAction(s2t("make"),e,DialogModes.NO)}function crop_bySelection(){var e=new ActionDescriptor;e.putBoolean(s2t("delete"),!0),executeAction(s2t("crop"),e,DialogModes.NO)}function deleteHistory(){var e=new ActionDescriptor,t=new ActionReference;t.putProperty(charIDToTypeID("HstS"),charIDToTypeID("CrnH")),e.putReference(charIDToTypeID("null"),t),executeAction(charIDToTypeID("Dlt "),e,DialogModes.NO)}function deleteMask(){try{var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("channel"),sTID("channel"),sTID("mask")),e.putReference(sTID("null"),t),executeAction(sTID("delete"),e,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}function dublicate(e){var t=new ActionDescriptor,n=new ActionReference;n.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),t.putReference(sTID("null"),n),t.putString(sTID("name"),e),t.putInteger(sTID("version"),5),executeAction(sTID("duplicate"),t,DialogModes.NO)}function emptyProtocoll(){var e=new ActionDescriptor;e.putEnumerated(cTID("null"),cTID("PrgI"),cTID("Al  ")),executeAction(cTID("Prge"),e,DialogModes.NO);for(var t=app.activeDocument.historyStates,n=t.length-1;n>=0;--n)t[n].snapshot&&(app.activeDocument.activeHistoryState=t[n],deleteHistory())}function fill(e,t,n,r,o,s){try{var i=new ActionDescriptor;if(i.putEnumerated(sTID("using"),sTID("fillContents"),sTID(e)),"color"==e){var c=new ActionDescriptor;c.putUnitDouble(sTID("hue"),sTID("angleUnit"),r),c.putDouble(sTID("saturation"),o),c.putDouble(sTID("brightness"),s),i.putObject(sTID("color"),sTID("HSBColorClass"),c)}i.putUnitDouble(sTID("opacity"),sTID("percentUnit"),n),i.putEnumerated(sTID("mode"),sTID("blendMode"),sTID(t)),executeAction(sTID("fill"),i,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}function flattenImage(){executeAction(charIDToTypeID("FltI"),void 0,DialogModes.NO)}function getBitDepth(){if("BitsPerChannelType.EIGHT"==doc.bitsPerChannel)var e=8;else if(doc.bitsPerChannel==BitsPerChannelType.SIXTEEN)e=16;else{if(doc.bitsPerChannel!=BitsPerChannelType.THIRTYTWO)return!1;e=32}return e}function getScale(e){var t=1e6*e/(doc.width*doc.height);return Math.sqrt(t)}function gotoFill(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("channel"),sTID("channel"),sTID("RGB")),e.putReference(sTID("null"),t),e.putBoolean(sTID("makeVisible"),!1),executeAction(sTID("select"),e,DialogModes.NO)}function gotoLayer(e){var t=new ActionDescriptor,n=new ActionReference;"number"==typeof e?n.putIndex(charIDToTypeID("Lyr "),e):"string"==typeof e&&n.putName(sTID("layer"),e),t.putReference(sTID("null"),n),t.putBoolean(sTID("makeVisible"),!1),executeAction(sTID("select"),t,DialogModes.NO)}function gotoLayer_byID(e){var t=new ActionDescriptor,n=new ActionReference;n.putIdentifier(s2t("layer"),e),t.putReference(sTID("null"),n),t.putBoolean(sTID("makeVisible"),!1),executeAction(sTID("select"),t,DialogModes.NO)}function gotoLayer_bySelector(e){var t=new ActionDescriptor,n=new ActionReference;try{"number"==typeof e?n.putIndex(s2t("layer"),e):"string"==typeof e&&(layer_checkExistence(e)?n.putName(s2t("layer"),e):n.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])),t.putReference(sTID("null"),n),t.putBoolean(sTID("makeVisible"),!1),executeAction(sTID("select"),t,DialogModes.NO)}catch(e){debug&&alert("ERROR - gotoLayer_bySelector: \n"+e)}}function gotoMask(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("channel"),sTID("channel"),sTID("mask")),e.putReference(sTID("null"),t),e.putBoolean(sTID("makeVisible"),!1),executeAction(sTID("select"),e,DialogModes.NO)}function gray2rgb(){doc.mode==DocumentMode.GRAYSCALE&&doc.convertProfile("eciRGB v2 ICCv4",Intent.RELATIVECOLORIMETRIC,!0,!1)}function hasBackground(){var e=void 0;try{var t=new ActionReference;t.putProperty(cTID("Prpr"),cTID("Nm  ")),t.putIndex(cTID("Lyr "),0),executeActionGet(t).getString(cTID("Nm  ")),e=!0}catch(t){e=!1}return e}function historyState_deleteSteps(e){try{for(var t=0;t<e;t++){var n=new ActionDescriptor,r=new ActionReference;r.putEnumerated(s2t("historyState"),s2t("ordinal"),s2t("last")),n.putReference(s2t("null"),r),executeAction(s2t("delete"),n,DialogModes.NO)}}catch(e){}}function img_resize(e,t){var n;(prefSave(),prefSet(DialogModes.NO,Units.MM),doc.width>doc.height)?((n=new ActionDescriptor).putUnitDouble(sTID("width"),sTID("distanceUnit"),cm2pt(e)),executeAction(sTID("imageSize"),n,DialogModes.NO)):((n=new ActionDescriptor).putUnitDouble(sTID("height"),sTID("distanceUnit"),cm2pt(e)),executeAction(sTID("imageSize"),n,DialogModes.NO));doc.resolution>t&&t&&doc.resizeImage(void 0,void 0,t,ResampleMethod.PRESERVEDETAILS,0),prefReset()}function indexcolor2rgb(){doc.mode==DocumentMode.INDEXEDCOLOR&&doc.changeMode(ChangeMode.RGB)}function interpolation_GigaPixel(e,t,n){var r=app.preferences.rulerUnits;app.preferences.rulerUnits=Units.PIXELS;var o=parseInt(app.activeDocument.width);text2Clipboard(Math.ceil(t*o)),app.preferences.rulerUnits=r,executeAction(sTID("1E822513-BC4D-4CF2-B1FE-80505B509928"),void 0,DialogModes.ALL),setDpi(n)}function interpolation_PS(e,t,n){try{if(e<t)return void app.activeDocument.resizeImage(void 0,void 0,t,ResampleMethod.PRESERVEDETAILS);e>n?app.activeDocument.resizeImage(void 0,void 0,n,ResampleMethod.PRESERVEDETAILS):setDpi(e)}catch(e){alert(e)}}function interpolation_PhotoAI(e,t,n){text2Clipboard((t/e).toFixed(2).replace(".",",")),executeAction(sTID("a40009fc-f5fc-4a09-86ec-5a0ed56c5668"),void 0,DialogModes.ALL),setDpi(t)}function invert(){executeAction(s2t("invert"),void 0,DialogModes.NO)}function isSelectionActive(){var e=doc.selection;try{return!!e.bounds}catch(e){return!1}}function loadJSON(e){var t,n=new File(e);if(!n.exists)return alert("Die JSON-Datei konnte nicht gefunden werden."),null;n.open("r"),t=n.read(),n.close();try{return JSON.parse(t)}catch(e){return alert("Fehler beim Parsen der JSON-Datei:\n"+e),null}}function jsonValue(e){for(var t=0;t<jsonData.length;t++)if(void 0!==jsonData[t][e])return jsonData[t][e];return null}function logger(e){debug&&time_start();var t="~/Desktop/SimonScript.log",n=File(t);n.exists||(n=new File(t));var r=new Date,o=("0"+r.getDate()).slice(-2)+"."+("0"+(r.getMonth()+1)).slice(-2)+"."+r.getFullYear()+" - "+(("0"+r.getHours()).slice(-2)+":"+("0"+r.getMinutes()).slice(-2)+":"+("0"+r.getSeconds()).slice(-2)),s=File(t);s.open("a",void 0,void 0),""!==s&&(s.writeln("-----------------------"),s.writeln(o),s.writeln("Doc: '"+doc.name+"'"),s.writeln("Function: '"+e+"'"),s.writeln(""),s.close()),debug&&time_stop(start)}function mergeLayers(){var e=new ActionDescriptor;executeAction(sTID("mergeLayersNew"),e,DialogModes.NO)}function mm2pt(e){return 2.83464566929*e}function moveLayer(e,t,n){gotoLayer(e);var r=app.activeDocument.activeLayer;gotoLayer(t);var o=app.activeDocument.activeLayer;if("up"==n)var s=ElementPlacement.PLACEBEFORE;if("down"==n)s=ElementPlacement.PLACEAFTER;if("inside"==n)s=ElementPlacement.INSIDE;if("PlaceAtBeginning"==n)s=ElementPlacement.PLACEATBEGINNING;if("PlaceAtEnd"==n)s=ElementPlacement.PLACEATEND;r.move(o,s)}function moveLayer3(e,t){"up"==e&&(e="next"),"down"==e&&(e="previous"),"top"==e&&(e="front"),"bottom"==e&&(e="back");for(var n=0;n<t;n++){var r=new ActionDescriptor,o=new ActionReference,s=new ActionReference;o.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),r.putReference(sTID("null"),o),s.putEnumerated(sTID("layer"),sTID("ordinal"),sTID(e)),r.putReference(sTID("to"),s),executeAction(sTID("move"),r,DialogModes.NO)}}function nameLayer(e){try{app.activeDocument.activeLayer.name=e}catch(e){logger(arguments.callee.name)}}function noProfile(){if(doc.colorProfileType==ColorProfile.NONE)try{app.bringToFront();var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("document"),sTID("ordinal"),sTID("targetEnum")),e.putReference(sTID("null"),t),e.putBoolean(sTID("manage"),!0),executeAction(sTID("assignProfile"),e,DialogModes.ALL)}catch(e){}}function paste_into(){var e=new ActionDescriptor;e.putEnumerated(c2t("AntA"),s2t("antiAliasType"),s2t("antiAliasNone")),executeAction(s2t("pasteInto"),e,DialogModes.NO)}function prefReset(){app.preferences.rulerUnits=startRulerUnits,startDisplayDialogs==DialogModes.ERROR&&(startDisplayDialogs=DialogModes.NO),app.displayDialogs=startDisplayDialogs}function prefSave(){startDisplayDialogs=app.displayDialogs,startRulerUnits=app.preferences.rulerUnits}function prefSet(e,t){e||(alert("check prefSet"),e=DialogModes.NO),t||(alert("check prefSet"),t=Units.MM),app.displayDialogs=e,app.preferences.rulerUnits=t}function pt2cm(e){return e/2.83464566929}function rasterSmartObject(){try{var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),e.putReference(sTID("null"),t),executeAction(sTID("rasterizeLayer"),e,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}function replace__RGB_RZ(e){var t=GetFileNameOnly(doc.name).replace(/(__RGB.*)$/g,e).replace(/(__RZ.*)$/g,e).replace(/(__WEB.*)$/g,e),n=new RegExp(e,"g");if(!t.match(n))t=t+e;return t}function resetImage(){executeAction(sTID("revert"),void 0,DialogModes.NO),emptyProtocoll()}function sRGB2eciRGB(){var e=doc.colorProfileName,t=new RegExp("^sRGB|Apple RGB|ColorMatch RGB");e.match(t)&&doc.convertProfile("eciRGB v2 ICCv4",Intent.RELATIVECOLORIMETRIC,!0,!1)}function saveRZ(e,t,n,r){var o=new Folder(e);o.exists||o.create();for(var s=o+"/"+t+(c=replace__RGB_RZ(r))+"."+n,i=File(s);i.exists;){var c;s=o+"/"+t+(c=c+"+")+"."+n,i=File(s)}if("tif"==n)(a=new TiffSaveOptions).alphaChannels=!0,a.byteOrder=ByteOrder.IBM,a.embedColorProfile=!0,a.imageCompression=TIFFEncoding.TIFFLZW,a.layers=!0,a.spotColors=!1,a.transparency=!0,a.annotations=!1;else if("jpg"==n){(a=new JPEGSaveOptions).embedColorProfile=!0,a.formatOptions=FormatOptions.STANDARDBASELINE,a.matte=MatteType.WHITE,a.quality=11}else if("psd"==n){var a;(a=new PhotoshopSaveOptions).alphaChannels=!1,a.annotations=!1,a.embedColorProfile=!0,a.layers=!0,a.spotColors=!1}doc.saveAs(new File(s),a,!1,Extension.LOWERCASE)}function selectAll(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),e.putReference(sTID("null"),t),executeAction(sTID("selectAllLayers"),e,DialogModes.NO)}function selectAllLayers(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),e.putReference(sTID("null"),t),executeAction(sTID("selectAllLayers"),e,DialogModes.NO)}function selectLayer(e,t){var n=new ActionDescriptor,r=new ActionReference;"down"!=e?r.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("forwardEnum")):r.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("backwardEnum")),n.putReference(sTID("null"),r),n.putBoolean(sTID("makeVisible"),!1);var o=0;for(o=1;o<=t;o+=1)executeAction(sTID("select"),n,DialogModes.NO)}function selectLayerUp(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("forwardEnum")),e.putReference(sTID("null"),t),e.putBoolean(sTID("makeVisible"),!1);var n=new ActionList;n.putInteger(108),e.putList(sTID("layerID"),n),executeAction(sTID("select"),e,DialogModes.NO)}function selectLayers(e){var t=new ActionDescriptor,n=new ActionReference;n.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),t.putReference(sTID("null"),n);try{executeAction(sTID(e),t,DialogModes.NO)}catch(e){}}function setBitDepth(e){var t=charIDToTypeID("CnvM"),n=new ActionDescriptor,r=charIDToTypeID("Dpth");n.putInteger(r,e),executeAction(t,n,DialogModes.NO)}function setDpi(e){var t=new ActionDescriptor;t.putUnitDouble(sTID("resolution"),sTID("densityUnit"),e),executeAction(sTID("imageSize"),t,DialogModes.NO)}function setMegaPixel(e){prefSave(),prefSet(DialogModes.NO,Units.PIXELS);var t=doc.width,n=doc.height,r=t*n,o=1e6*e,s=o/r;if(o<r)if(t>=n){var i=t*Math.sqrt(s);doc.resizeImage(i,void 0,void 0,ResampleMethod.PRESERVEDETAILS,0)}else{var c=Math.round(n*Math.sqrt(s));doc.resizeImage(void 0,c,void 0,ResampleMethod.PRESERVEDETAILS,0)}return prefReset(),""}function setSize(e,t,n){var r=new ActionDescriptor;"mm"==n&&(t=mm2pt(t)),r.putUnitDouble(sTID(e),sTID("distanceUnit"),t),executeAction(sTID("imageSize"),r,DialogModes.NO)}function smartObject(){try{executeAction(stringIDToTypeID("newPlacedLayer"),void 0,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}function smartObjectTransparencyIssue(){var e=doc.activeLayer.name;if(gotoLayer("Original"),tempRulerUnits=app.preferences.rulerUnits,app.preferences.rulerUnits=Units.PIXELS,"LayerKind.SMARTOBJECT"==doc.activeLayer.kind){if(doc.width<doc.height)var t=100*(doc.width+2)/doc.width;else t=100*(doc.height+2)/doc.height;alert(t),transformLayer("center",t)}if(gotoLayer("vorher Ebene"),doc.width<doc.height)t=100*(doc.width+2)/doc.width;else t=100*(doc.height+2)/doc.height;transformLayer("center",t),app.preferences.rulerunits=tempRulerUnits,gotoLayer(e);e=""}function startScriptFile(e,t){var n=new ActionDescriptor;n.putString(sTID("javaScriptName"),e),executeAction(sTID("AdobeScriptAutomation Scripts"),n,t)}function text2Clipboard(e){var t=new ActionDescriptor;t.putString(stringIDToTypeID("textData"),e),executeAction(stringIDToTypeID("textToClipboard"),t,DialogModes.NO)}function time_start(){start=(new Date).getTime()}function time_stop(e){var t=(new Date).getTime(),n="Done ("+Number((t-e)/1e3).toFixed(3)+" secs).";alert(n)}function transformLayer(e,t){var n=new ActionDescriptor;if("center"==e||"c"==e)var r="QCSAverage";if("topleft"==e||"tl"==e||"↖"==e)r="QCSCorner0";if("top"==e||"t"==e||"↑"==e)r="QCSSide0";if("topright"==e||"tr"==e||"↗"==e)r="QCSCorner1";if("right"==e||"r"==e||"→"==e)r="QCSSide1";if("bottomright"==e||"br"==e||"↘"==e)r="QCSCorner2";if("bottom"==e||"b"==e||"↓"==e)r="QCSSide2";if("bottomleft"==e||"bl"==e||"↙"==e)r="QCSCorner3";if("left"==e||"l"==e||"←"==e)r="QCSSide3";n.putEnumerated(sTID("freeTransformCenterState"),sTID("quadCenterState"),sTID(r));var o=new ActionDescriptor;o.putUnitDouble(sTID("horizontal"),sTID("pixelsUnit"),0),o.putUnitDouble(sTID("vertical"),sTID("pixelsUnit"),0),n.putObject(sTID("offset"),sTID("offset"),o),n.putUnitDouble(sTID("width"),sTID("percentUnit"),t),n.putUnitDouble(sTID("height"),sTID("percentUnit"),t),executeAction(sTID("transform"),n,DialogModes.NO)}function undoSteps(e){try{for(var t=0;t<e;t++)try{executeAction(charIDToTypeID("undo"),void 0,DialogModes.NO)}catch(e){var n=new ActionDescriptor,r=new ActionReference;r.putEnumerated(charIDToTypeID("HstS"),charIDToTypeID("Ordn"),charIDToTypeID("Prvs")),n.putReference(charIDToTypeID("null"),r),executeAction(charIDToTypeID("slct"),n,DialogModes.NO)}}catch(e){}}function workingProfile_get(e){var t=new ActionReference;t.putProperty(s2t("property"),s2t("colorSettings")),t.putEnumerated(s2t("application"),s2t("ordinal"),s2t("targetEnum"));try{return executeActionGet(t).getObjectValue(s2t("colorSettings")).getString(s2t("working"+e))}catch(e){alert(e)}}function workingProfile_set(e,t){var n=new ActionDescriptor,r=new ActionDescriptor,o=new ActionReference;o.putProperty(s2t("property"),s2t("colorSettings")),o.putEnumerated(s2t("application"),s2t("ordinal"),s2t("targetEnum")),n.putReference(s2t("null"),o),r.putString(s2t("working"+e),t),n.putObject(s2t("to"),s2t("colorSettings"),r);try{executeAction(s2t("set"),n,DialogModes.NO)}catch(e){alert("kann Arbeitsfarbraum nicht ändern")}}app.documents.length>0&&(doc=app.activeDocument,docs=app.documents),f=!1,t=!0,debug=!1;
    function TemporaryAlpha(){activeDocument.selection.store(this.alpha=activeDocument.channels.add());activeDocument.selection.deselect();this.consume=function(){activeDocument.selection.load(this.alpha);this.alpha.remove()}}function activateLayerMask(){var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));e.putReference(cTID("null"),r);try{executeAction(cTID("slct"),e,DialogModes.NO)}catch(e){var t=new TemporaryAlpha;maskFromSelection();activateLayerMask();t.consume()}}function addLayer(){var e=activeDocument.activeLayer;var r=activeDocument.layerSets.add();r.move(e,ElementPlacement.PLACEBEFORE);return r}function addNext(){theCurrentSelectionIDX=getSelectedLayersIdx();makeActiveByIndex(theCurrentSelectionIDX[0],false);myselectNext();theCurrentSelectionIDX.push(getActiveLayerIndex());makeActiveByIndex(theCurrentSelectionIDX,false)}function addPrevious(){theCurrentSelectionIDX=getSelectedLayersIdx();makeActiveByIndex(theCurrentSelectionIDX[theCurrentSelectionIDX.length-1],false);myselectPrevious();theCurrentSelectionIDX.push(getActiveLayerIndex());makeActiveByIndex(theCurrentSelectionIDX,false)}function addSibilings(){theSelIDX1=getSelectedLayersIdx();theSibilings=getSibilings1();var e=theSelIDX1.concat(theSibilings);makeActiveByIndex(e,false)}function addTempLayerSetIn(e){var r=charIDToTypeID("Mk  ");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=stringIDToTypeID("layerSection");n.putClass(c);t.putReference(a,n);executeAction(r,t,DialogModes.NO);var o=charIDToTypeID("setd");var i=new ActionDescriptor;var a=charIDToTypeID("null");var D=new ActionReference;var I=charIDToTypeID("Lyr ");var T=charIDToTypeID("Ordn");var p=charIDToTypeID("Trgt");D.putEnumerated(I,T,p);i.putReference(a,D);var u=charIDToTypeID("T   ");var s=new ActionDescriptor;var y=charIDToTypeID("Nm  ");s.putString(y,"mb-dummy tempTestLayerSetOpen_Closed");var I=charIDToTypeID("Lyr ");i.putObject(u,I,s);executeAction(o,i,DialogModes.NO);var l=charIDToTypeID("move");var v=new ActionDescriptor;var a=charIDToTypeID("null");var f=new ActionReference;var I=charIDToTypeID("Lyr ");var T=charIDToTypeID("Ordn");var p=charIDToTypeID("Trgt");f.putEnumerated(I,T,p);v.putReference(a,f);var u=charIDToTypeID("T   ");var h=new ActionReference;var I=charIDToTypeID("Lyr ");h.putIndex(I,e);v.putReference(u,h);var g=charIDToTypeID("Adjs");v.putBoolean(g,false);var d=charIDToTypeID("Vrsn");v.putInteger(d,5);executeAction(l,v,DialogModes.NO)}function addToSelection(e){var r=new ActionDescriptor;var t=new ActionReference;t.putName(cTID("Lyr "),e);r.putReference(cTID("null"),t);r.putEnumerated(sTID("selectionModifier"),sTID("selectionModifierType"),sTID("addToSelection"));r.putBoolean(cTID("MkVs"),false);try{executeAction(cTID("slct"),r,DialogModes.NO)}catch(e){}}function closeGroup(e){var r=isLocked();var t=isVisible();var a=e.name;var n=e.opacity;var c=e.blendMode;var o=e.linkedLayers;var i=getActiveLayerIndex();var D=getActiveLayerIndex();if(!hasBackground()){D=D-1}var I=getColor();try{var T=hasLayerMask()}catch(e){}try{var p=hasVectorMask()}catch(e){}var I=getColor();var u=false;try{copyLayerStyle();u=true}catch(e){}if(r==true){unlock()}if(t==false){makeVisible()}if(T){try{deselectPath()}catch(e){}var s=isLayerMaskEnabled();duplicateLayerMaskAsAlpha();try{var y=getMaskDensity();var l=getMaskFeather()}catch(e){}var v=isLayerMaskLinked()}if(p){var f=getVectorMaskDensity();var h=getVectorMaskFeather();duplicateVectorMask()}if(e.layers.length<=1){addTempLayerSetIn(D);makeActiveByIndex(i+2,false);ungroup();groupSelected(a);makeActiveByIndex(i+2,false);deleteTempLayerSetbyIdx(currSetIDX+1)}else{makeActiveByIndex(currSetIDX,false);ungroup();groupSelected(a)}var g=activeDocument.activeLayer;g.opacity=n;g.blendMode=c;for(x in o){if(o[x].typename=="LayerSet"){activeDocument.activeLayer.link(o[x])}}if(u)pasteLayerStyle();if(T){setBackTheLayerMask();try{setMaskDensityTo(Math.round(y*100/255));setMaskFeatherTo(l)}catch(e){}setMaskLinked(v);setMaskEnabled(s)}if(p){recreateVectorMask();setVectorMaskDensityTo(Math.round(f*100/255));setVectorMaskFeatherTo(h)}setColorTo(I);if(r==true){lock()}if(t==false){hide()}return g}function copyLayerStyle(){var e=charIDToTypeID("CpFX");executeAction(e,undefined,DialogModes.NO)}function deleteActiveLayer(){var e=charIDToTypeID("Dlt ");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Lyr ");var c=charIDToTypeID("Ordn");var o=charIDToTypeID("Trgt");a.putEnumerated(n,c,o);r.putReference(t,a);executeAction(e,r,DialogModes.NO)}function deleteMask(e){if(e){loadSelectionOfMask()}var r=new ActionDescriptor;var t=new ActionReference;t.putEnumerated(cTID("Chnl"),cTID("Ordn"),cTID("Trgt"));r.putReference(cTID("null"),t);try{executeAction(cTID("Dlt "),r,DialogModes.NO)}catch(e){}}function deleteTempLayerSetbyIdx(e){var r=charIDToTypeID("Dlt ");var t=new ActionDescriptor;var a=new ActionReference;a.putIndex(charIDToTypeID("Lyr "),e);t.putReference(charIDToTypeID("null"),a);executeAction(r,t,DialogModes.NO)}function deselectPath(){var e=new ActionDescriptor;var r=new ActionReference;r.putClass(cTID("Path"));e.putReference(cTID("null"),r);executeAction(cTID("Dslc"),e,DialogModes.NO)}function duplicateLayerMaskAsAlpha(){selectLayerMask();var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));e.putReference(cTID("null"),r);e.putBoolean(cTID("MkVs"),true);executeAction(cTID("slct"),e,DialogModes.NO);var t=charIDToTypeID("setd");var a=new ActionDescriptor;var n=charIDToTypeID("null");var c=new ActionReference;var o=charIDToTypeID("Chnl");var i=charIDToTypeID("fsel");c.putProperty(o,i);a.putReference(n,c);var D=charIDToTypeID("T   ");var I=charIDToTypeID("Ordn");var T=charIDToTypeID("Al  ");a.putEnumerated(D,I,T);executeAction(t,a,DialogModes.NO);var p=charIDToTypeID("copy");executeAction(p,undefined,DialogModes.NO);var u=charIDToTypeID("Mk  ");var s=new ActionDescriptor;var y=charIDToTypeID("Nw  ");var l=new ActionDescriptor;var v=charIDToTypeID("ClrI");var f=charIDToTypeID("MskI");var h=charIDToTypeID("MskA");l.putEnumerated(v,f,h);var g=charIDToTypeID("Clr ");var d=new ActionDescriptor;var A=charIDToTypeID("Rd  ");d.putDouble(A,255);var m=charIDToTypeID("Grn ");d.putDouble(m,0);var x=charIDToTypeID("Bl  ");d.putDouble(x,0);var L=charIDToTypeID("RGBC");l.putObject(g,L,d);var S=charIDToTypeID("Opct");l.putInteger(S,50);var o=charIDToTypeID("Chnl");s.putObject(y,o,l);executeAction(u,s,DialogModes.NO);var t=charIDToTypeID("setd");var w=new ActionDescriptor;var n=charIDToTypeID("null");var R=new ActionReference;var o=charIDToTypeID("Chnl");var i=charIDToTypeID("fsel");R.putProperty(o,i);w.putReference(n,R);var D=charIDToTypeID("T   ");var I=charIDToTypeID("Ordn");var T=charIDToTypeID("Al  ");w.putEnumerated(D,I,T);executeAction(t,w,DialogModes.NO);var k=charIDToTypeID("past");var O=new ActionDescriptor;var M=charIDToTypeID("AntA");var b=charIDToTypeID("Annt");var E=charIDToTypeID("Anno");O.putEnumerated(M,b,E);executeAction(k,O,DialogModes.NO);var t=charIDToTypeID("setd");var N=new ActionDescriptor;var n=charIDToTypeID("null");var G=new ActionReference;var o=charIDToTypeID("Chnl");var i=charIDToTypeID("fsel");G.putProperty(o,i);N.putReference(n,G);var D=charIDToTypeID("T   ");var I=charIDToTypeID("Ordn");var X=charIDToTypeID("None");N.putEnumerated(D,I,X);executeAction(t,N,DialogModes.NO);var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Ordn"),cTID("Trgt"));e.putReference(cTID("null"),r);var C=new ActionDescriptor;C.putString(cTID("Nm  "),"mbTemp_alpha");e.putObject(cTID("T   "),cTID("Chnl"),C);executeAction(cTID("setd"),e,DialogModes.NO);var P=new ActionDescriptor;var B=new ActionReference;B.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("RGB "));P.putReference(cTID("null"),B);P.putBoolean(cTID("MkVs"),false);executeAction(cTID("slct"),P,DialogModes.NO)}function duplicateVectorMask(){var e=charIDToTypeID("slct");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Path");var n=charIDToTypeID("Path");var c=stringIDToTypeID("vectorMask");a.putEnumerated(n,n,c);var o=charIDToTypeID("Lyr ");var i=charIDToTypeID("Ordn");var D=charIDToTypeID("Trgt");a.putEnumerated(o,i,D);r.putReference(t,a);executeAction(e,r,DialogModes.NO);var I=charIDToTypeID("Mk  ");var T=new ActionDescriptor;var t=charIDToTypeID("null");var p=new ActionReference;var n=charIDToTypeID("Path");p.putClass(n);T.putReference(t,p);var u=charIDToTypeID("From");var s=new ActionReference;var n=charIDToTypeID("Path");var n=charIDToTypeID("Path");var c=stringIDToTypeID("vectorMask");s.putEnumerated(n,n,c);var o=charIDToTypeID("Lyr ");var i=charIDToTypeID("Ordn");var D=charIDToTypeID("Trgt");s.putEnumerated(o,i,D);T.putReference(u,s);executeAction(I,T,DialogModes.NO);var y=charIDToTypeID("Rnm ");var l=new ActionDescriptor;var t=charIDToTypeID("null");var v=new ActionReference;var n=charIDToTypeID("Path");var i=charIDToTypeID("Ordn");var D=charIDToTypeID("Trgt");v.putEnumerated(n,i,D);l.putReference(t,v);var f=charIDToTypeID("T   ");l.putString(f,"mbTemp_path");executeAction(y,l,DialogModes.NO);var h=charIDToTypeID("Dslc");var g=new ActionDescriptor;var t=charIDToTypeID("null");var d=new ActionReference;var n=charIDToTypeID("Path");d.putClass(n);g.putReference(t,d);executeAction(h,g,DialogModes.NO)}function eliminateDuplicates(e){var r,t=e.length,a=[],n={};for(r=0;r<t;r++){n[e[r]]=0}for(r in n){a.push(r)}return a}function eliminateTheSame(e,r){var t,a=e.length,n=r.length,c=[],o={};for(t=0;t<a;t++){c.push(e[t]);for(j=0;j<n;j++){if(e[t]==r[j]){c.pop(1);break}}}return c}function getActiveLayerIndex(){var e=new ActionReference;e.putProperty(charIDToTypeID("Prpr"),charIDToTypeID("ItmI"));e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));return hasBackground()?executeActionGet(e).getInteger(charIDToTypeID("ItmI"))-1:executeActionGet(e).getInteger(charIDToTypeID("ItmI"))}function getClosedSets(){var e=[];var r=1;while(layer_checkExistence(r)){if(isLayerSet(r)){if(!isSetOpened2(r)){e.push(r)}}r++}return e}function getColor(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);a=r.getEnumerationValue(cTID("Clr "));return typeIDToCharID(a)}function getFristLayerSetChildVisible(){xx=false;var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e).getInteger(charIDToTypeID("Cnt "));var t=executeActionGet(e).getInteger(stringIDToTypeID("layerID"));var a=[];var n=0;var c=0;var o=0;currINDEX=getActiveLayerIndex();var i=currINDEX;for(i;i>0;i--){e=new ActionReference;e.putIndex(charIDToTypeID("Lyr "),i);var D=executeActionGet(e);var I=D.getString(charIDToTypeID("Nm  "));var T=D.getInteger(stringIDToTypeID("layerID"));var p=D.getEnumerationValue(stringIDToTypeID("layerSection"));p=typeIDToStringID(p);var u=D.getInteger(stringIDToTypeID("visible"));if(p=="layerSectionStart"){n++}if(u==1&&T!=t&&o!=0){var s={id:T,lname:I,idx:i};xx=true;a.push(s);break}var y=new RegExp("^</Layer group");if(I.match(y)){c++;o=n-c;if(o==0&&p=="layerSectionEnd"){break}continue}}return a}function getLastChildIdx(){xx=false;var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e).getInteger(charIDToTypeID("Cnt "));var t=executeActionGet(e).getInteger(stringIDToTypeID("layerID"));currINDEX=getActiveLayerIndex();var a=currINDEX;var n=0;var c=0;var o=0;var i=0;for(a;a>0;a--){e=new ActionReference;e.putIndex(charIDToTypeID("Lyr "),a);var D=executeActionGet(e);var I=D.getString(charIDToTypeID("Nm  "));var T=D.getInteger(stringIDToTypeID("layerID"));var p=D.getEnumerationValue(stringIDToTypeID("layerSection"));p=typeIDToStringID(p);var u=D.getInteger(stringIDToTypeID("visible"));if(p=="layerSectionStart"){n++}var s=new RegExp("^</Layer group");if(I.match(s)){c++;o=n-c;if(o==0&&p=="layerSectionEnd"){i=a;break}}}return i}function getLayerName(e){var r=new ActionReference;r.putIndex(cTID("Lyr "),e);var t=executeActionGet(r);return t.getString(charIDToTypeID("Nm  "))}function getLayersNb(){var e=new ActionReference;e.putProperty(charIDToTypeID("Prpr"),stringIDToTypeID("numberOfLayers"));e.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e);var t=r.getInteger(stringIDToTypeID("numberOfLayers"));return t}function getMaskDensity(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getUnitDoubleValue(sTID("userMaskDensity"))}function getMaskFeather(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getUnitDoubleValue(sTID("userMaskFeather"))}function getNamesPlusIDsOfLayerSet(){var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e).getInteger(charIDToTypeID("Cnt "));var t=executeActionGet(e).getInteger(stringIDToTypeID("layerID"));var a=[];var n=0;var c=0;var o=0;currINDEX=getActiveLayerIndex();var i=currINDEX;for(i;i>0;i--){e=new ActionReference;e.putIndex(charIDToTypeID("Lyr "),i);var D=executeActionGet(e);var I=D.getString(charIDToTypeID("Nm  "));var T=D.getInteger(stringIDToTypeID("layerID"));var p=D.getEnumerationValue(stringIDToTypeID("layerSection"));p=typeIDToStringID(p);if(p=="layerSectionStart"){n++}var u=new RegExp("^</Layer group");if(I.match(u)){c++;o=n-c;if(o==0&&p=="layerSectionEnd"){break}continue}if(p=="layerSectionContent"){makeActiveByIndex(i,false);break}var s=typeIDToStringID(D.getEnumerationValue(stringIDToTypeID("layerSection")));var y=s=="layerSectionContent"?false:true;a.push([[T],[I],[y]])}return a}function getNbOfChilds(){xx=false;var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e).getInteger(charIDToTypeID("Cnt "));var t=executeActionGet(e).getInteger(stringIDToTypeID("layerID"));currINDEX=getActiveLayerIndex();var a=currINDEX;var n=0;var c=0;var o=0;var i=0;for(a;a>0;a--){e=new ActionReference;e.putIndex(charIDToTypeID("Lyr "),a);var D=executeActionGet(e);var I=D.getString(charIDToTypeID("Nm  "));var T=D.getInteger(stringIDToTypeID("layerID"));var p=D.getEnumerationValue(stringIDToTypeID("layerSection"));p=typeIDToStringID(p);var u=D.getInteger(stringIDToTypeID("visible"));if(p=="layerSectionStart"){c++}var s=new RegExp("^</Layer group");if(I.match(s)){o++;i=c-o;if(i==0&&p=="layerSectionEnd"){break}continue}n++}return n}function getParentIDXfor(e){xx=false;var r=getLayersNb();currINDEX=e;var t=currINDEX;var a=0;var n=1;var c=0;try{if(isLayerSet(e)){c=-1}}catch(e){return}var o=0;for(t;t<=r;t++){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),t);var i=executeActionGet(ref);var D=i.getString(charIDToTypeID("Nm  "));var I=i.getInteger(stringIDToTypeID("layerID"));var T=i.getEnumerationValue(stringIDToTypeID("layerSection"));T=typeIDToStringID(T);var p=i.getInteger(stringIDToTypeID("visible"));if(T=="layerSectionEnd"){n++}if(T=="layerSectionStart"){c++}o=n-c;if(o==0&&T=="layerSectionStart"){a=t;break}}return a}function getParentIndex1(e){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),e);var r=executeActionGet(ref);if(r.hasKey(stringIDToTypeID("targetEnum"))){alert("parentIDX")}}function getSelectedLayersIdx(){var e=new Array;var r=new ActionReference;r.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var t=executeActionGet(r);var a=1;if(hasBackground()){a=0}if(t.hasKey(stringIDToTypeID("targetLayers"))){t=t.getList(stringIDToTypeID("targetLayers"));var n=t.count;var e=new Array;for(var c=0;c<n;c++){e.push(t.getReference(c).getIndex()+a)}}else{var r=new ActionReference;r.putProperty(charIDToTypeID("Prpr"),charIDToTypeID("ItmI"));r.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));srs=hasBackground()?executeActionGet(r).getInteger(charIDToTypeID("ItmI"))-1:executeActionGet(r).getInteger(charIDToTypeID("ItmI"));e.push(srs)}return e}function getSibilings(){theSlIDX=getSelectedLayersIdx();var e=[];var t=[];for(a in theSlIDX){t.push(getParentIDXfor(theSlIDX[a]))}t=eliminateDuplicates(t);for(l in t){parent=t[l];count=getLayersNb();var n=0;if(parent==0){i=count}else{i=parent-1}if(!hasBackground()){n=1}x=0;y=0;r=0;for(i;i>=n;i--){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),i);var c=executeActionGet(ref);var o=c.getString(charIDToTypeID("Nm  "));var D=c.getEnumerationValue(stringIDToTypeID("layerSection"));D=typeIDToStringID(D);e.push(i);if(i==theSlIDX[l]){e.pop(1)}if(r!=0&&i!=theSlIDX[l]){e.pop(1)}if(D=="layerSectionStart"){x++}if(D=="layerSectionEnd"){y++;if(r==0){break}}r=x-y}}return e}function getSibilings1(){theSlIDX=getSelectedLayersIdx();var e=[];var t=[];count=getLayersNb();var a=0;var n=count;tempSibilings={};if(!hasBackground()){a=1}x=0;y=0;r=0;parent=[0];oldParent=0;whatSibilingsMatterO={};var o=[];e=[];for(n;n>=a;n--){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),n);var i=executeActionGet(ref);var D=i.getEnumerationValue(stringIDToTypeID("layerSection"));D=typeIDToStringID(D);cparent=parent[parent.length-1].toString();if(tempSibilings[cparent]==undefined){o=[]}else{o=tempSibilings[cparent]}o.push(n);tempSibilings[cparent]=o;if(D=="layerSectionStart"){parent.push(n)}if(D=="layerSectionEnd"){parent.pop(1)}if(n==theSlIDX[theSlIDX.length-1]){theSlIDX.pop(1);whatSibilingsMatterO[cparent]=cparent;tss1=tempSibilings[cparent];tss1.pop(1);tempSibilings[cparent]=tss1}}for(c in whatSibilingsMatterO){e=e.concat(tempSibilings[whatSibilingsMatterO[c]])}return e}function getStartIDXfor(e){xx=false;var r=getLayersNb();currINDEX=e;var t=currINDEX;var a=0;var n=0;var c=0;var o=0;for(t;t<=r;t++){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),t);var i=executeActionGet(ref);var D=i.getString(charIDToTypeID("Nm  "));var I=i.getInteger(stringIDToTypeID("layerID"));var T=i.getEnumerationValue(stringIDToTypeID("layerSection"));T=typeIDToStringID(T);var p=i.getInteger(stringIDToTypeID("visible"));if(T=="layerSectionEnd"){n++}if(T=="layerSectionStart"){c++}o=n-c;if(o==0&&T=="layerSectionStart"){a=t;break}}return a}function getVectorMaskDensity(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getInteger(sTID("vectorMaskDensity"))}function getVectorMaskFeather(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getUnitDoubleValue(sTID("vectorMaskFeather"))}function getVisible(e){try{var r=new ActionReference;if(typeof e=="number"){r.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){r.putName(s2t("layer"),e)}else{r.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}var t=executeActionGet(r).getInteger(s2t("visible"));return t}catch(e){}}function getVisibleforIDX(e){var r=new ActionReference;r.putIndex(charIDToTypeID("Lyr "),e);var t=executeActionGet(r).getInteger(stringIDToTypeID("visible"));return t}function groupSelected(e){var r=new ActionDescriptor;var t=new ActionReference;t.putClass(sTID("layerSection"));r.putReference(cTID("null"),t);var a=new ActionReference;a.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt"));r.putReference(cTID("From"),a);var n=new ActionDescriptor;n.putString(cTID("Nm  "),e);r.putObject(cTID("Usng"),sTID("layerSection"),n);executeAction(cTID("Mk  "),r,DialogModes.NO);return activeDocument.activeLayer}function hasBackground(){var e=undefined;try{var r=new ActionReference;r.putProperty(cTID("Prpr"),cTID("Nm  "));r.putIndex(cTID("Lyr "),0);executeActionGet(r).getString(cTID("Nm  "));e=true}catch(r){e=false}return e}function hasLayerMask(e){var r=new ActionReference;if(typeof e=="number"){r.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){r.putName(s2t("layer"),e)}else{r.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}var t=executeActionGet(r);return t.hasKey(cTID("Usrs"))}function hasVectorMask(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getBoolean(sTID("hasVectorMask"))}function hide(e){try{var r=new ActionDescriptor;var t=new ActionList;var a=new ActionReference;if(typeof e=="number"){a.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){a.putName(s2t("layer"),e)}else{a.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}t.putReference(a);r.putList(c2t("null"),t);executeAction(s2t("hide"),r,DialogModes.NO)}catch(e){}}function isEndOfSet(e){xx=false;ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),e);var r=executeActionGet(ref);var t=r.getString(charIDToTypeID("Nm  "));var a=r.getInteger(stringIDToTypeID("layerID"));var n=r.getEnumerationValue(stringIDToTypeID("layerSection"));n=typeIDToStringID(n);var c=r.getInteger(stringIDToTypeID("visible"));var o=new RegExp("^</Layer group");if(t.match(o)){if(n=="layerSectionEnd"){xx=true}}return xx}function isLayerFXVisible(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getBoolean(cTID("lfxv"))}function isLayerMaskEnabled(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getBoolean(cTID("UsrM"))}function isLayerMaskLinked(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getBoolean(cTID("Usrs"))}function isLayerSet(e){var r=stringIDToTypeID("layerSection");var t=new ActionReference;t.putProperty(charIDToTypeID("Prpr"),r);t.putIndex(charIDToTypeID("Lyr "),e);var a=executeActionGet(t);var n=a.getEnumerationValue(r);var c=typeIDToStringID(n);return c=="layerSectionStart"?true:false}function isLocked(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);a=r.getObjectValue(sTID("layerLocking"));return a.getBoolean(sTID("protectAll"))}function isSetOpened1(e){app.activeDocument.activeLayer=e;mb_Locked=isLocked();mb_visible=isVisible();if(mb_Locked==true){unlock()}xx=true;currSetIDX=getActiveLayerIndex();currSetIDX1=getActiveLayerIndex();if(!hasBackground()){currSetIDX1=currSetIDX1-1}addTempLayerSetIn(currSetIDX1);var r=getActiveLayerIndex();makeActiveByIndex(currSetIDX+2,false);if(r==getActiveLayerIndex()){xx=false}deleteTempLayerSetbyIdx(currSetIDX+1);if(mb_Locked==true){lock()}if(mb_visible==false){hide()}return xx}function isSetOpened2(e){var r=new ActionReference;r.putIndex(app.stringIDToTypeID("layer"),e);var t=executeActionGet(r);var a=t.getBoolean(app.stringIDToTypeID("layerSectionExpanded"));return a}function isVectorMaskEnabled(){var e=new ActionReference;e.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);if(r.hasKey(967)){alert("VE")}return r.getBoolean(967)}function isVectorMaskLinked(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);if(r.hasKey(968)){alert("VE")}return r.getBoolean(968)}function isVisible(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getBoolean(sTID("visible"))}function isVisibleIDX(e){var r=new ActionReference;r.putIndex(sTID("layer"),e);var t=executeActionGet(r);return t.getBoolean(sTID("visible"))}function loadSelectionOfMask(){const e=workingProfile_get("Gray");const r=doc.colorProfileName;gamma_L=["eciRGB v2","eciRGB v2 ICCv4"];gamma_18=["sRGB IEC61966-2.1","ProPhoto RGB","Display P3","image P3","Apple RGB","ColorMatch RGB"];gamma_22=["Adobe RGB (1998)","BestRGB","Beta RGB","DonRGB4.icm","MaxRGB","Russell RGB"];if(array_contains(gamma_18,r)){if(e!="Gray Gamma 1.8"){workingProfile_set("Gray","Gray Gamma 1.8")}}if(array_contains(gamma_22,r)){if(e!="Gray Gamma 2.2"){workingProfile_set("Gray","Gray Gamma 2.2")}}if(array_contains(gamma_L,r)){workingProfile_set("Gray","Gray-elle-V4-labl.icc")}if(!array_contains(gamma_18,r)&&!array_contains(gamma_22,r)&&!array_contains(gamma_L,r)){alert("Vorsicht\nDie Helligkeitsverteilung könnte fehlerhaft sein.\nfehlende Info zum Gamma von '"+r+"'")}selectLayerMask();var t=new ActionDescriptor;var a=new ActionReference;a.putProperty(cTID("Chnl"),cTID("fsel"));t.putReference(cTID("null"),a);var n=new ActionReference;n.putEnumerated(cTID("Chnl"),cTID("Ordn"),cTID("Trgt"));t.putReference(cTID("T   "),n);try{executeAction(cTID("setd"),t,DialogModes.NO)}catch(e){}if(e!=workingProfile_get("Gray")){workingProfile_set("Gray",e)}}function lock(){var e=charIDToTypeID("setd");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Lyr ");var c=charIDToTypeID("Ordn");var o=charIDToTypeID("Trgt");a.putEnumerated(n,c,o);r.putReference(t,a);var i=charIDToTypeID("T   ");var D=new ActionDescriptor;var I=stringIDToTypeID("layerLocking");var T=new ActionDescriptor;var p=stringIDToTypeID("protectAll");T.putBoolean(p,true);var I=stringIDToTypeID("layerLocking");D.putObject(I,I,T);var n=charIDToTypeID("Lyr ");r.putObject(i,n,D);executeAction(e,r,DialogModes.NO)}function loopParentsIDXfor(e){var r=new Array;var t=getLayersNb();var a=getParentIDXfor(e);for(k=0;k<t;k++){if(a!=0){r.push(a)}else{break}a=getParentIDXfor(a)}return r}function makeActiveByIndex(e,r){if(e.constructor!=Array)e=[e];for(var t=0;t<e.length;t++){var a=new ActionDescriptor;var n=new ActionReference;n.putIndex(charIDToTypeID("Lyr "),e[t]);a.putReference(charIDToTypeID("null"),n);if(t>0){var c=stringIDToTypeID("selectionModifier");var o=stringIDToTypeID("selectionModifierType");var i=stringIDToTypeID("addToSelection");a.putEnumerated(c,o,i)}a.putBoolean(charIDToTypeID("MkVs"),r);executeAction(charIDToTypeID("slct"),a,DialogModes.NO)}}function makeVisByIndex(e,r){if(r==true){var t=charIDToTypeID("Shw ")}else{var t=charIDToTypeID("Hd  ")}var a=new ActionDescriptor;var n=new ActionReference;n.putIndex(charIDToTypeID("Lyr "),e);a.putReference(charIDToTypeID("null"),n);executeAction(t,a,DialogModes.NO)}function makeVisible(e){try{var r=new ActionDescriptor;var t=new ActionList;var a=new ActionReference;if(typeof e=="number"){a.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){a.putName(s2t("layer"),e)}else{a.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}t.putReference(a);r.putList(c2t("null"),t);executeAction(s2t("show"),r,DialogModes.NO)}catch(e){}}function maskFromSelection(){if(!hasLayerMask()){var e=new ActionDescriptor;e.putClass(cTID("Nw  "),cTID("Chnl"));var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));e.putReference(cTID("At  "),r);e.putEnumerated(cTID("Usng"),cTID("UsrM"),cTID("RvlS"));try{executeAction(cTID("Mk  "),e,DialogModes.NO)}catch(e){activeDocument.selection.selectAll();maskFromSelection()}}else{if(confirm("Delete existing mask?",true,"Warning")){activateLayerMask();deleteMask()}}}function myselectNext(){currINDEX=getActiveLayerIndex();lastSetIdx=0;lastLayer=0;testIDX=1;if(hasBackground()){lastLayer=-1;testIDX=0}if(isLayerSet(currINDEX)){if(getNbOfChilds()>1){if(!isSetOpened2(currINDEX)){lastSetIdx=getLastChildIdx();currINDEX=lastSetIdx}}else{currINDEX=currINDEX-1}}nextIndex=currINDEX-1;if(nextIndex<=lastLayer){nextIndex=getLayersNb()}var e=new RegExp("^</Layer group");if(getLayerName(nextIndex).match(e)){bb=nextIndex-1;for(bb;bb>0;bb--){var e=new RegExp("^</Layer group");if(getLayerName(bb).match(e)){nextIndex--}else{break}}}try{makeActiveByIndex(nextIndex,false)}catch(e){}if(currINDEX!=testIDX){if(getActiveLayerIndex()==getLayersNb()){try{makeActiveByIndex(nextIndex-1,false)}catch(e){}}}}function myselectNextFor(e){for(i=0;i<e;i++){myselectNext()}}function myselectPrevious(){nbL=getLayersNb();currINDEX=getActiveLayerIndex();lastSetIdx=0;lastLayer=1;if(hasBackground()){lastLayer=0}if(currINDEX==nbL){nextIndex=lastLayer}else{nextIndex=currINDEX+1}b=getLayersNb();for(aa=0;aa<b;aa++){if(isEndOfSet(nextIndex)){parentIDX=getStartIDXfor(nextIndex);if(!isSetOpened2(parentIDX)){nextIndex=parentIDX}else{nextIndex++}}else{break}}try{makeActiveByIndex(nextIndex,false)}catch(e){}if(getActiveLayerIndex()==getLayersNb()){nextIndex++;try{makeActiveByIndex(nextIndex,false)}catch(e){}}}function openGroup1(e){currSetIDX=getActiveLayerIndex();if(isLayerSet(currSetIDX)){getNamesPlusIDsOfLayerSet()}makeActiveByIndex(currSetIDX,false)}function openGroup1byIDX(e){if(isLayerSet(e)){getNamesPlusIDsOfLayerSet()}makeActiveByIndex(e,false)}function pasteLayerStyle(){var e=charIDToTypeID("PaFX");var r=new ActionDescriptor;var t=stringIDToTypeID("allowPasteFXOnLayerSet");r.putBoolean(t,true);executeAction(e,r,DialogModes.NO)}function recreateVectorMask(){var e=charIDToTypeID("slct");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Path");a.putName(n,"mbTemp_path");r.putReference(t,a);executeAction(e,r,DialogModes.NO);var c=charIDToTypeID("Mk  ");var o=new ActionDescriptor;var t=charIDToTypeID("null");var i=new ActionReference;var n=charIDToTypeID("Path");i.putClass(n);o.putReference(t,i);var D=charIDToTypeID("At  ");var I=new ActionReference;var n=charIDToTypeID("Path");var n=charIDToTypeID("Path");var T=stringIDToTypeID("vectorMask");I.putEnumerated(n,n,T);o.putReference(D,I);var p=charIDToTypeID("Usng");var u=new ActionReference;var n=charIDToTypeID("Path");var s=charIDToTypeID("Ordn");var y=charIDToTypeID("Trgt");u.putEnumerated(n,s,y);o.putReference(p,u);executeAction(c,o,DialogModes.NO);var l=new ActionDescriptor;var v=new ActionReference;v.putName(charIDToTypeID("Path"),"mbTemp_path");l.putReference(charIDToTypeID("null"),v);executeAction(charIDToTypeID("Dlt "),l,DialogModes.NO)}function removeFromSel(e){var r=new ActionDescriptor;var t=new ActionReference;t.putIndex(charIDToTypeID("Lyr "),e);r.putReference(charIDToTypeID("null"),t);r.putEnumerated(stringIDToTypeID("selectionModifier"),stringIDToTypeID("selectionModifierType"),stringIDToTypeID("removeFromSelection"));var a=charIDToTypeID("MkVs");r.putBoolean(a,false);executeAction(charIDToTypeID("slct"),r,DialogModes.NO)}function selectLayerMask(){var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));e.putReference(cTID("null"),r);e.putBoolean(cTID("MkVs"),false);try{executeAction(cTID("slct"),e,DialogModes.NO)}catch(e){}}function selectOnlySibilings(){theSibilings=getSibilings1();try{makeActiveByIndex(theSibilings,false)}catch(e){}}function selectParent(){try{app.activeDocument.activeLayer=app.activeDocument.activeLayer.parent}catch(e){}}function setBackTheLayerMask(){var e=charIDToTypeID("Mk  ");var r=new ActionDescriptor;var t=charIDToTypeID("Nw  ");var a=charIDToTypeID("Chnl");r.putClass(t,a);var n=charIDToTypeID("At  ");var c=new ActionReference;var a=charIDToTypeID("Chnl");var a=charIDToTypeID("Chnl");var o=charIDToTypeID("Msk ");c.putEnumerated(a,a,o);r.putReference(n,c);var i=charIDToTypeID("Usng");var D=charIDToTypeID("UsrM");var I=charIDToTypeID("RvlA");r.putEnumerated(i,D,I);executeAction(e,r,DialogModes.NO);var T=cTID("slct");var p=new ActionDescriptor;var u=cTID("null");var s=new ActionReference;var a=cTID("Chnl");s.putName(a,"mbTemp_alpha");p.putReference(u,s);executeAction(T,p,DialogModes.NO);var y=cTID("setd");var l=new ActionDescriptor;var u=cTID("null");var v=new ActionReference;var a=cTID("Chnl");var f=cTID("fsel");v.putProperty(a,f);l.putReference(u,v);var h=cTID("T   ");var g=cTID("Ordn");var d=cTID("Al  ");l.putEnumerated(h,g,d);executeAction(y,l,DialogModes.NO);var A=cTID("copy");executeAction(A,undefined,DialogModes.NO);selectLayerMask();var m=new ActionDescriptor;var x=new ActionReference;x.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));m.putReference(cTID("null"),x);m.putBoolean(cTID("MkVs"),true);executeAction(cTID("slct"),m,DialogModes.NO);var L=charIDToTypeID("PstI");var S=new ActionDescriptor;var w=charIDToTypeID("AntA");var R=charIDToTypeID("Annt");var k=charIDToTypeID("Anno");S.putEnumerated(w,R,k);executeAction(L,S,DialogModes.NO);var O=new ActionDescriptor;var M=new ActionReference;M.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("RGB "));O.putReference(cTID("null"),M);O.putBoolean(cTID("MkVs"),false);executeAction(cTID("slct"),O,DialogModes.NO);var y=charIDToTypeID("setd");var b=new ActionDescriptor;var u=charIDToTypeID("null");var E=new ActionReference;var a=charIDToTypeID("Chnl");var f=charIDToTypeID("fsel");E.putProperty(a,f);b.putReference(u,E);var h=charIDToTypeID("T   ");var g=charIDToTypeID("Ordn");var N=charIDToTypeID("None");b.putEnumerated(h,g,N);executeAction(y,b,DialogModes.NO);var m=new ActionDescriptor;var x=new ActionReference;x.putName(charIDToTypeID("Chnl"),"mbTemp_alpha");m.putReference(charIDToTypeID("null"),x);executeAction(charIDToTypeID("Dlt "),m,DialogModes.NO)}function setColorTo(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("Clr ");var T=charIDToTypeID("Clr ");var p=charIDToTypeID(e);I.putEnumerated(T,T,p);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setMaskDensityTo(e){var r=new ActionDescriptor;var t=new ActionDescriptor;var a=new ActionReference;a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"));r.putReference(c2t("null"),a);t.putUnitDouble(s2t("userMaskDensity"),s2t("percentUnit"),e);r.putObject(s2t("to"),s2t("layer"),t);executeAction(s2t("set"),r,DialogModes.NO)}function setMaskEnabled(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("UsrM");I.putBoolean(T,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setMaskFeatherTo(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=stringIDToTypeID("userMaskFeather");var p=charIDToTypeID("#Prc");I.putUnitDouble(T,p,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setMaskLinked(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("Usrs");I.putBoolean(T,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setVectorMaskDensityTo(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=stringIDToTypeID("vectorMaskDensity");var p=charIDToTypeID("#Prc");I.putUnitDouble(T,p,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setVectorMaskEnabled(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("vectorMaskEnabled");I.putBoolean(T,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setVectorMaskFeatherTo(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=stringIDToTypeID("vectorMaskFeather");var p=charIDToTypeID("#Prc");I.putUnitDouble(T,p,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setVectorMaskLinked(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("vectorMaskLinked");I.putBoolean(T,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function showOnlyThis(){selectionIDX=getSelectedLayersIdx();setBack=false;var e=0;for(i=0;i<selectionIDX.length;i++){theParents=loopParentsIDXfor(selectionIDX[i]);for(par in theParents){if(!isVisibleIDX(theParents[par])){e++;selectionIDX.push(theParents[par])}}}if(selectionIDX.length>1){var r=charIDToTypeID("Shw ");var t=new ActionDescriptor;var n=charIDToTypeID("null");var c=new ActionList;var o=new ActionReference;var D=charIDToTypeID("Lyr ");var I=charIDToTypeID("Ordn");var T=charIDToTypeID("Trgt");o.putEnumerated(D,I,T);c.putReference(o);t.putList(n,c);var p=charIDToTypeID("TglO");t.putBoolean(p,true);executeAction(r,t,DialogModes.NO);if(setBack==false){for(i=0;i<selectionIDX.length;i++){makeVisByIndex(selectionIDX[i],true)}}else{for(a=0;a<selectionIDX.length;a++){}}}else{var r=charIDToTypeID("Shw ");var t=new ActionDescriptor;var n=charIDToTypeID("null");var c=new ActionList;var o=new ActionReference;var D=charIDToTypeID("Lyr ");var I=charIDToTypeID("Ordn");var T=charIDToTypeID("Trgt");o.putEnumerated(D,I,T);c.putReference(o);t.putList(n,c);var p=charIDToTypeID("TglO");t.putBoolean(p,true);executeAction(r,t,DialogModes.NO)}}function testSelectMultiple(e){makeActiveByIndex([e[0],e[1]],false);var r=new ActionReference;r.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var t=executeActionGet(r);if(t.hasKey(stringIDToTypeID("targetLayers"))){alert("targetLayers")}alert("startSelMult");var a=new ActionDescriptor;var n=new ActionReference;n.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var c=new ActionList;executeAction(charIDToTypeID("setd"),a,DialogModes.NO);alert("endSelMult")}function toogleOpenCloseSet(){app.activeDocument.suspendHistory("toogleOpenCloseSet","toogleOpenCloseSet_inner()")}function toogleOpenCloseSet_inner(){myALayerIDX=getActiveLayerIndex();myGroupP=app.activeDocument.activeLayer;if(!isLayerSet(myALayerIDX)){myGroupP=app.activeDocument.activeLayer.parent;try{app.activeDocument.activeLayer=myGroupP}catch(e){return}if(getNbOfChilds()>1){if(myGroupP.typename!="Document"){if(isSetOpened1(myGroupP)){closeGroup(myGroupP)}else{openGroup1(myGroupP)}}}}else{if(getNbOfChilds()>1){if(isSetOpened1(myGroupP)){closeGroup(myGroupP)}else{openGroup1(myGroupP)}}}}function toogleOpenCloseSet_byIDX(e){try{toogleOpenCloseSet_byIDX_inner(e)}catch(e){alert("toogleOpenCloseSet_byIDX: "+e)}}function toogleOpenCloseSet_byIDX_inner(e){try{gotoLayer(e);myALayerIDX=getActiveLayerIndex();myGroupP=app.activeDocument.activeLayer;if(!isLayerSet(myALayerIDX)){myGroupP=app.activeDocument.activeLayer.parent;try{app.activeDocument.activeLayer=myGroupP}catch(e){return}if(getNbOfChilds()>1){if(myGroupP.typename!="Document"){if(isSetOpened1(myGroupP)){closeGroup(myGroupP)}else{openGroup1(myGroupP)}}}}else{if(getNbOfChilds()>1){if(isSetOpened1(myGroupP)){closeGroup(myGroupP)}else{openGroup1(myGroupP)}}}}catch(e){alert("toogleOpenCloseSet_byIDX_inner: "+e)}}function toogleOpenCloseSet_byIDX_byArray(e){for(var r=0;r<e.length;r++){toogleOpenCloseSet_byIDX(e[r])}}function toogleVisibility(e){try{var r=new ActionDescriptor;var t=new ActionList;var a=new ActionReference;if(getVisible(e)){if(typeof e=="number"){a.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){a.putName(s2t("layer"),e)}else{a.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}t.putReference(a);r.putList(c2t("null"),t);executeAction(s2t("hide"),r,DialogModes.NO)}else{if(typeof e=="number"){a.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){a.putName(s2t("layer"),e)}else{a.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}t.putReference(a);r.putList(c2t("null"),t);executeAction(s2t("show"),r,DialogModes.NO)}}catch(e){alert("Error by toogleVisibility: "+e)}}function ungroup(){var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt"));e.putReference(cTID("null"),r);try{executeAction(sTID("ungroupLayersEvent"),e,DialogModes.NO)}catch(e){}}function unlock(){var e=charIDToTypeID("setd");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Lyr ");var c=charIDToTypeID("Ordn");var o=charIDToTypeID("Trgt");a.putEnumerated(n,c,o);r.putReference(t,a);var i=charIDToTypeID("T   ");var D=new ActionDescriptor;var I=stringIDToTypeID("layerLocking");var T=new ActionDescriptor;var p=stringIDToTypeID("protectNone");T.putBoolean(p,true);var I=stringIDToTypeID("layerLocking");D.putObject(I,I,T);var n=charIDToTypeID("Lyr ");r.putObject(i,n,D);executeAction(e,r,DialogModes.NO)}
    function DodgeBurn_highlow(e){createGroup("Tiefen","passThrough","gray",100,f),createLayer("Burn ▽","colorLookup","normal","gray",100,"black",f,f),LUT_burn(),blendif("current",0,0,0,255),createLayer("Dodge ▽","colorLookup","normal","gray",100,"black",f,f),LUT_dodge(),blendif("current",0,0,0,255),selectParent(),createGroup("Dodge & Burn △▽","passThrough","gray",100,t),createLayer("Burn △","colorLookup","normal","gray",100,"black",f,f),LUT_burn(),blendif("current",0,255,255,255),createGroup("Lichter","passThrough","gray",100,t),createLayer("Dodge △","colorLookup","normal","gray",100,"black",f,f),LUT_dodge(),blendif("current",0,255,255,255),selectParent(),selectParent(),e&&toogleOpenCloseSet()}function DodgeBurn_highmidlow(e){createGroup("Tiefen","passThrough","gray",100,f),createLayer("Burn ▽","colorLookup","normal","gray",100,"black",f,f),LUT_burn(),blendif("current",0,0,0,255),createLayer("Dodge ▽","colorLookup","normal","gray",100,"black",f,f),LUT_dodge(),blendif("current",0,0,0,255),selectParent(),createGroup("Dodge & Burn △◊▽","passThrough","gray",100,t),createLayer("Burn ⬨","colorLookup","normal","gray",100,"black",f,f),LUT_burn(),blendif("current",20,202,109,240),createGroup("Mitten","passThrough","gray",100,t),createLayer("Dodge ⬨","colorLookup","normal","gray",100,"black",f,f),LUT_dodge(),blendif("current",20,202,109,240),selectParent(),selectParent(),createLayer("Burn △","colorLookup","normal","gray",100,"black",f,f),LUT_burn(),blendif("current",0,255,255,255),createGroup("Lichter","passThrough","gray",100,t),createLayer("Dodge △","colorLookup","normal","gray",100,"black",f,f),LUT_dodge(),blendif("current",0,255,255,255),selectParent(),selectParent(),e&&toogleOpenCloseSet()}function burn(){createLayer("Burn","colorLookup","normal","gray",100,"black",f,f),LUT_burn()}function dodge(){createLayer("Dodge","colorLookup","normal","gray",100,"black",f,f),LUT_dodge()}function dodgeburn(){createGroup("Dodge & Burn","passThrough","gray",100,f),createLayer("Burn","colorLookup","normal","gray",100,"black",f,f),LUT_burn(),createLayer("Dodge","colorLookup","normal","gray",100,"black",f,f),LUT_dodge()}function dodgeburn_mid(){createGroup("Dodge & Burn ⬨","passThrough","gray",100,f),createLayer("Burn ⬨","colorLookup","normal","gray",100,"black",f,f),LUT_burn(),blendif("current",20,202,109,240),createLayer("Dodge ⬨","colorLookup","normal","gray",100,"black",f,f),LUT_dodge(),blendif("current",20,202,109,240)}function dodgeburn_toggle(){try{var e=doc.activeLayer,r=getActiveLayerIndex();e.kind==LayerKind.COLORLOOKUP&&(/burn/i.test(e.name)?(selectLayer("up",1),/dodge/i.test(doc.activeLayer.name)||(gotoLayer(r),selectLayer("down",1),/dodge/i.test(doc.activeLayer.name)||gotoLayer(r))):/dodge/i.test(e.name)&&(selectLayer("down",1),/burn/i.test(doc.activeLayer.name)||(gotoLayer(r),selectLayer("up",1),/burn/i.test(doc.activeLayer.name)||gotoLayer(r))))}catch(e){}}function freisteller_allHG(){for(var e=app.activeDocument,r=app.foregroundColor,t=r.hsb.hue,a=r.hsb.saturation,o=r.hsb.brightness,n=0;n<app.documents.length;n++){app.activeDocument=app.documents[n];app.activeDocument;try{if(app.activeDocument.layers.getByName("Freisteller helper"))try{var i=layer_selectedIDX_get();gotoLayer("Freisteller helper"),layer_getSolidFillColor()[0]==app_getForegroundColor()[0]?layer_getSolidFillColor()[1]==app_getForegroundColor()[1]&&layer_getSolidFillColor()[2]==app_getForegroundColor()[2]&&(isVisible()?hide():makeVisible()):layer_solidColorHSB_change(t,a,o),layer_selectedIDX_set(i)}catch(e){}}catch(e){}}app.activeDocument=e}function freisteller_button(){var e=layer_selectedIDX_get();start_closedSets=[];var r=!1;if(getMeta_3("isWoodwing"))r=Boolean(getMeta_3("isWoodwing"));try{if(app.activeDocument.layerSets.getByName("Freisteller"))try{r?alert("ist schon als Freisteller angelegt"):(app.activeDocument.suspendHistory("Freisteller SaveRGB","freisteller_saveRGB()"),app.activeDocument.save())}catch(e){alert(e)}}catch(e){app.activeDocument.suspendHistory("Freisteller-Gruppe","freisteller_createGroup()");try{if(r){if(app.activeDocument.suspendHistory("getClosedSets","var start_closedSets = getClosedSets()"),getMeta_3("woodwing_RGB"))var a=getMeta_3("woodwing_RGB");if(getMeta_3("woodwing_file"))var o=getMeta_3("woodwing_file");if(getMeta_3("idDocName"))var n=getMeta_3("idDocName");BridgeTalkMessage_openDocID(n,o,!1),replaceMeta_3_suffix("woodwing_file","jpg","psd"),replaceMeta_3_suffix("woodwing_RGB","jpg","psd"),app.activeDocument.suspendHistory("Freisteller: 2 Ebenen","freisteller_reduce2layers()"),saveMultiformat(new File(a),"psd",t,null,f,t),undoSteps(1),replaceMeta_3_suffix("woodwing_file","jpg","psd"),replaceMeta_3_suffix("woodwing_RGB","jpg","psd")}else app.activeDocument.suspendHistory("Freisteller SaveRGB","freisteller_saveRGB()"),app.activeDocument.save()}catch(e){}}app.activeDocument.suspendHistory("toogleOpenCloseSet_byArray_loop","toogleOpenCloseSet_byArray_loop(start_closedSets)"),layer_selectedIDX_set(e)}function toogleOpenCloseSet_byArray_loop(e){for(var r=0;r<e.length;r++)try{if(gotoLayer(e[r]),myALayerIDX=getActiveLayerIndex(),myGroupP=app.activeDocument.activeLayer,isLayerSet(myALayerIDX))getNbOfChilds()>1&&(isSetOpened1(myGroupP)?closeGroup(myGroupP):openGroup1(myGroupP));else{myGroupP=app.activeDocument.activeLayer.parent;try{app.activeDocument.activeLayer=myGroupP}catch(e){return}getNbOfChilds()>1&&"Document"!=myGroupP.typename&&(isSetOpened1(myGroupP)?closeGroup(myGroupP):openGroup1(myGroupP))}}catch(e){alert("toogleOpenCloseSet_byArray_loop: "+e)}}function closeDoc(e){try{app.documents.getByName(decodeURI(e)).close(SaveOptions.DONOTSAVECHANGES)}catch(r){ssDebug&&alert("closeDoc: "+e+" :--: "+r)}}function BridgeTalkMessage_openDocID(e,r,t){var a=new BridgeTalk;a.target="indesign",a.body=runID.toSource()+"('"+e+"','"+r+"','"+t+"');",a.onResult=function(e){},a.send(10)}function runID(e,r,t){try{if(function(e){for(var r=!1,t=0;t<app.documents.length;t++)if(-1!==app.documents[t].name.indexOf(e)){r=!0,app.activeDocument=app.documents[t];break}return r}(e))app.activeDocument.links.itemByName(r).editOriginal();else alert("kein Focus auf der Datei?")}catch(e){}return" "}function freisteller_createGroup(){var e=layer_selectedIDX_get();selectLayers("selectAllLayers"),createGroup("Freisteller","passThrough","none",100,t);try{isSelectionActive()&&maskFromSelection()}catch(e){}toogleOpenCloseSet();var r=app.activeDocument.layerSets.getByName("Freisteller");createColorLayer("Freisteller helper","normal","none",100,"none",128,128,128),hide(),app.activeDocument.activeLayer.move(r,ElementPlacement.PLACEAFTER),layer_selectedIDX_set(e)}function freisteller_deFrei(){try{if(app.activeDocument.layerSets.getByName("Freisteller")){var e=layer_selectedID_get();try{var r=!1;if(getMeta_3("isWoodwing"))r=Boolean(getMeta_3("isWoodwing"));try{gotoLayer("Freisteller"),ungroup(),gotoLayer("Freisteller helper"),deleteActiveLayer()}catch(e){}if(r){if(getMeta_3("woodwing_RGB"))var a=getMeta_3("woodwing_RGB");if(getMeta_3("woodwing_file"))var o=getMeta_3("woodwing_file");if(getMeta_3("idDocName"))var n=getMeta_3("idDocName");BridgeTalkMessage_openDocID(n,o,!1),replaceMeta_3_suffix("woodwing_file","psd","jpg"),replaceMeta_3_suffix("woodwing_RGB","psd","jpg"),saveMultiformat(new File(a),"jpg",t,RZ_qualityJPG,f,f)}else{var i=new Folder(doc.path),l=GetFileNameOnly(doc.name),c=/(?:\.([^.]+))?$/.exec(doc.name)[1],s=new File(i+"/"+l+"-frei."+c);s.exists&&s.remove()}}catch(e){alert(e)}layer_selectedID_set(e)}}catch(e){return alert("Abbruch!\nkeine Ebene names 'Freisteller' gefunden\n"+e),!1}}function BridgeTalkMessage_openDocID(e,r,t){var a=new BridgeTalk;a.target="indesign",a.body=runID.toSource()+"('"+e+"','"+r+"','"+t+"');",a.onResult=function(e){},a.send(10)}function runID(e,r,t){try{if(function(e){for(var r=!1,t=0;t<app.documents.length;t++)if(-1!==app.documents[t].name.indexOf(e)){r=!0,app.activeDocument=app.documents[t];break}return r}(e))app.activeDocument.links.itemByName(r).editOriginal();else alert("kein Focus auf der Datei?")}catch(e){}return" "}function freisteller_reduce2layers(){try{doc.layers.getByName("Freisteller helper")&&hide("Freisteller helper")}catch(e){}try{selectLayers("selectAllLayers"),selectLayerBySelector("Freisteller","remove"),layer_mergeLayers(),layer_makeBackground(),dublicate("frei"),gotoLayer("Freisteller"),fixMask(getActiveLayerIndex(),1);var e=getMaskVisibility();loadSelectionOfMask(),gotoLayer("frei");try{isSelectionActive()&&maskFromSelection()}catch(e){}layer_delete("Freisteller"),e?(makeVisible("frei"),hide(0),gotoLayer("frei")):(makeVisible(0),hide("frei"),gotoLayer(0))}catch(e){alert("Error freisteller_reduce2layers: \n"+e)}}function freisteller_saveRGB(){var e=layer_selectedIDX_get(),r=null;if(gotoLayer("Freisteller"),hasLayerMask()){var a=getMaskVisibility();if(setMaskVisibility(!0),"Freisteller helper"==getLayerName(1)){r=isVisibleIDX(1);makeVisByIndex(1,!1)}var o=app.activeDocument.path+"/"+GetFileNameOnly(app.activeDocument.name)+"-frei";savePSD_v2(new File(o),t,t,t,f),setMaskVisibility(!1),null!=r&&makeVisByIndex(1,r),setMaskVisibility(a)}layer_selectedIDX_set(e)}function himmelmaske(e,r){var t=layer_selectedIDX_get();cancel=!1,selection_loop((function(){select_sky(!1)})),cancel||("Selection"==r?(layer_selectedIDX_set(t),"nicht Himmel"==e&&select_invert()):(gotoLayer(t[t.length-1]),selection2mask(e),"nicht Himmel"==e&&(gotoMask(),invert(),gotoFill())))}function motivmaske(e,r){var t=layer_selectedIDX_get();cancel=!1,selection_loop((function(){select_motiv()})),cancel||("Selection"==r?(layer_selectedIDX_set(t),"nicht Motiv"==e&&select_invert()):(gotoLayer(t[t.length-1]),selection2mask(e),"nicht Motiv"==e&&(gotoMask(),invert(),gotoFill())))}function startschuss(e,r){debug&&time_start(),indexcolor2rgb(),noProfile(),gray2rgb(),cmyk2rgb(),sRGB2eciRGB(),8!=getBitDepth()&&dialog_bitdepth(),debug&&alert("imageDimension"+String.fromCharCode(13)+"[0] top_distance: "+e[0]+String.fromCharCode(13)+"[1] right_distance: "+e[1]+String.fromCharCode(13)+"[2] bottom_distance: "+e[2]+String.fromCharCode(13)+"[3] left_distance: "+e[3]+String.fromCharCode(13)+"[4] outer_width: "+e[4]+String.fromCharCode(13)+"[5] outer_height: "+e[5]+String.fromCharCode(13)+"[6] inner_width: "+e[6]+String.fromCharCode(13)+"[7] inner_height: "+e[7]+String.fromCharCode(13)+"[8] outerTL: "+e[8]+String.fromCharCode(13)+"[9] outerTR: "+e[9]+String.fromCharCode(13)+"[10] outerBR: "+e[10]+String.fromCharCode(13)+"[11] outerBL: "+e[11]+String.fromCharCode(13)+"[12] outerTL: "+e[12]+String.fromCharCode(13)+"[13] outerTR: "+e[13]+String.fromCharCode(13)+"[14] outerBR: "+e[14]+String.fromCharCode(13)+"[15] outerBL: "+e[15]+String.fromCharCode(13)+"[16] innerTL: "+e[16]+String.fromCharCode(13)+"[17] innerTR: "+e[17]+String.fromCharCode(13)+"[18] innerBR: "+e[18]+String.fromCharCode(13)+"[19] innerBL: "+e[19]+String.fromCharCode(13)+"[20] innerTL: "+e[20]+String.fromCharCode(13)+"[21] innerTR: "+e[21]+String.fromCharCode(13)+"[22] innerBR: "+e[22]+String.fromCharCode(13)+"[23] innerBL: "+e[23]+String.fromCharCode(13)+"[24] orientation: "+e[24]+String.fromCharCode(13)+"[25] distance_topL: "+e[25]+String.fromCharCode(13)+"[26] distance_topR: "+e[26]+String.fromCharCode(13)+"[27] distance_rightT:"+e[27]+String.fromCharCode(13)+"[28] distance_rightB:"+e[28]+String.fromCharCode(13)+"[29] distance_bottomR:"+e[29]+String.fromCharCode(13)+"[30] distance_bottomL:"+e[30]+String.fromCharCode(13)+"[31] distance_leftB:"+e[31]+String.fromCharCode(13)+"[32] distance_leftT:"+e[32]+String.fromCharCode(13)+"[33] _image.rotationAngle:"+e[33]+String.fromCharCode(13)+"[34] Druckbogen TL x-Achse: "+e[34]+String.fromCharCode(13)+"[35] Druckbogen TL y-Achse:"+e[35]+String.fromCharCode(13)+"[36] Druckbogen BR x-Achse - Höhe:"+e[36]+String.fromCharCode(13)+"[37] Druckbogen BR y-Achse - Breite:"+e[37]+String.fromCharCode(13)+"[38] spreadMoveX:"+e[38]+String.fromCharCode(13)+"[39] spreadMoveY:"+e[39]+String.fromCharCode(13)+"[40] Breite des Druckbogens:"+e[40]+String.fromCharCode(13)+"[41] Höhe des Druckbogens:"+e[41]+String.fromCharCode(13)+"[42] pageMoveX:"+e[42]+String.fromCharCode(13)+"[43] pageMoveY:"+e[43]);try{if(void 0!==r&&null!=r&&null!=r.length&&r.length>0&&r[0][0])for(var a=0;a<r.length;a++){var o=r[a];if(hasBackground())n=o[1];else var n=o[1]+=1;var i=o[0],l=getLayerName(n),c=o[2],s=o[3];c!=s&&i==l&&(s?makeVisible(n):hide(n))}}catch(e){debug&&alert("Error startschuss layerOptions: "+e)}try{"undefined"!=typeof myPsDoc&&setSize("width",e[6],"points")}catch(e){debug&&alert("error startschuss setSize: "+e)}try{if(hasBackground()&&0!=getActiveLayerIndex()){var d=doc.activeLayer.name;gotoLayer(0),nameLayer("HG"),gotoLayer(d);d=""}}catch(e){debug&&alert("error startschuss hasBackground: "+e)}nameLayer("Original");try{void 0!==e&&(0===e[0]&&0===e[1]&&0===e[2]&&0===e[3]||(0===e[3]&&0===e[0]||k(e[3],e[0],Units.POINTS,AnchorPosition.BOTTOMRIGHT),0===e[1]&&0===e[2]||k(e[1],e[2],Units.POINTS,AnchorPosition.TOPLEFT),createColorLayer("Anbau","normal","none",100,"none",128,128,128),moveLayer3("down",1),selectLayers("selectAllLayers")))}catch(e){debug&&alert(alert("error startschuss _imageDimension: "+e))}selectLayers("selectAllLayers"),smartObject(),nameLayer("Original"),createGroup("vorher","passThrough","none",100,t),dublicate("nachher"),gotoLayer("vorher"),selectLayer("down",1),nameLayer("vorher Ebene"),rasterSmartObject(),toogleOpenCloseSet(),selectLayer("up",1),createColorLayer("Weiss","normal","none",100,"none",255,255,255),moveLayer("Weiss","Original","down"),createGroup("Einstellungen","passThrough","none",100,f),createLayer("AutoTonwert","levels","normal","gray",100,"none",f,t),toogleVisibility(),createLayer("Gradation neutral","curves","normal","gray",100,"none",f,f),DodgeBurn_highmidlow(!0),selectLayer("up",1),createLayer("Selektive Farbe","selectiveColor","normal","violet",100,"",f,f),createLayer("Sättigung Farbe","hueSaturation","normal","blue",100,"",f,f),createLayer("Sättigung Luminanz","hueSaturation","luminosity","green",100,"",f,f),createLayer("Farbe in Balance","colorBalance","normal","yellowColor",100,"",f,f),createLayer("Gradation Kontrast","curves","normal","orange",100,"",f,f),createLayer("Dynamik","vibrance","normal","red",100,"",f,f);try{if(void 0!==e){startRulerUnits=app.preferences.rulerUnits,app.preferences.rulerUnits=Units.POINTS,createGroup("Layout","passThrough","none",100,f),layer_shape_create("rectangle",0,0,e[5]/doc.height.value*100,e[4]/doc.width.value*100,!1,[255,255,255],!0,[0,255,255],2,"strokeStyleAlignOutside");var g=-1*(m=e[16],_=e[20],h=e[17],L=e[21],v=L-_,C=h-m,Math.atan2(v,C)*(180/Math.PI)),u=-1*e[32]+e[3],y=-1*e[25]+e[0];if(6==e[24])g=g+90;if(8==e[24])g=g-90;if(0!=e[33])g=g-e[33];layer_transform("topleft",0,0,void 0,void 0,void 0,t,"distanceUnit",g),layer_transform("midcenter",u,y,void 0,void 0,void 0,t,"distanceUnit",0);var p=Math.round(100*g)/100;try{p=p.replace(".",",")}catch(e){}nameLayer("Beschnitt ["+p+"°]"),layer_shape_create("rectangle",0,0,e[41]/doc.height.value*100,e[40]/doc.width.value*100,!1,[255,255,255],!0,[255,0,255],2,"strokeStyleAlignOutside"),layer_transform("topleft",0,0,void 0,void 0,void 0,t,"distanceUnit",g),layer_transform("midcenter",e[37]/-2+-1*e[39]+(e[37]/2+e[42]),e[36]/-2+-1*e[38]+(e[36]/2+e[43]),void 0,void 0,void 0,t,"distanceUnit",0),nameLayer("Ansicht ["+p+"°]"),toogleOpenCloseSet(),moveLayer("Layout","Einstellungen","up"),app.preferences.rulerUnits=startRulerUnits}}catch(e){}var m,_,h,L,v,C;function k(e,r,t,a){startRulerUnits=app.preferences.rulerUnits,app.preferences.rulerUnits=t;var o=doc.width.value+e,n=doc.height.value+r;doc.resizeCanvas(o,n,a),app.preferences.rulerUnits=startRulerUnits}gotoLayer("Gradation neutral"),debug&&time_stop(start)}function tiefenmaske(e,r,t){var a=layer_selectedIDX_get();if(cancel=!1,e)layer_mergeVisible(e);else{if("LayerKind.SMARTOBJECT"!=doc.activeLayer.kind&&"LayerKind.NORMAL"!=doc.activeLayer.kind)return void alert("Abruch\n Eine Tiefenmakse von dieser Ebene kann nciht erstellt werden.");layer_copyLayers(),"LayerKind.SMARTOBJECT"==doc.activeLayer.kind&&rasterSmartObject(),layer_selectedIDX_get().length>1&&layer_mergeLayers()}nameLayer("helper__depthMask_image");for(var o=hasBackground()?0:1;layer_checkExistence(o);)o++;moveLayer("helper__depthMask_image",parseInt(o-1),"up"),gotoLayer("helper__depthMask_image"),selection_loop((function(){neural_depthmap2()})),nameLayer("layer__depthMask_map"),select_luminance(),layer_delete(),gotoLayer("helper__depthMask_image"),layer_delete(),cancel||("Selection"==t?(layer_selectedIDX_set(a),"nicht Tiefe"==r&&select_invert()):(gotoLayer(a[a.length-1]),selection2mask(r),"nicht Tiefe"==r&&(gotoMask(),invert(),gotoFill())))}function tiefenmakse_part1(e){layer_selectedIDX_get();if(e||layer_selectedIDX_get().length>1){e?layer_mergeVisible(e):(layer_copyLayers(),layer_mergeLayers()),nameLayer("helper__depthMask_image");for(var r=hasBackground()?0:1;layer_checkExistence(r);)r++;moveLayer("helper__depthMask_image",parseInt(r-1),"up"),gotoLayer("helper__depthMask_image")}else{for(layer_checkExistence(layer_getIDXbyString("Original")[0])?gotoLayer("Original"):gotoLayer(layer_selectedIDX_get()[layer_selectedIDX_get().length-1]);doc.activeLayer.kind!=LayerKind.NORMAL;)gotoLayer(getActiveLayerIndex()-1);doc.activeLayer.kind!=LayerKind.SmartObject&&(executeAction(sTID("copyToLayer"),void 0,DialogModes.NO),nameLayer("helper__depthMask_image"))}}function tiefenmakse_part2(e){nameLayer("layer__depthMask_map"),select_luminance(),layer_delete(),gotoLayer("helper__depthMask_image"),layer_delete(),createGroup("Tiefe","passThrough","none",100,f),maskFromSelection(),layer_checkExistence(layer_getIDXbyString("Dodge & Burn △◊▽")[0])&&moveLayer("Tiefe","Dodge & Burn △◊▽","up"),gotoLayer("Tiefe")}
    function SaveForWeb(t,e,n,c,o,a,p,s,i,r,u,l,S,C,m,v){var d=new ActionDescriptor,O=new ActionDescriptor,E=new ActionDescriptor,T=new ActionDescriptor,D=new ActionDescriptor,h=new ActionDescriptor,A=new ActionDescriptor,I=new ActionDescriptor,f=new ActionDescriptor,g=new ActionDescriptor,B=new ActionDescriptor,b=new ActionDescriptor,N=new ActionDescriptor,w=new ActionDescriptor,P=new ActionDescriptor,y=new ActionDescriptor,M=new ActionDescriptor,F=new ActionList,j=new ActionList;O.putEnumerated(c2t("Op  "),c2t("SWOp"),c2t("OpSa")),O.putBoolean(c2t("DIDr"),!0),O.putPath(s2t("in"),new File(e)),function(t,e){if("JPEG"==t||"JPG"==t)var n="jpg";else if("PNG8"==t||"PN24"==t)n="png";var c=e+"."+n;O.putString(c2t("ovFN"),decodeURIComponent(c))}(t,n),O.putEnumerated(s2t("format"),c2t("IRFm"),c2t(t)),O.putBoolean(s2t("interfaceIconFrameDimmed"),o),"JPEG"==t?(O.putInteger(s2t("quality"),S),O.putInteger(c2t("QChS"),0),O.putInteger(c2t("QCUI"),0),O.putBoolean(c2t("QChT"),!1),O.putBoolean(c2t("QChV"),!1),O.putBoolean(s2t("optimized"),C),m?O.putInteger(c2t("Pass"),3):O.putInteger(c2t("Pass"),1),O.putDouble(s2t("blur"),v)):(t="PNG8")?(O.putEnumerated(c2t("RedA"),c2t("IRRd"),c2t("Prcp")),O.putBoolean(c2t("RChT"),!1),O.putBoolean(c2t("RChV"),!1),O.putBoolean(c2t("AuRd"),!1),O.putInteger(c2t("NCol"),256),O.putInteger(c2t("DChS"),0),O.putInteger(c2t("DCUI"),0),O.putBoolean(c2t("DChT"),!1),O.putBoolean(c2t("DChV"),!1),O.putInteger(c2t("WebS"),0),O.putEnumerated(c2t("TDth"),c2t("IRDt"),s2t("none")),O.putInteger(c2t("TDtA"),100),O.putBoolean(s2t("transparency"),!0),O.putEnumerated(s2t("dither"),c2t("IRDt"),s2t("none")),O.putInteger(s2t("ditherAmount"),100)):"PN24"==t&&O.putBoolean(s2t("transparency"),!0),O.putBoolean(c2t("Mtt "),s),O.putBoolean(c2t("EICC"),p),O.putInteger(c2t("MttR"),i),O.putInteger(c2t("MttG"),r),O.putInteger(c2t("MttB"),u),c&&(O.putUnitDouble(c2t("HScl"),s2t("percentUnit"),c),O.putUnitDouble(c2t("VScl"),s2t("percentUnit"),c)),O.putBoolean(c2t("SHTM"),!1),O.putBoolean(c2t("SImg"),!0),O.putEnumerated(c2t("SWsl"),c2t("STsl"),c2t("SLAl")),a?O.putEnumerated(c2t("SWch"),c2t("STch"),c2t("CHsR")):O.putEnumerated(c2t("SWch"),c2t("STch"),c2t("CHDc")),function(t){if("Meta_no"==t)var e="MDNn";else if("Meta_Copyright"==t||"Meta_c"==t)e="MDCp";else if("Meta_CopyrightKontakt"==t||"Meta_ck"==t)e="MDCC";else if("Meta_all_noKameraInfo"==t||"Meta_all_no"==t)e="MDAx";else if("Meta_all"==t)e="MDAl";else e="MDNn";O.putEnumerated(c2t("SWmd"),c2t("STmd"),c2t(e))}(l),O.putBoolean(c2t("ohXH"),!1),O.putBoolean(c2t("ohIC"),!0),O.putBoolean(c2t("ohAA"),!0),O.putBoolean(c2t("ohQA"),!0),O.putBoolean(c2t("ohCA"),!1),O.putBoolean(c2t("ohIZ"),!0),O.putEnumerated(c2t("ohTC"),c2t("SToc"),c2t("OC03")),O.putEnumerated(c2t("ohAC"),c2t("SToc"),c2t("OC03")),O.putInteger(c2t("ohIn"),-1),O.putEnumerated(c2t("ohLE"),c2t("STle"),c2t("LE03")),O.putEnumerated(c2t("ohEn"),c2t("STen"),c2t("EN00")),O.putBoolean(c2t("olCS"),!1),O.putEnumerated(c2t("olEC"),c2t("STst"),c2t("ST00")),O.putEnumerated(c2t("olWH"),c2t("STwh"),c2t("WH01")),O.putEnumerated(c2t("olSV"),c2t("STsp"),c2t("SP04")),O.putEnumerated(c2t("olSH"),c2t("STsp"),c2t("SP04")),E.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC00")),F.putObject(c2t("SCnc"),E),T.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC19")),F.putObject(c2t("SCnc"),T),D.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC28")),F.putObject(c2t("SCnc"),D),h.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC24")),F.putObject(c2t("SCnc"),h),A.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC24")),F.putObject(c2t("SCnc"),A),I.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC24")),F.putObject(c2t("SCnc"),I),O.putList(c2t("olNC"),F),O.putBoolean(c2t("obIA"),!1),O.putString(c2t("obIP"),""),O.putEnumerated(c2t("obCS"),c2t("STcs"),c2t("CS01")),f.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC01")),j.putObject(c2t("SCnc"),f),g.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC20")),j.putObject(c2t("SCnc"),g),B.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC02")),j.putObject(c2t("SCnc"),B),b.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC19")),j.putObject(c2t("SCnc"),b),N.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC06")),j.putObject(c2t("SCnc"),N),w.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC24")),j.putObject(c2t("SCnc"),w),P.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC24")),j.putObject(c2t("SCnc"),P),y.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC24")),j.putObject(c2t("SCnc"),y),M.putEnumerated(c2t("ncTp"),c2t("STnc"),c2t("NC22")),j.putObject(c2t("SCnc"),M),O.putList(c2t("ovNC"),j),O.putBoolean(c2t("ovCM"),!1),O.putBoolean(c2t("ovCW"),!1),O.putBoolean(c2t("ovCU"),!0),O.putBoolean(c2t("ovSF"),!0),O.putBoolean(c2t("ovCB"),!0),O.putString(c2t("ovSN"),"images"),d.putObject(s2t("using"),s2t("SaveForWeb"),O),executeAction(s2t("export"),d,DialogModes.NO)}function saveAllDocs(){if(app.documents.length>0){var t=app.activeDocument,e=app.documents;for(var n=0;n<e.length;n++){var c=e[n];app.activeDocument=c;var o=c.name;if(-1!=o.indexOf("."))o.match(/(.*)\.[^\.]+$/)[1];else;try{c.path;0==c.saved&&(startDisplayDialogs=app.displayDialogs,app.displayDialogs=DialogModes.NO,c.save(),app.displayDialogs=startDisplayDialogs)}catch(t){alert("noch nie gespeichert")}}app.activeDocument=t}}function saveFile(t){doc.saveAs(newFilePath,t,!0,Extension.LOWERCASE)}function saveFile_JPG(t,e,n,c){saveOptions=new JPEGSaveOptions,saveOptions.quality=t,saveOptions.embedColorProfile=e,saveOptions.formatOptions=FormatOptions.OPTIMIZEDBASELINE,saveOptions.formatOptions==FormatOptions.PROGRESSIVE&&(saveOptions.scans=3),saveOptions.matte=MatteType.WHITE,saveFile(saveOptions)}function saveFile_PSD(t,e,n,c,o,a,p){saveOptions=new PhotoshopSaveOptions,saveOptions.alphaChannels=n,saveOptions.annotations=c,saveOptions.embedColorProfile=o,saveOptions.layers=a,saveOptions.spotColors=p,doc.saveAs(t,saveOptions,e,Extension.LOWERCASE)}function saveFile_TIF(){saveOptions=new TiffSaveOptions,saveOptions.embedColorProfile=!0,saveOptions.alphaChannels=!1,saveOptions.layers=!1,saveOptions.byteOrder=ByteOrder.IBM,saveOptions.annotations=!1,saveOptions.transparency=!0,saveOptions.imageCompression=TIFFEncoding.TIFFLZW,saveFile(saveOptions)}function saveFile_v2(t,e,n){doc.saveAs(t,e,n,Extension.LOWERCASE)}function saveMultiformat(t,e,n,c,o,a){if("tif"==e)(p=new TiffSaveOptions).alphaChannels=o,p.byteOrder=ByteOrder.IBM,p.embedColorProfile=!0,p.imageCompression=TIFFEncoding.TIFFLZW,p.layers=a,p.spotColors=!1,p.transparency=!0,p.annotations=!1;else if("jpg"==e){(p=new JPEGSaveOptions).embedColorProfile=!0,p.formatOptions=FormatOptions.STANDARDBASELINE,p.matte=MatteType.WHITE,p.quality=c}else if("psd"==e){(p=new PhotoshopSaveOptions).alphaChannels=o,p.annotations=!1,p.embedColorProfile=!0,p.layers=a,p.spotColors=!1}else if("png"==e){var p;(p=new PNGSaveOptions).compression=0,p.interlaced=!1}try{saveFile_v2(t,p,n)}catch(t){alert("Error saveMultiformat: \n"+t)}}function savePSD_v2(t,e,n,c,o){var a=new ActionDescriptor,p=new ActionDescriptor;p.putBoolean(s2t("maximizeCompatibility"),n),a.putObject(s2t("as"),s2t("photoshop35Format"),p),a.putPath(s2t("in"),t),a.putBoolean(s2t("copy"),e),a.putBoolean(s2t("lowerCase"),c),a.putBoolean(s2t("layers"),o),a.putEnumerated(s2t("saveStage"),s2t("saveStageType"),s2t("saveSucceeded")),executeAction(s2t("save"),a,DialogModes.NO)}
    function checkTiefenLichter_create(e){var t=getLayerName(getActiveLayerIndex());if(createGroup("check "+e,"passThrough","none",100,f),createColorLayer("Tiefen_check","normal","none",100,"none",0,0,255),blendif("current",0,0,0+e,0+e),createColorLayer("Lichter_check","normal","none",100,"none",255,0,0),blendif("current",255-e,255-e,255,255),gotoLayer("check "+e),toogleOpenCloseSet(),layer_checkExistence("nachher"))moveLayer("check "+e,"nachher","up"),gotoLayer("check "+e),moveLayer3("down",1);else{for(var r=hasBackground()?0:1;layer_checkExistence(r);)r++;moveLayer("check "+e,parseInt(r-1),"up")}gotoLayer(t)}function checkTiefenLichter_create_button(e){try{if(layer_checkExistenceByRegex("check "))toogleVisibility("check ");else try{doc.suspendHistory("Create checkTiefenLichter","checkTiefenLichter_create("+e+")")}catch(e){alert("Error1:"+e)}}catch(e){alert("Error2:"+e)}}function checkTiefenLichter_edit(e,t){return blendif_check_steps=[],blendif_check_value=[],layer_blendif_edit(e,layer_getIDXbyString("Tiefen_check")[0],0,t),layer_blendif_edit(e,layer_getIDXbyString("Lichter_check")[0],-1*t,0),e?(blendif_check_steps.sort((function(e,t){return e-t})),layer_renameByIDX(layer_getIDXbyString("check ")[0],"check "+blendif_check_steps[0])):t>=0?blendif_check_value.sort((function(e,t){return t-e})):blendif_check_value.sort((function(e,t){return e-t})),blendif_check_value[0]}function checkTiefenLichter_edit_button(e){try{if(layer_checkExistenceByRegex("check"))try{e=parseInt(check_lastProtocolStep())+e;doc.suspendHistory("TiefenLichter Check "+checkTiefenLichter_protocol(checkTiefenLichter_edit(!1,e))+checkTiefenLichter_edit(!1,e)+" ","checkTiefenLichter_edit(true, "+e+");")}catch(e){alert("Error1:"+e)}}catch(e){alert("Error2:"+e)}}var checkTiefenLichter_protocol=function(e){return e>>>0===parseFloat(e)?"+":""},check_lastProtocolStep=function(){var e=doc.historyStates.length,t=doc.historyStates[e-1].name,r=new RegExp("^TiefenLichter Check ");if(t.match(r)){var n=parseInt(t.replace(/(TiefenLichter Check )([-+]\d)/g,"$2"));return undoSteps(1),n}return 0};function fixMask(e,t){try{var r=new ActionReference;r.putIndex(sTID("layer"),e);var n=executeActionGet(r),s=n.getUnitDoubleValue(sTID("userMaskFeather")),a=n.getUnitDoubleValue(sTID("userMaskDensity"));return s>0&&(gotoLayer(e),gotoMask(),setMaskFeatherTo(0),fixMaskFeather(s*t)),a<255&&(gotoLayer(e),gotoMask(),setMaskDensityTo(100),fixMaskDens(-1*(a-255))),!0}catch(n){return!1}}function fixMaskDens(e){var t=new ActionDescriptor,r=new ActionDescriptor,n=new ActionList,s=new ActionList,a=new ActionReference;t.putEnumerated(s2t("presetKind"),s2t("presetKindType"),s2t("presetKindCustom")),a.putEnumerated(s2t("channel"),s2t("ordinal"),s2t("targetEnum")),r.putReference(s2t("channel"),a),s.putInteger(e),s.putInteger(255),r.putList(s2t("output"),s),n.putObject(s2t("levelsAdjustment"),r),t.putList(s2t("adjustment"),n),executeAction(s2t("levels"),t,DialogModes.NO)}function fixMaskFeather(e){var t=new ActionDescriptor;t.putUnitDouble(s2t("radius"),s2t("pixelsUnit"),e),executeAction(s2t("gaussianBlur"),t,DialogModes.NO)}function fixMaskLoop(e){for(var t=getActiveLayerIndex(),r=1;fixMask(r,e);)r++;gotoLayer(t)}function getMaskVisibility(){var e=new ActionReference;return e.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),executeActionGet(e).getBoolean(s2t("userMaskEnabled"))}function getMaskVisibility_bySelector(e){var t=new ActionReference;return"number"==typeof e&&t.putIndex(s2t("layer"),e),"string"==typeof e&&(layer_checkExistence(e)?t.putName(s2t("layer"),e):t.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])),void 0===e&&t.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),executeActionGet(t).getBoolean(s2t("userMaskEnabled"))}function layer_blendif_edit(e,t,r,n){var s=layer_blendif_get(t)[2]+n,a=layer_blendif_get(t)[0]+r,c=0;if(s<0){for(c=1;s+c<0;)c++;s=s+c}var o=0;if(a>255){for(o=1;a-o>255;)o++;a=a-o}e&&(blendif(t,a,a,s,s),blendif_check_steps.push(0+s),blendif_check_steps.push(255-a)),blendif_check_value.push(n+c),blendif_check_value.push(-1*(r-o))}function layer_blendif_get(_idx){try{var r=new ActionReference,d=new ActionDescriptor,array=[];r.putProperty(s2t("property"),s2t("json")),isNaN(_idx)?r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")):r.putIndex(s2t("layer"),_idx),d.putReference(s2t("null"),r),eval("var json="+executeAction(s2t("get"),d,DialogModes.NO).getString(s2t("json")));var parents=loopParentsIDXfor(_idx).length;if(0==parents)var call=json.layers[0];else if(1==parents)var call=json.layers[0].layers[0];else if(2==parents)var call=json.layers[0].layers[0].layers[0];else if(3==parents)var call=json.layers[0].layers[0].layers[0].layers[0];else if(4==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0];else if(5==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(6==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(7==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(8==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(9==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(10==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];if(call.blendOptions.blendRange){var data=call.blendOptions.blendRange.toSource(),data=data.replace(/^\[\(/g,"").replace(/\)\]$/g,""),data=data.replace(/([a-zA-Z]+)/g,'"$1"'),data=data.replace(/\"\"gray\"\"/g,'"gray"'),data=JSON.parse(data);for(var i in data)"destBlackMin"!=i&&"destBlackMax"!=i&&"destWhiteMin"!=i&&"desaturate"!=i||array.push(data[i]);return array}}catch(e){alert(e)}}function layer_checkExistence(e){try{var t=new ActionReference;t.putProperty(s2t("property"),s2t("itemIndex")),"number"==typeof e?t.putIndex(s2t("layer"),e):"string"==typeof e&&t.putName(s2t("layer"),e);executeActionGet(t).getInteger(s2t("itemIndex"));return!0}catch(e){return!1}}function layer_checkExistenceByRegex(e){return 0!==layer_getIDXbyString(e).length}function layer_copyLayers(){executeAction(sTID("copyToLayer"),void 0,DialogModes.NO)}function layer_create(e,t,r,n){var s=new ActionDescriptor,a=new ActionDescriptor,c=new ActionReference;c.putClass(s2t("layer")),s.putReference(s2t("null"),c),a.putString(s2t("name"),e),a.putUnitDouble(s2t("opacity"),s2t("percentUnit"),t),a.putEnumerated(s2t("mode"),s2t("blendMode"),s2t("multiply")),a.putBoolean(s2t("fillNeutral"),r),s.putObject(s2t("using"),s2t("layer"),a),executeAction(s2t("make"),s,DialogModes.NO);var o=new ActionDescriptor,i=new ActionDescriptor,l=new ActionReference;l.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),o.putReference(s2t("null"),l),i.putEnumerated(s2t("mode"),s2t("blendMode"),s2t(n)),o.putObject(s2t("to"),s2t("layer"),i),executeAction(s2t("set"),o,DialogModes.NO)}function layer_delete(e){var t=new ActionDescriptor,r=new ActionReference;try{if("number"==typeof e)r.putIndex(s2t("layer"),e);else if("string"==typeof e)if(layer_checkExistence(e))r.putName(s2t("layer"),e);else{var n=layer_getIDXbyString(e);r.putIndex(s2t("layer"),n[0])}else void 0===e&&r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"));t.putReference(s2t("null"),r),executeAction(s2t("delete"),t,DialogModes.NO)}catch(e){alert("nix zu löschen")}}function layer_getIDXbyName(e){var t=new ActionReference;return t.putProperty(s2t("property"),s2t("itemIndex")),t.putName(s2t("layer"),e),hasBackground()?executeActionGet(t).getInteger(s2t("itemIndex"))-1:executeActionGet(t).getInteger(s2t("itemIndex"))}function layer_getIDXbyString(e){for(var t=1,r=[];layer_checkExistence(t);){try{var n=new RegExp(e,"g");layer_getName(t).match(n)&&r.push(t)}catch(e){}t++}return r}function layer_getLayerType(e){var t=new ActionReference;return t.putProperty(s2t("property"),s2t("layerKind")),"number"==typeof e?t.putIndex(s2t("layer"),e):"string"==typeof e?($.writeln(""),layer_checkExistence(e)?t.putName(s2t("layer"),e):t.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])):void 0===e&&t.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),executeActionGet(t).getInteger(s2t("layerKind"))}function layer_getName(e){try{var t=new ActionReference;return t.putIndex(charIDToTypeID("Lyr "),e),executeActionGet(t).getString(stringIDToTypeID("name"))}catch(e){return e}}function layer_getSolidFillColor(){var e=[],t=new ActionReference;t.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"));var r=executeActionGet(t).getList(s2t("adjustment")).getObjectValue(0).getObjectValue(s2t("color"));return e.push(Math.round(r.getDouble(s2t("red")))),e.push(Math.round(r.getDouble(s2t("green")))),e.push(Math.round(r.getDouble(s2t("blue")))),e}function layer_makeBackground(){var e=new ActionDescriptor,t=new ActionReference,r=new ActionReference;t.putClass(s2t("backgroundLayer")),e.putReference(s2t("null"),t),r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),e.putReference(s2t("using"),r),executeAction(s2t("make"),e,DialogModes.NO)}function layer_mergeLayers(){var e=new ActionDescriptor;executeAction(s2t("mergeLayersNew"),e,DialogModes.NO)}function layer_mergeVisible(e){var t=new ActionDescriptor;t.putBoolean(s2t("duplicate"),e),executeAction(s2t("mergeVisible"),t,DialogModes.NO)}function layer_renameByIDX(e,t){if(0!=e){var r=new ActionDescriptor,n=new ActionReference;n.putIndex(s2t("layer"),e),r.putReference(s2t("null"),n);var s=new ActionDescriptor;s.putString(s2t("name"),t),r.putObject(s2t("to"),s2t("layer"),s),executeAction(s2t("set"),r,DialogModes.NO)}}function layer_selectedIDX_get(){var e=[],t=new ActionReference;t.putEnumerated(stringIDToTypeID("document"),stringIDToTypeID("ordinal"),stringIDToTypeID("targetEnum"));var r=executeActionGet(t);if(r.hasKey(stringIDToTypeID("targetLayers")))for(var n=0,s=(r=r.getList(stringIDToTypeID("targetLayers"))).count;n<s;n++)hasBackground()?e.push(r.getReference(n).getIndex()):e.push(r.getReference(n).getIndex()+1);return e}function layer_selectedIDX_set(e){try{if(selectLayers("selectNoLayers"),e.length>0)for(var r=0;r<e.length;r++)selectLayerBySelector(e[r],t)}catch(e){selectLayers("selectNoLayers")}}function layer_selectedID_get(){var e=[],t=new ActionReference;t.putEnumerated(stringIDToTypeID("document"),stringIDToTypeID("ordinal"),stringIDToTypeID("targetEnum"));var r=executeActionGet(t);if(r.hasKey(stringIDToTypeID("targetLayers")))for(var n=0,s=(r=r.getList(stringIDToTypeID("targetLayers"))).count;n<s;n++)ref2=new ActionReference,hasBackground()?ref2.putIndex(s2t("layer"),r.getReference(n).getIndex()):ref2.putIndex(s2t("layer"),r.getReference(n).getIndex()+1),desc2=executeActionGet(ref2),e.push(desc2.getInteger(stringIDToTypeID("layerID")));return e}function layer_selectedID_set(e){selectLayers("selectNoLayers");try{e=arrayCorrect(e)}catch(e){}try{if(e.length>0)for(var r=0;r<e.length;r++)selectLayerByID(e[r],t)}catch(e){alert("error layer_selectedID_set: "+e)}}function layer_shape_create(e,t,r,n,s,a,c,o,i,l,u){var p=new ActionDescriptor,y=new ActionDescriptor,d=new ActionDescriptor,f=new ActionDescriptor,g=new ActionDescriptor,D=new ActionDescriptor,h=new ActionDescriptor,b=new ActionDescriptor,m=new ActionList,v=new ActionReference;v.putClass(s2t("contentLayer")),p.putReference(s2t("null"),v),f.putDouble(s2t("red"),c[0]),f.putDouble(s2t("grain"),c[1]),f.putDouble(s2t("blue"),c[2]),d.putObject(s2t("color"),s2t("RGBColor"),f),y.putObject(s2t("type"),s2t("solidColorLayer"),d),g.putInteger(s2t("unitValueQuadVersion"),1),g.putUnitDouble(s2t("top"),s2t("percentUnit"),t),g.putUnitDouble(s2t("left"),s2t("percentUnit"),r),g.putUnitDouble(s2t("bottom"),s2t("percentUnit"),n),g.putUnitDouble(s2t("right"),s2t("percentUnit"),s),y.putObject(s2t("shape"),s2t(e),g),D.putInteger(s2t("strokeStyleVersion"),2),D.putBoolean(s2t("strokeEnabled"),o),D.putBoolean(s2t("fillEnabled"),a),D.putUnitDouble(s2t("strokeStyleLineWidth"),s2t("pixelsUnit"),l),D.putUnitDouble(s2t("strokeStyleLineDashOffset"),s2t("pointsUnit"),0),D.putDouble(s2t("strokeStyleMiterLimit"),100),D.putEnumerated(s2t("strokeStyleLineCapType"),s2t("strokeStyleLineCapType"),s2t("strokeStyleButtCap")),D.putEnumerated(s2t("strokeStyleLineJoinType"),s2t("strokeStyleLineJoinType"),s2t("strokeStyleMiterJoin")),D.putEnumerated(s2t("strokeStyleLineAlignment"),s2t("strokeStyleLineAlignment"),s2t(u)),D.putBoolean(s2t("strokeStyleScaleLock"),!1),D.putBoolean(s2t("strokeStyleStrokeAdjust"),!1),D.putList(s2t("strokeStyleLineDashSet"),m),D.putEnumerated(s2t("strokeStyleBlendMode"),s2t("blendMode"),s2t("normal")),D.putUnitDouble(s2t("strokeStyleOpacity"),s2t("percentUnit"),100),b.putDouble(s2t("red"),i[0]),b.putDouble(s2t("grain"),i[1]),b.putDouble(s2t("blue"),i[2]),h.putObject(s2t("color"),s2t("RGBColor"),b),D.putObject(s2t("strokeStyleContent"),s2t("solidColorLayer"),h),y.putObject(s2t("strokeStyle"),s2t("strokeStyle"),D),p.putObject(s2t("using"),s2t("contentLayer"),y),executeAction(s2t("make"),p,DialogModes.NO)}function layer_shape_getAngle(e){if(4==layer_getLayerType(e)){var t=layer_selectedIDX_get();gotoLayer_bySelector(e);var r=new ActionReference;r.putEnumerated(s2t("path"),s2t("ordinal"),s2t("targetEnum"));for(var n=executeActionGet(r).getObjectValue(s2t("pathContents")).getList(s2t("pathComponents")),s=[],a=0;a<n.count;a++)for(var c=n.getObjectValue(a).getList(s2t("subpathListKey")),o=0;o<c.count;o++)for(var i=c.getObjectValue(o).getList(s2t("points")),l=0;l<i.count;l++){var u=i.getObjectValue(l).getObjectValue(s2t("anchor")),p=u.getUnitDoubleValue(s2t("horizontal")),y=u.getUnitDoubleValue(s2t("vertical"));s.push({x:p,y:y})}var d=s[1].x-s[0].x,f=(s[1].y-s[0].y)/d,g=Math.atan(f)*(180/Math.PI);return layer_selectedIDX_set(t),g}return!1}function layer_solidColorHSB_change(e,t,r){var n=new ActionDescriptor,s=new ActionDescriptor,a=new ActionDescriptor,c=new ActionReference;c.putEnumerated(s2t("contentLayer"),s2t("ordinal"),s2t("targetEnum")),n.putReference(s2t("null"),c),a.putUnitDouble(s2t("hue"),s2t("angleUnit"),e),a.putDouble(s2t("saturation"),t),a.putDouble(s2t("brightness"),r),s.putObject(s2t("color"),s2t("HSBColorClass"),a),n.putObject(s2t("to"),s2t("solidColorLayer"),s),executeAction(s2t("set"),n,DialogModes.NO)}function layer_transform(e,t,r,n,s,a,c,o,i){var l=new ActionDescriptor,u=new ActionDescriptor,p=new ActionReference;if("topleft"==e)var y="QCSCorner0";else if("topcenter"==e)y="QCSSide0";else if("topright"==e)y="QCSCorner1";else if("midleft"==e)y="QCSSide3";else if("midcenter"==e)y="QCSAverage";else if("midright"==e)y="QCSSide1";else if("bottomleft"==e)y="QCSCorner3";else if("bottomcenter"==e)y="QCSSide2";else if("bottomright"==e)y="QCSCorner2";else y="QCSCorner0";if(o=o||"pixelsUnit",i=i||0,p.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),l.putReference(s2t("null"),p),l.putEnumerated(s2t("freeTransformCenterState"),s2t("quadCenterState"),s2t(y)),u.putUnitDouble(s2t("horizontal"),s2t(o),t),u.putUnitDouble(s2t("vertical"),s2t(o),r),l.putObject(s2t("offset"),s2t("offset"),u),l.putUnitDouble(s2t("angle"),s2t("angleUnit"),i),null!=a){if("%_canvas"==a){var d=app.activeDocument.activeLayer.bounds[2]-app.activeDocument.activeLayer.bounds[0],f=app.activeDocument.activeLayer.bounds[3]-app.activeDocument.activeLayer.bounds[1],g=parseFloat(app.activeDocument.width/d*n),D=parseFloat(app.activeDocument.height/f*s);n&&l.putUnitDouble(s2t("width"),s2t("percentUnit"),g),s&&l.putUnitDouble(s2t("height"),s2t("percentUnit"),D)}else if("%_layer"==a){d=app.activeDocument.activeLayer.bounds[2]-app.activeDocument.activeLayer.bounds[0],f=app.activeDocument.activeLayer.bounds[3]-app.activeDocument.activeLayer.bounds[1],g=parseFloat(d/app.activeDocument.width*n*10),D=parseFloat(f/app.activeDocument.height*s*10);n&&l.putUnitDouble(s2t("width"),s2t("percentUnit"),g),s&&l.putUnitDouble(s2t("height"),s2t("percentUnit"),D)}else if("px"==a){g=parseFloat(n/app.activeDocument.width*100),D=parseFloat(s/app.activeDocument.height*100);n&&l.putUnitDouble(s2t("width"),s2t("percentUnit"),g),s&&l.putUnitDouble(s2t("height"),s2t("percentUnit"),D)}(n||s)&&c&&l.putBoolean(s2t("linked"),c)}l.putEnumerated(s2t("interfaceIconFrameDimmed"),s2t("interpolationType"),s2t("bicubic")),executeAction(s2t("transform"),l,DialogModes.NO)}function selectLayerByID(e,t){try{var r=new ActionDescriptor,n=new ActionReference;if("remove"!=t&&t)s="addToSelection";else var s="removeFromSelection";n.putIdentifier(s2t("layer"),e),r.putReference(s2t("null"),n),r.putEnumerated(s2t("selectionModifier"),s2t("selectionModifierType"),s2t(s)),r.putBoolean(s2t("makeVisible"),!1),executeAction(s2t("select"),r,DialogModes.NO)}catch(e){}}function selectLayerBySelector(e,t){try{var r=new ActionDescriptor,n=new ActionReference;if("remove"!=t&&t)s="addToSelection";else var s="removeFromSelection";isNaN(e)?n.putName(s2t("layer"),e):n.putIndex(s2t("layer"),e),r.putReference(s2t("null"),n),r.putEnumerated(s2t("selectionModifier"),s2t("selectionModifierType"),s2t(s)),r.putBoolean(s2t("makeVisible"),!1),executeAction(s2t("select"),r,DialogModes.NO)}catch(e){}}function select_nextLayer(e){var t=app.activeDocument.duplicate(),r=(t.activeLayer,t.layers[t.layers.length-1]),n=d();t.activeLayer=r;var s=r.isBackgroundLayer;s&&(r.isBackgroundLayer=!1);try{f(n)}catch(e){}var a=new ActionDescriptor,c=new ActionReference;c.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt")),a.putReference(cTID("null"),c),executeAction(sTID("selectAllLayers"),a,DialogModes.NO);var o=new ActionDescriptor,i=new ActionList,l=new ActionReference;l.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt")),i.putReference(l),o.putList(cTID("null"),i),executeAction(cTID("Shw "),o,DialogModes.NO),s&&(r.isBackgroundLayer=!0),f(n);try{!function(e){var t;"up"==e||"above"==e?t=cTID("Frwr"):"down"!=e&&"below"!=e||(t=cTID("Bckw"));var r=new ActionDescriptor,n=new ActionReference;n.putEnumerated(cTID("Lyr "),cTID("Ordn"),t),r.putReference(cTID("null"),n),executeAction(cTID("slct"),r,DialogModes.NO)}(e)}catch(e){}var u=d();t.close(SaveOptions.DONOTSAVECHANGES);try{f(u)}catch(e){var p=new ActionDescriptor,y=new ActionReference;y.putName(cTID("Lyr "),"Background"),p.putReference(cTID("null"),y),executeAction(cTID("slct"),p,DialogModes.NO)}function d(){var e=new ActionReference;return e.putProperty(s2t("property"),s2t("layerID")),e.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),executeActionGet(e).getInteger(s2t("layerID"))}function f(e,t){var r=new ActionDescriptor,n=new ActionReference;t=null==t?t=!1:t,n.putIdentifier(cTID("Lyr "),e),r.putReference(cTID("null"),n),t&&r.putEnumerated(sTID("selectionModifier"),sTID("selectionModifierType"),sTID("addToSelection")),r.putBoolean(cTID("MkVs"),!1),executeAction(cTID("slct"),r,DialogModes.NO)}}function select_nextLayer_simple(e,t){var r,n=new ActionDescriptor,s=new ActionReference;"up"==e||"above"==e?r=s2t("forwardEnum"):"down"!=e&&"below"!=e||(r=s2t("backwardEnum")),s.putEnumerated(s2t("layer"),s2t("ordinal"),r),n.putReference(s2t("null"),s),t=null==t?t=!1:t,n.putBoolean(s2t("makeVisible"),t),executeAction(s2t("select"),n,DialogModes.NO)}function setLayerOpacity(e){var t=new ActionDescriptor,r=new ActionDescriptor,n=new ActionReference;n.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),t.putReference(s2t("null"),n),r.putUnitDouble(s2t("opacity"),s2t("percentUnit"),e),t.putObject(s2t("to"),s2t("layer"),r),executeAction(s2t("set"),t,DialogModes.NO)}function setMaskVisibility(e){var t=new ActionDescriptor,r=new ActionDescriptor,n=new ActionReference;if(0==e||"hide"==e)var s=!1;else if(1==e||"show"==e)s=!0;else if("toggle"==e||"X"==e)if(getMaskVisibility())s=!1;else s=!0;try{n.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),t.putReference(s2t("null"),n),r.putBoolean(s2t("userMaskEnabled"),s),t.putObject(s2t("to"),s2t("layer"),r),executeAction(s2t("set"),t,DialogModes.NO)}catch(e){}}function setMaskVisibility_bySelector(e,t){var r=new ActionDescriptor,n=new ActionDescriptor,s=new ActionReference;if(0==e||"hide"==e)var a=!1;else if(1==e||"show"==e)a=!0;else if("toggle"==e||"X"==e)if(getMaskVisibility())a=!1;else a=!0;try{"number"==typeof t&&s.putIndex(s2t("layer"),t),"string"==typeof t&&(layer_checkExistence(t)?s.putName(s2t("layer"),t):s.putIndex(s2t("layer"),layer_getIDXbyString(t)[0])),void 0===t&&s.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),r.putReference(s2t("null"),s),n.putBoolean(s2t("userMaskEnabled"),a),r.putObject(s2t("to"),s2t("layer"),n),executeAction(s2t("set"),r,DialogModes.NO)}catch(e){alert(e)}}
    function mask2image(e){if(1===layer_selectedIDX_get().length&&hasLayerMask()){var t=layer_getName(getActiveLayerIndex());gotoMask(),loadSelectionOfMask(),select_invert(),layer_create(e+" ("+t+")",100,!0,"normal"),fill("black","normal",100),selection_deselect()}else alert("Abbruch!\nwähle genau eine Ebene mit Maske aus")}function select_Farbbereich(e){var t=new ActionDescriptor;t.putEnumerated(s2t("colors"),s2t("colors"),s2t(e)),t.putInteger(s2t("colorModel"),0),executeAction(s2t("colorRange"),t,DialogModes.NO)}function select_all(){var e=new ActionDescriptor,t=new ActionReference;t.putProperty(s2t("channel"),s2t("selection")),e.putReference(s2t("null"),t),e.putEnumerated(s2t("to"),s2t("ordinal"),s2t("allEnum")),executeAction(s2t("set"),e,DialogModes.NO)}function select_haut(e,t,n){var a=layer_selectedIDX_get();if(cancel=!1,e)layer_mergeVisible(e);else{if("LayerKind.SMARTOBJECT"!=doc.activeLayer.kind&&"LayerKind.NORMAL"!=doc.activeLayer.kind)return void alert("Abruch\n Eine Haut-Makse von dieser Ebene kann nicht erstellt werden.");layer_copyLayers(),"LayerKind.SMARTOBJECT"==doc.activeLayer.kind&&rasterSmartObject(),layer_selectedIDX_get().length>1&&layer_mergeLayers()}nameLayer("helper__hautMask_image");for(var o=hasBackground()?0:1;layer_checkExistence(o);)o++;moveLayer("helper__hautMask_image",parseInt(o-1),"up"),gotoLayer("helper__hautMask_image"),selection_loop((function(){executeAction(sTID("a6e0kl2a-95ce-32d3-bd6b-93ma23632k91"),void 0,DialogModes.ALL)})),select_layer(),gotoLayer("helper__hautMask_image"),layer_delete(),cancel||("Selection"==n?(layer_selectedIDX_set(a),"nicht Haut"==t&&select_invert()):(gotoLayer(a[a.length-1]),selection2mask(t),setMaskFeatherTo(6),"nicht Haut"==t&&(gotoMask(),invert(),gotoFill())))}function select_invert(){executeAction(s2t("inverse"),void 0,DialogModes.NO)}function select_layer(){var e=new ActionDescriptor,t=new ActionReference,n=new ActionReference;t.putProperty(s2t("channel"),s2t("selection")),e.putReference(s2t("null"),t),n.putEnumerated(s2t("channel"),s2t("channel"),s2t("transparencyEnum")),e.putReference(s2t("to"),n),executeAction(s2t("set"),e,DialogModes.NO)}function select_luminance(){const e=workingProfile_get("Gray"),t=doc.colorProfileName;gamma_L=["eciRGB v2","eciRGB v2 ICCv4"],gamma_18=["sRGB IEC61966-2.1","ProPhoto RGB","Display P3","image P3","Apple RGB","ColorMatch RGB"],gamma_22=["Adobe RGB (1998)","BestRGB","Beta RGB","DonRGB4.icm","MaxRGB","Russell RGB"],array_contains(gamma_18,t)&&"Gray Gamma 1.8"!=e&&workingProfile_set("Gray","Gray Gamma 1.8"),array_contains(gamma_22,t)&&"Gray Gamma 2.2"!=e&&workingProfile_set("Gray","Gray Gamma 2.2"),array_contains(gamma_L,t)&&workingProfile_set("Gray","Gray-elle-V4-labl.icc"),array_contains(gamma_18,t)||array_contains(gamma_22,t)||array_contains(gamma_L,t)||alert("Vorsicht\nDie Helligkeitsverteilung könnte fehlerhaft sein.\nfehlende Info zum Gamma von '"+t+"'");var n=new ActionDescriptor,a=new ActionReference,o=new ActionReference;a.putProperty(s2t("channel"),s2t("selection")),n.putReference(s2t("null"),a),o.putEnumerated(s2t("channel"),s2t("channel"),s2t("RGB")),n.putReference(s2t("to"),o),executeAction(s2t("set"),n,DialogModes.NO),e!=workingProfile_get("Gray")&&workingProfile_set("Gray",e)}function select_motiv(){var e=new ActionDescriptor;e.putBoolean(s2t("sampleAllLayers"),!0),executeAction(s2t("autoCutout"),e,DialogModes.NO)}function select_outOfGamut(e,t){var n=layer_selectedIDX_get();cancel=!1;const a=getMeta_softproof()[0],o=workingProfile_get("CMYK");void 0!==a?(o!=a&&workingProfile_set("CMYK",a),gotoFill(),selection_loop((function(){select_Farbbereich("outOfGamut")})),o!=a&&workingProfile_set("CMYK",o),cancel||("Selection"==t?layer_selectedIDX_set(n):(gotoLayer(n[n.length-1]),selection2mask(e)))):alert("kein Softproof eingestellt")}function select_saturation(e,t,n,a){var o=layer_selectedIDX_get();cancel=!1,selection_loop((function(){channel_setSaturation(n,t)})),cancel||("selection"==a?(layer_selectedIDX_set(o),channel2selection("saturation"),"unbunt"==e&&select_invert(),channel_delete("saturation")):(gotoLayer(o[o.length-1]),channel2mask("saturation",e),"unbunt"==e&&(gotoMask(),invert(),gotoFill()),channel_delete("saturation")))}function select_sky(e){var t=new ActionDescriptor;t.putBoolean(s2t("sampleAllLayers"),e),executeAction(s2t("selectSky"),t,DialogModes.NO)}function selection2mask(e){for(var t=1;layer_checkExistence(layer_getIDXbyString(e+" "+t)[0]);)t++;createGroup(e+" "+t,"passThrough","none",100,f),maskFromSelection()}function selection_check(){var e=!0;try{activeDocument.selection.bounds}catch(t){e=!1}return e}function selection_deselect(){var e=new ActionDescriptor,t=new ActionReference;t.putProperty(s2t("channel"),s2t("selection")),e.putReference(s2t("null"),t),e.putEnumerated(s2t("to"),s2t("ordinal"),s2t("none")),executeAction(s2t("set"),e,DialogModes.NO)}function selection_loop(e){var t;try{e()}catch(n){t=getActiveLayerIndex(),select_nextLayer_simple("down",f),function n(){var a=getActiveLayerIndex();try{e()}catch(e){if(a===t)return alert("keine geeignete Ebene gefunden"),void(cancel=!0);select_nextLayer_simple("down",f),n()}}()}}function vectorMask2seletion(){var e=new ActionDescriptor,t=new ActionReference,n=new ActionReference;t.putProperty(s2t("channel"),s2t("selection")),e.putReference(s2t("null"),t),n.putEnumerated(s2t("path"),s2t("path"),s2t("vectorMask")),n.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),e.putReference(s2t("to"),n),executeAction(s2t("set"),e,DialogModes.NO)}



    try {
        var _color_array = arrayCorrect(_color_array);
    } catch (error) {
        alert("Error arrayCorrect: \n" + e)
    }

    app.open(new File(_imagePath));
    var startLayerSelection = layer_selectedID_get();
    var doc = app.activeDocument;

    try {
        var getProfile = doc.colorProfileName;
        var find = new RegExp("Display P3");
        if (!getProfile.match(find)) {
            doc.convertProfile("Display P3", Intent.RELATIVECOLORIMETRIC, true, false);
        }
    } catch (e) {}


    if (_alreadyRGB == "no") {
        motivmaske('Motiv', 'Folder');
        motivmaske('nicht Motiv', 'Folder');
        nameLayer("Hintergrund");

        createColorLayer("farbe", "overlay", "none", 100, "none", _color_array[0], _color_array[1], _color_array[2]);


        layer_selectedID_set(startLayerSelection);
        saveMultiformat(new File(_file_RGB), "psd", f, null, f, t);

    } else {
        gotoLayer("farbe");
        layer_solidColorRGB_change(_color_array[0], _color_array[1], _color_array[2]);
        layer_selectedID_set(startLayerSelection);
        doc.save();

    }

    doc.close(SaveOptions.SAVECHANGES);

    function layer_solidColorRGB_change(_r, _g, _b) {
        var d = new ActionDescriptor();
        var d2 = new ActionDescriptor();
        var d3 = new ActionDescriptor();
        var r = new ActionReference();

        r.putEnumerated(s2t("contentLayer"), s2t("ordinal"), s2t("targetEnum"));
        d.putReference(s2t("null"), r);

        d3.putDouble(s2t("red"), _r);
        d3.putDouble(s2t("grain"), _g);
        d3.putDouble(s2t("blue"), _b);
        d2.putObject(s2t("color"), s2t("RGBColor"), d3);

        d.putObject(s2t("to"), s2t("solidColorLayer"), d2);
        executeAction(s2t("set"), d, DialogModes.NO);
    }


}




