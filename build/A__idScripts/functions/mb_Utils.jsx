function getActiveLayerIndex(){var e=new ActionReference;return e.putProperty(charIDToTypeID("Prpr"),charIDToTypeID("ItmI")),e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt")),hasBackground()?executeActionGet(e).getInteger(charIDToTypeID("ItmI"))-1:executeActionGet(e).getInteger(charIDToTypeID("ItmI"))}function closeGroup(e){var t=isLocked(),r=isVisible(),n=e.name,c=e.opacity,o=e.blendMode,a=e.linkedLayers,D=getActiveLayerIndex(),I=getActiveLayerIndex();hasBackground()||(I-=1);var i=getColor();try{var T=hasLayerMask()}catch(e){}try{var p=hasVectorMask()}catch(e){}i=getColor();var u=!1;try{copyLayerStyle(),u=!0}catch(e){}if(1==t&&unlock(),0==r&&makeVisible(),T){try{deselectPath()}catch(e){}var y=isLayerMaskEnabled();duplicateLayerMaskAsAlpha();try{var s=getMaskDensity(),l=getMaskFeather()}catch(e){}var h=isLayerMaskLinked()}if(p){var g=getVectorMaskDensity(),d=getVectorMaskFeather();duplicateVectorMask()}e.layers.length<=1?(addTempLayerSetIn(I),makeActiveByIndex(D+2,!1),ungroup(),groupSelected(n),makeActiveByIndex(D+2,!1),deleteTempLayerSetbyIdx(currSetIDX+1)):(makeActiveByIndex(currSetIDX,!1),ungroup(),groupSelected(n));var A=activeDocument.activeLayer;for(x in A.opacity=c,A.blendMode=o,a)"LayerSet"==a[x].typename&&activeDocument.activeLayer.link(a[x]);if(u&&pasteLayerStyle(),T){setBackTheLayerMask();try{setMaskDensityTo(Math.round(100*s/255)),setMaskFeatherTo(l)}catch(e){}setMaskLinked(h),setMaskEnabled(y)}return p&&(recreateVectorMask(),setVectorMaskDensityTo(Math.round(100*g/255)),setVectorMaskFeatherTo(d)),setColorTo(i),1==t&&lock(),0==r&&hide(),A}function ungroup(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt")),e.putReference(cTID("null"),t);try{executeAction(sTID("ungroupLayersEvent"),e,DialogModes.NO)}catch(e){}}function addLayer(){var e=activeDocument.activeLayer,t=activeDocument.layerSets.add();return t.move(e,ElementPlacement.PLACEBEFORE),t}function isVisible(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).getBoolean(sTID("visible"))}function isVisibleIDX(e){var t=new ActionReference;
/* m_Ref01.putEnumerated( sTID( "layer" ), cTID( "Ordn" ), cTID( "Trgt" )); */return t.putIndex(sTID("layer"),e),executeActionGet(t).getBoolean(sTID("visible"))}function makeVisible(){var e=charIDToTypeID("Shw "),t=new ActionDescriptor,r=charIDToTypeID("null"),n=new ActionList,c=new ActionReference,o=charIDToTypeID("Lyr "),a=charIDToTypeID("Ordn"),D=charIDToTypeID("Trgt");c.putEnumerated(o,a,D),n.putReference(c),t.putList(r,n),executeAction(e,t,DialogModes.NO)}function hide(){var e=charIDToTypeID("Hd  "),t=new ActionDescriptor,r=charIDToTypeID("null"),n=new ActionList,c=new ActionReference,o=charIDToTypeID("Lyr "),a=charIDToTypeID("Ordn"),D=charIDToTypeID("Trgt");c.putEnumerated(o,a,D),n.putReference(c),t.putList(r,n),executeAction(e,t,DialogModes.NO)}function hasLayerMask(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).hasKey(cTID("Usrs"))}function deselectPath(){var e=new ActionDescriptor,t=new ActionReference;t.putClass(cTID("Path")),e.putReference(cTID("null"),t),executeAction(cTID("Dslc"),e,DialogModes.NO)}function duplicateLayerMaskAsAlpha(){selectLayerMask();
/* ======================================= mask visible */
var e=new ActionDescriptor;(C=new ActionReference).putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk ")),e.putReference(cTID("null"),C),e.putBoolean(cTID("MkVs"),!0),executeAction(cTID("slct"),e,DialogModes.NO);
/* =======================================================select All */
var t=charIDToTypeID("setd"),r=new ActionDescriptor,n=charIDToTypeID("null"),c=new ActionReference,o=charIDToTypeID("Chnl"),a=charIDToTypeID("fsel");c.putProperty(o,a),r.putReference(n,c);var D=charIDToTypeID("T   "),I=charIDToTypeID("Ordn"),i=charIDToTypeID("Al  ");r.putEnumerated(D,I,i),executeAction(t,r,DialogModes.NO);
/* ======================================================= copy */
var T=charIDToTypeID("copy");executeAction(T,void 0,DialogModes.NO);
/* ======================================================= make alpha */
var p=charIDToTypeID("Mk  "),u=new ActionDescriptor,y=charIDToTypeID("Nw  "),s=new ActionDescriptor,l=charIDToTypeID("ClrI"),h=charIDToTypeID("MskI"),g=charIDToTypeID("MskA");s.putEnumerated(l,h,g);var d=charIDToTypeID("Clr "),A=new ActionDescriptor,f=charIDToTypeID("Rd  ");A.putDouble(f,255);var v=charIDToTypeID("Grn ");A.putDouble(v,0);var x=charIDToTypeID("Bl  ");A.putDouble(x,0);var m=charIDToTypeID("RGBC");s.putObject(d,m,A);var L=charIDToTypeID("Opct");s.putInteger(L,50);o=charIDToTypeID("Chnl");u.putObject(y,o,s),executeAction(p,u,DialogModes.NO);
/* =======================================================select All */
t=charIDToTypeID("setd");var S=new ActionDescriptor,w=(n=charIDToTypeID("null"),new ActionReference);o=charIDToTypeID("Chnl"),a=charIDToTypeID("fsel");w.putProperty(o,a),S.putReference(n,w);D=charIDToTypeID("T   "),I=charIDToTypeID("Ordn"),i=charIDToTypeID("Al  ");S.putEnumerated(D,I,i),executeAction(t,S,DialogModes.NO);
/* =======================================================paste */
var k=charIDToTypeID("past"),R=new ActionDescriptor,M=charIDToTypeID("AntA"),O=charIDToTypeID("Annt"),b=charIDToTypeID("Anno");R.putEnumerated(M,O,b),executeAction(k,R,DialogModes.NO);
/* =======================================================deselect */
t=charIDToTypeID("setd");var E=new ActionDescriptor,N=(n=charIDToTypeID("null"),new ActionReference);o=charIDToTypeID("Chnl"),a=charIDToTypeID("fsel");N.putProperty(o,a),E.putReference(n,N);D=charIDToTypeID("T   "),I=charIDToTypeID("Ordn");var X=charIDToTypeID("None");E.putEnumerated(D,I,X),executeAction(t,E,DialogModes.NO);
/* =======================================================rename */
var C;e=new ActionDescriptor;(C=new ActionReference).putEnumerated(cTID("Chnl"),cTID("Ordn"),cTID("Trgt")),e.putReference(cTID("null"),C);var P=new ActionDescriptor;P.putString(cTID("Nm  "),"mbTemp_alpha"),e.putObject(cTID("T   "),cTID("Chnl"),P),executeAction(cTID("setd"),e,DialogModes.NO);
/* =======================================================select RGB */
var B=new ActionDescriptor,G=new ActionReference;G.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("RGB ")),B.putReference(cTID("null"),G),B.putBoolean(cTID("MkVs"),!1),executeAction(cTID("slct"),B,DialogModes.NO)}function setBackTheLayerMask(){
/* =======================================================make mask */
var e=charIDToTypeID("Mk  "),t=new ActionDescriptor,r=charIDToTypeID("Nw  "),n=charIDToTypeID("Chnl");t.putClass(r,n);var c=charIDToTypeID("At  "),o=new ActionReference,a=(n=charIDToTypeID("Chnl"),n=charIDToTypeID("Chnl"),charIDToTypeID("Msk "));o.putEnumerated(n,n,a),t.putReference(c,o);var D=charIDToTypeID("Usng"),I=charIDToTypeID("UsrM"),i=charIDToTypeID("RvlA");t.putEnumerated(D,I,i),executeAction(e,t,DialogModes.NO);
/* ======================================================= */
var T=cTID("slct"),p=new ActionDescriptor,u=cTID("null"),y=new ActionReference;n=cTID("Chnl");y.putName(n,"mbTemp_alpha"),p.putReference(u,y),executeAction(T,p,DialogModes.NO);
/* ======================================================= */
var s=cTID("setd"),l=new ActionDescriptor,h=(u=cTID("null"),new ActionReference),g=(n=cTID("Chnl"),cTID("fsel"));h.putProperty(n,g),l.putReference(u,h);var d=cTID("T   "),A=cTID("Ordn"),f=cTID("Al  ");l.putEnumerated(d,A,f),executeAction(s,l,DialogModes.NO);
/* ======================================================= */
var v=cTID("copy");executeAction(v,void 0,DialogModes.NO),
/* ======================================================= */
selectLayerMask();var x=new ActionDescriptor;(N=new ActionReference).putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk ")),x.putReference(cTID("null"),N),x.putBoolean(cTID("MkVs"),!0),executeAction(cTID("slct"),x,DialogModes.NO);
/* ======================================================= */
var m=charIDToTypeID("PstI"),L=new ActionDescriptor,S=charIDToTypeID("AntA"),w=charIDToTypeID("Annt"),k=charIDToTypeID("Anno");L.putEnumerated(S,w,k),executeAction(m,L,DialogModes.NO);
/* =======================================================select RGB */
var R=new ActionDescriptor,M=new ActionReference;M.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("RGB ")),R.putReference(cTID("null"),M),R.putBoolean(cTID("MkVs"),!1),executeAction(cTID("slct"),R,DialogModes.NO);
/* ======================================================= */
s=charIDToTypeID("setd");var O=new ActionDescriptor,b=(u=charIDToTypeID("null"),new ActionReference);n=charIDToTypeID("Chnl"),g=charIDToTypeID("fsel");b.putProperty(n,g),O.putReference(u,b);d=charIDToTypeID("T   "),A=charIDToTypeID("Ordn");var E=charIDToTypeID("None");O.putEnumerated(d,A,E),executeAction(s,O,DialogModes.NO);
/* ======================================================= */
var N;x=new ActionDescriptor;(N=new ActionReference).putName(charIDToTypeID("Chnl"),"mbTemp_alpha"),x.putReference(charIDToTypeID("null"),N),executeAction(charIDToTypeID("Dlt "),x,DialogModes.NO)}function getMaskDensity(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).getUnitDoubleValue(sTID("userMaskDensity"))}function getMaskFeather(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).getUnitDoubleValue(sTID("userMaskFeather"))}function isLayerMaskEnabled(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).getBoolean(cTID("UsrM"))}function isLayerMaskLinked(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).getBoolean(cTID("Usrs"))}function setMaskDensityTo(e){
//     var idsetd = charIDToTypeID( "setd" );
//       var desc21 = new ActionDescriptor();
//       var idnull = charIDToTypeID( "null" );
//           var ref11 = new ActionReference();
//           var idLyr = charIDToTypeID( "Lyr " );
//           var idOrdn = charIDToTypeID( "Ordn" );
//           var idTrgt = charIDToTypeID( "Trgt" );
//           ref11.putEnumerated( idLyr, idOrdn, idTrgt );
//       desc21.putReference( idnull, ref11 );
//       var idT = charIDToTypeID( "T   " );
//           var desc22 = new ActionDescriptor();
//           var iduserMaskDensity = stringIDToTypeID( "userMaskDensity" );
//           var idPrc = charIDToTypeID( "#Prc" );
//           desc22.putUnitDouble( iduserMaskDensity, idPrc, dens );
//       var idLyr = charIDToTypeID( "Lyr " );
//       desc21.putObject( idT, idLyr, desc22 );
//   executeAction( idsetd, desc21, DialogModes.NO );
var t=new ActionDescriptor,r=new ActionDescriptor,n=new ActionReference;n.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),t.putReference(c2t("null"),n),r.putUnitDouble(s2t("userMaskDensity"),s2t("percentUnit"),e),t.putObject(s2t("to"),s2t("layer"),r),executeAction(s2t("set"),t,DialogModes.NO)}function setMaskFeatherTo(e){var t=charIDToTypeID("setd"),r=new ActionDescriptor,n=charIDToTypeID("null"),c=new ActionReference,o=charIDToTypeID("Lyr "),a=charIDToTypeID("Ordn"),D=charIDToTypeID("Trgt");c.putEnumerated(o,a,D),r.putReference(n,c);var I=charIDToTypeID("T   "),i=new ActionDescriptor,T=stringIDToTypeID("userMaskFeather"),p=charIDToTypeID("#Prc");i.putUnitDouble(T,p,e);o=charIDToTypeID("Lyr ");r.putObject(I,o,i),executeAction(t,r,DialogModes.NO)}function setMaskEnabled(e){var t=charIDToTypeID("setd"),r=new ActionDescriptor,n=charIDToTypeID("null"),c=new ActionReference,o=charIDToTypeID("Lyr "),a=charIDToTypeID("Ordn"),D=charIDToTypeID("Trgt");c.putEnumerated(o,a,D),r.putReference(n,c);var I=charIDToTypeID("T   "),i=new ActionDescriptor,T=charIDToTypeID("UsrM");i.putBoolean(T,e);o=charIDToTypeID("Lyr ");r.putObject(I,o,i),executeAction(t,r,DialogModes.NO)}function setMaskLinked(e){var t=charIDToTypeID("setd"),r=new ActionDescriptor,n=charIDToTypeID("null"),c=new ActionReference,o=charIDToTypeID("Lyr "),a=charIDToTypeID("Ordn"),D=charIDToTypeID("Trgt");c.putEnumerated(o,a,D),r.putReference(n,c);var I=charIDToTypeID("T   "),i=new ActionDescriptor,T=charIDToTypeID("Usrs");i.putBoolean(T,e);o=charIDToTypeID("Lyr ");r.putObject(I,o,i),executeAction(t,r,DialogModes.NO)}function isLayerFXVisible(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).getBoolean(cTID("lfxv"))}function copyLayerStyle(){var e=charIDToTypeID("CpFX");executeAction(e,void 0,DialogModes.NO)}function pasteLayerStyle(){var e=charIDToTypeID("PaFX"),t=new ActionDescriptor,r=stringIDToTypeID("allowPasteFXOnLayerSet");t.putBoolean(r,!0),executeAction(e,t,DialogModes.NO)}function hasVectorMask(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).getBoolean(sTID("hasVectorMask"))}function getVectorMaskDensity(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).getInteger(sTID("vectorMaskDensity"))}function getVectorMaskFeather(){var e=new ActionReference;return e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt")),executeActionGet(e).getUnitDoubleValue(sTID("vectorMaskFeather"))}function setVectorMaskDensityTo(e){var t=charIDToTypeID("setd"),r=new ActionDescriptor,n=charIDToTypeID("null"),c=new ActionReference,o=charIDToTypeID("Lyr "),a=charIDToTypeID("Ordn"),D=charIDToTypeID("Trgt");c.putEnumerated(o,a,D),r.putReference(n,c);var I=charIDToTypeID("T   "),i=new ActionDescriptor,T=stringIDToTypeID("vectorMaskDensity"),p=charIDToTypeID("#Prc");i.putUnitDouble(T,p,e);o=charIDToTypeID("Lyr ");r.putObject(I,o,i),executeAction(t,r,DialogModes.NO)}function setVectorMaskFeatherTo(e){var t=charIDToTypeID("setd"),r=new ActionDescriptor,n=charIDToTypeID("null"),c=new ActionReference,o=charIDToTypeID("Lyr "),a=charIDToTypeID("Ordn"),D=charIDToTypeID("Trgt");c.putEnumerated(o,a,D),r.putReference(n,c);var I=charIDToTypeID("T   "),i=new ActionDescriptor,T=stringIDToTypeID("vectorMaskFeather"),p=charIDToTypeID("#Prc");i.putUnitDouble(T,p,e);o=charIDToTypeID("Lyr ");r.putObject(I,o,i),executeAction(t,r,DialogModes.NO)}function isLocked(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var t=executeActionGet(e);return a=t.getObjectValue(sTID("layerLocking")),a.getBoolean(sTID("protectAll"))}function unlock(){var e=charIDToTypeID("setd"),t=new ActionDescriptor,r=charIDToTypeID("null"),n=new ActionReference,c=charIDToTypeID("Lyr "),o=charIDToTypeID("Ordn"),a=charIDToTypeID("Trgt");n.putEnumerated(c,o,a),t.putReference(r,n);var D=charIDToTypeID("T   "),I=new ActionDescriptor,i=stringIDToTypeID("layerLocking"),T=new ActionDescriptor,p=stringIDToTypeID("protectNone");T.putBoolean(p,!0);i=stringIDToTypeID("layerLocking");I.putObject(i,i,T);c=charIDToTypeID("Lyr ");t.putObject(D,c,I),executeAction(e,t,DialogModes.NO)}function lock(){var e=charIDToTypeID("setd"),t=new ActionDescriptor,r=charIDToTypeID("null"),n=new ActionReference,c=charIDToTypeID("Lyr "),o=charIDToTypeID("Ordn"),a=charIDToTypeID("Trgt");n.putEnumerated(c,o,a),t.putReference(r,n);var D=charIDToTypeID("T   "),I=new ActionDescriptor,i=stringIDToTypeID("layerLocking"),T=new ActionDescriptor,p=stringIDToTypeID("protectAll");T.putBoolean(p,!0);i=stringIDToTypeID("layerLocking");I.putObject(i,i,T);c=charIDToTypeID("Lyr ");t.putObject(D,c,I),executeAction(e,t,DialogModes.NO)}function getColor(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var t=executeActionGet(e);return a=t.getEnumerationValue(cTID("Clr ")),typeIDToCharID(a)}function setColorTo(e){var t=charIDToTypeID("setd"),r=new ActionDescriptor,n=charIDToTypeID("null"),c=new ActionReference,o=charIDToTypeID("Lyr "),a=charIDToTypeID("Ordn"),D=charIDToTypeID("Trgt");c.putEnumerated(o,a,D),r.putReference(n,c);var I=charIDToTypeID("T   "),i=new ActionDescriptor,T=charIDToTypeID("Clr "),p=(T=charIDToTypeID("Clr "),charIDToTypeID(e));i.putEnumerated(T,T,p);o=charIDToTypeID("Lyr ");r.putObject(I,o,i),executeAction(t,r,DialogModes.NO)}function activateLayerMask(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk ")),e.putReference(cTID("null"),t);try{executeAction(cTID("slct"),e,DialogModes.NO)}catch(e){var r=new TemporaryAlpha;maskFromSelection(),activateLayerMask(),r.consume()}}function deleteMask(e){e&&loadSelectionOfMask();var t=new ActionDescriptor,r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Ordn"),cTID("Trgt")),t.putReference(cTID("null"),r);try{executeAction(cTID("Dlt "),t,DialogModes.NO)}catch(e){}}function selectLayerMask(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk ")),e.putReference(cTID("null"),t),e.putBoolean(cTID("MkVs"),!1);try{executeAction(cTID("slct"),e,DialogModes.NO)}catch(e){}}function loadSelectionOfMask(){selectLayerMask();var e=new ActionDescriptor,t=new ActionReference;t.putProperty(cTID("Chnl"),cTID("fsel")),e.putReference(cTID("null"),t);var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Ordn"),cTID("Trgt")),e.putReference(cTID("T   "),r);try{executeAction(cTID("setd"),e,DialogModes.NO)}catch(e){}}function maskFromSelection(){if(hasLayerMask())confirm("Delete existing mask?",!0,"Warning")&&(activateLayerMask(),deleteMask());else{var e=new ActionDescriptor;e.putClass(cTID("Nw  "),cTID("Chnl"));var t=new ActionReference;t.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk ")),e.putReference(cTID("At  "),t),e.putEnumerated(cTID("Usng"),cTID("UsrM"),cTID("RvlS"));try{executeAction(cTID("Mk  "),e,DialogModes.NO)}catch(e){activeDocument.selection.selectAll(),maskFromSelection()}}}function duplicateVectorMask(){var e=charIDToTypeID("slct"),t=new ActionDescriptor,r=charIDToTypeID("null"),n=new ActionReference,c=charIDToTypeID("Path"),o=(c=charIDToTypeID("Path"),stringIDToTypeID("vectorMask"));n.putEnumerated(c,c,o);var a=charIDToTypeID("Lyr "),D=charIDToTypeID("Ordn"),I=charIDToTypeID("Trgt");n.putEnumerated(a,D,I),t.putReference(r,n),executeAction(e,t,DialogModes.NO);var i=charIDToTypeID("Mk  "),T=new ActionDescriptor,p=(r=charIDToTypeID("null"),new ActionReference);c=charIDToTypeID("Path");p.putClass(c),T.putReference(r,p);var u=charIDToTypeID("From"),y=new ActionReference;c=charIDToTypeID("Path"),c=charIDToTypeID("Path"),o=stringIDToTypeID("vectorMask");y.putEnumerated(c,c,o);a=charIDToTypeID("Lyr "),D=charIDToTypeID("Ordn"),I=charIDToTypeID("Trgt");y.putEnumerated(a,D,I),T.putReference(u,y),executeAction(i,T,DialogModes.NO);var s=charIDToTypeID("Rnm "),l=new ActionDescriptor,h=(r=charIDToTypeID("null"),new ActionReference);c=charIDToTypeID("Path"),D=charIDToTypeID("Ordn"),I=charIDToTypeID("Trgt");h.putEnumerated(c,D,I),l.putReference(r,h);var g=charIDToTypeID("T   ");l.putString(g,"mbTemp_path"),executeAction(s,l,DialogModes.NO);var d=charIDToTypeID("Dslc"),A=new ActionDescriptor,f=(r=charIDToTypeID("null"),new ActionReference);c=charIDToTypeID("Path");f.putClass(c),A.putReference(r,f),executeAction(d,A,DialogModes.NO)}function recreateVectorMask(){
/* ======================================================= */
var e=charIDToTypeID("slct"),t=new ActionDescriptor,r=charIDToTypeID("null"),n=new ActionReference,c=charIDToTypeID("Path");n.putName(c,"mbTemp_path"),t.putReference(r,n),executeAction(e,t,DialogModes.NO);
/* ======================================================= */
var o=charIDToTypeID("Mk  "),a=new ActionDescriptor,D=(r=charIDToTypeID("null"),new ActionReference);c=charIDToTypeID("Path");D.putClass(c),a.putReference(r,D);var I=charIDToTypeID("At  "),i=new ActionReference,T=(c=charIDToTypeID("Path"),c=charIDToTypeID("Path"),stringIDToTypeID("vectorMask"));i.putEnumerated(c,c,T),a.putReference(I,i);var p=charIDToTypeID("Usng"),u=new ActionReference,y=(c=charIDToTypeID("Path"),charIDToTypeID("Ordn")),s=charIDToTypeID("Trgt");u.putEnumerated(c,y,s),a.putReference(p,u),executeAction(o,a,DialogModes.NO);
/* ======================================================= */
var l=new ActionDescriptor,h=new ActionReference;h.putName(charIDToTypeID("Path"),"mbTemp_path"),l.putReference(charIDToTypeID("null"),h),executeAction(charIDToTypeID("Dlt "),l,DialogModes.NO)}function groupSelected(e){var t=new ActionDescriptor,r=new ActionReference;r.putClass(sTID("layerSection")),t.putReference(cTID("null"),r);var n=new ActionReference;n.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt")),t.putReference(cTID("From"),n);var c=new ActionDescriptor;return c.putString(cTID("Nm  "),e),t.putObject(cTID("Usng"),sTID("layerSection"),c),executeAction(cTID("Mk  "),t,DialogModes.NO),activeDocument.activeLayer}function addToSelection(e){var t=new ActionDescriptor,r=new ActionReference;r.putName(cTID("Lyr "),e),t.putReference(cTID("null"),r),t.putEnumerated(sTID("selectionModifier"),sTID("selectionModifierType"),sTID("addToSelection")),t.putBoolean(cTID("MkVs"),!1);try{executeAction(cTID("slct"),t,DialogModes.NO)}catch(e){}}function TemporaryAlpha(){activeDocument.selection.store(this.alpha=activeDocument.channels.add()),activeDocument.selection.deselect(),this.consume=function(){activeDocument.selection.load(this.alpha),this.alpha.remove()}}function makeActiveByIndex(e,t){e.constructor!=Array&&(e=[e]);for(var r=0;r<e.length;r++){var n=new ActionDescriptor,c=new ActionReference;if(c.putIndex(charIDToTypeID("Lyr "),e[r]),n.putReference(charIDToTypeID("null"),c),r>0){var o=stringIDToTypeID("selectionModifier"),a=stringIDToTypeID("selectionModifierType"),D=stringIDToTypeID("addToSelection");n.putEnumerated(o,a,D)}n.putBoolean(charIDToTypeID("MkVs"),t),executeAction(charIDToTypeID("slct"),n,DialogModes.NO)}}function deleteActiveLayer(){var e=charIDToTypeID("Dlt "),t=new ActionDescriptor,r=charIDToTypeID("null"),n=new ActionReference,c=charIDToTypeID("Lyr "),o=charIDToTypeID("Ordn"),a=charIDToTypeID("Trgt");n.putEnumerated(c,o,a),t.putReference(r,n),executeAction(e,t,DialogModes.NO)}function isLayerSet(e){var t=stringIDToTypeID("layerSection"),r=new ActionReference;r.putProperty(charIDToTypeID("Prpr"),t),r.putIndex(charIDToTypeID("Lyr "),e);var n=executeActionGet(r).getEnumerationValue(t);return"layerSectionStart"==typeIDToStringID(n)}function openGroup1(e){currSetIDX=getActiveLayerIndex(),isLayerSet(currSetIDX)&&getNamesPlusIDsOfLayerSet(),makeActiveByIndex(currSetIDX,!1)}function openGroup1byIDX(e){isLayerSet(e)&&getNamesPlusIDsOfLayerSet(),makeActiveByIndex(e,!1)}function getNamesPlusIDsOfLayerSet(){var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));executeActionGet(e).getInteger(charIDToTypeID("Cnt ")),executeActionGet(e).getInteger(stringIDToTypeID("layerID"));var t=[],r=0,n=0;currINDEX=getActiveLayerIndex();for(var c=currINDEX;c>0;c--){(e=new ActionReference).putIndex(charIDToTypeID("Lyr "),c);var o=executeActionGet(e),a=o.getString(charIDToTypeID("Nm  ")),D=o.getInteger(stringIDToTypeID("layerID")),I=o.getEnumerationValue(stringIDToTypeID("layerSection"));
/* alert(layerName+": _ :"+ls); */
"layerSectionStart"==(I=typeIDToStringID(I))&&r++;
/*        if (layerName.match(/^<\/Layer group/)) { */
var i=new RegExp("^</Layer group");if(a.match(i)){if(0==r-++n&&"layerSectionEnd"==I)break}else{if("layerSectionContent"==I){makeActiveByIndex(c,!1);break}var T="layerSectionContent"!=typeIDToStringID(o.getEnumerationValue(stringIDToTypeID("layerSection")));t.push([[D],[a],[T]])}}return t}/* function to find out if the number of layers in the document */
function getLayersNb(){var e=new ActionReference;return e.putProperty(charIDToTypeID("Prpr"),stringIDToTypeID("numberOfLayers")),e.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt")),executeActionGet(e).getInteger(stringIDToTypeID("numberOfLayers"))}function toogleOpenCloseSet(){if(myALayerIDX=getActiveLayerIndex(),myGroupP=app.activeDocument.activeLayer,isLayerSet(myALayerIDX))getNbOfChilds()>1&&(isSetOpened1(myGroupP)?closeGroup(myGroupP):openGroup1(myGroupP));else{myGroupP=app.activeDocument.activeLayer.parent;try{app.activeDocument.activeLayer=myGroupP}catch(e){return}getNbOfChilds()>1&&"Document"!=myGroupP.typename&&(isSetOpened1(myGroupP)?closeGroup(myGroupP):openGroup1(myGroupP))}}function getFristLayerSetChildVisible(){xx=!1;var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));executeActionGet(e).getInteger(charIDToTypeID("Cnt "));var t=executeActionGet(e).getInteger(stringIDToTypeID("layerID")),r=[],n=0,c=0,o=0;currINDEX=getActiveLayerIndex();for(var a=currINDEX;a>0;a--){(e=new ActionReference).putIndex(charIDToTypeID("Lyr "),a);var D=executeActionGet(e),I=D.getString(charIDToTypeID("Nm  ")),i=D.getInteger(stringIDToTypeID("layerID")),T=D.getEnumerationValue(stringIDToTypeID("layerSection"));if(
/* alert(layerName+": _ :"+vis); */
/*        if(desc.hasKey(stringIDToTypeID("visible")))
          {
            alert(desc.getType(stringIDToTypeID("visible")));
          };*/
"layerSectionStart"==(T=typeIDToStringID(T))&&n++,1==D.getInteger(stringIDToTypeID("visible"))&&i!=t&&0!=o){var p={id:i,lname:I,idx:a};xx=!0,r.push(p);break}
/*      if(layerName.match(/^<\/Layer group/) ) */var u=new RegExp("^</Layer group");if(I.match(u)){if(0==(o=n-++c)&&"layerSectionEnd"==T)break}else;}return r}function getLastChildIdx(){xx=!1;var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));executeActionGet(e).getInteger(charIDToTypeID("Cnt ")),executeActionGet(e).getInteger(stringIDToTypeID("layerID"));currINDEX=getActiveLayerIndex();for(var t=currINDEX,r=0,n=0,c=0;t>0;t--){(e=new ActionReference).putIndex(charIDToTypeID("Lyr "),t);var o=executeActionGet(e),a=o.getString(charIDToTypeID("Nm  ")),D=(o.getInteger(stringIDToTypeID("layerID")),o.getEnumerationValue(stringIDToTypeID("layerSection")));D=typeIDToStringID(D);o.getInteger(stringIDToTypeID("visible"));"layerSectionStart"==D&&r++;
/*      if(layerName.match(/^<\/Layer group/)) {*/
var I=new RegExp("^</Layer group");if(a.match(I)&&0==r-++n&&"layerSectionEnd"==D){c=t;break}
/* alert(x+" _ "+y+" _ "+r+" _ "+layerName); */}return c}function getNbOfChilds(){xx=!1;var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));executeActionGet(e).getInteger(charIDToTypeID("Cnt ")),executeActionGet(e).getInteger(stringIDToTypeID("layerID"));currINDEX=getActiveLayerIndex();for(var t=currINDEX,r=0,n=0,c=0;t>0;t--){(e=new ActionReference).putIndex(charIDToTypeID("Lyr "),t);var o=executeActionGet(e),a=o.getString(charIDToTypeID("Nm  ")),D=(o.getInteger(stringIDToTypeID("layerID")),o.getEnumerationValue(stringIDToTypeID("layerSection")));D=typeIDToStringID(D);o.getInteger(stringIDToTypeID("visible"));"layerSectionStart"==D&&n++;
/*      if(layerName.match(/^<\/Layer group/)) {*/
var I=new RegExp("^</Layer group");if(a.match(I)){if(0==n-++c&&"layerSectionEnd"==D)break}else r++}return r}function isSetOpened1(e){app.activeDocument.activeLayer=e,mb_Locked=isLocked(),mb_visible=isVisible(),1==mb_Locked&&unlock(),xx=!0,currSetIDX=getActiveLayerIndex(),currSetIDX1=getActiveLayerIndex(),hasBackground()||(currSetIDX1-=1),addTempLayerSetIn(currSetIDX1);var t=getActiveLayerIndex();return makeActiveByIndex(currSetIDX+2,!1),t==getActiveLayerIndex()&&(xx=!1),deleteTempLayerSetbyIdx(currSetIDX+1),1==mb_Locked&&lock(),0==mb_visible&&hide(),xx}function isSetOpened2(e){makeActiveByIndex(e,!1),mb_Locked=isLocked(),mb_visible=isVisible(),1==mb_Locked&&unlock(),xx=!0,currSetIDX=getActiveLayerIndex(),currSetIDX1=getActiveLayerIndex(),hasBackground()||(currSetIDX1-=1),addTempLayerSetIn(currSetIDX1);var t=getActiveLayerIndex();return makeActiveByIndex(currSetIDX+2,!1),t==getActiveLayerIndex()&&(xx=!1),deleteTempLayerSetbyIdx(currSetIDX+1),1==mb_Locked&&lock(),0==mb_visible&&hide(),xx}function addTempLayerSetIn(e){
/* ======================================================= */
var t=charIDToTypeID("Mk  "),r=new ActionDescriptor,n=charIDToTypeID("null"),c=new ActionReference,o=stringIDToTypeID("layerSection");c.putClass(o),r.putReference(n,c),executeAction(t,r,DialogModes.NO);
/* =======================================================rename */
var a=charIDToTypeID("setd"),D=new ActionDescriptor,I=(n=charIDToTypeID("null"),new ActionReference),i=charIDToTypeID("Lyr "),T=charIDToTypeID("Ordn"),p=charIDToTypeID("Trgt");I.putEnumerated(i,T,p),D.putReference(n,I);var u=charIDToTypeID("T   "),y=new ActionDescriptor,s=charIDToTypeID("Nm  ");y.putString(s,"mb-dummy tempTestLayerSetOpen_Closed");i=charIDToTypeID("Lyr ");D.putObject(u,i,y),executeAction(a,D,DialogModes.NO);
/* =======================================================move */
var l=charIDToTypeID("move"),h=new ActionDescriptor,g=(n=charIDToTypeID("null"),new ActionReference);i=charIDToTypeID("Lyr "),T=charIDToTypeID("Ordn"),p=charIDToTypeID("Trgt");g.putEnumerated(i,T,p),h.putReference(n,g);u=charIDToTypeID("T   ");var d=new ActionReference;i=charIDToTypeID("Lyr ");d.putIndex(i,e),h.putReference(u,d);var A=charIDToTypeID("Adjs");h.putBoolean(A,!1);var f=charIDToTypeID("Vrsn");h.putInteger(f,5),executeAction(l,h,DialogModes.NO)}function deleteTempLayerSetbyIdx(e){
/* ======================================================= */
var t=charIDToTypeID("Dlt "),r=new ActionDescriptor,n=new ActionReference;n.putIndex(charIDToTypeID("Lyr "),e),
/* ref.putIdentifier(charIDToTypeID( 'Lyr ' ), idxx); */
r.putReference(charIDToTypeID("null"),n),executeAction(t,r,DialogModes.NO)}function myselectNext(){currINDEX=getActiveLayerIndex(),lastSetIdx=0,lastLayer=0,testIDX=1,hasBackground()&&(lastLayer=-1,testIDX=0),isLayerSet(currINDEX)&&(getNbOfChilds()>1?isSetOpened2(currINDEX)||(lastSetIdx=getLastChildIdx(),currINDEX=lastSetIdx):currINDEX-=1),nextIndex=currINDEX-1,nextIndex<=lastLayer&&(nextIndex=getLayersNb());
/*  if(getLayerName(nextIndex).match(/^<\/Layer group/)){ */
var e=new RegExp("^</Layer group");if(getLayerName(nextIndex).match(e))for(bb=nextIndex-1,bb;bb>0;bb--){
/*      if(getLayerName(bb).match(/^<\/Layer group/)){ */
e=new RegExp("^</Layer group");if(!getLayerName(bb).match(e))break;nextIndex--}try{makeActiveByIndex(nextIndex,!1)}catch(e){}if(currINDEX!=testIDX&&getActiveLayerIndex()==getLayersNb())try{makeActiveByIndex(nextIndex-1,!1)}catch(e){}}function addNext(){theCurrentSelectionIDX=getSelectedLayersIdx(),makeActiveByIndex(theCurrentSelectionIDX[0],!1),myselectNext(),theCurrentSelectionIDX.push(getActiveLayerIndex()),makeActiveByIndex(theCurrentSelectionIDX,!1)}function isEndOfSet(e){xx=!1,ref=new ActionReference,ref.putIndex(charIDToTypeID("Lyr "),e);var t=executeActionGet(ref),r=t.getString(charIDToTypeID("Nm  ")),n=(t.getInteger(stringIDToTypeID("layerID")),t.getEnumerationValue(stringIDToTypeID("layerSection")));n=typeIDToStringID(n);t.getInteger(stringIDToTypeID("visible"));
/*if(layerName.match(/^<\/Layer group/)) {*/var c=new RegExp("^</Layer group");return r.match(c)&&"layerSectionEnd"==n&&(xx=!0),xx}function getStartIDXfor(e){xx=!1;var t=getLayersNb();currINDEX=e;
/* alert(i + " count: "+count); */
for(var r=currINDEX,n=0,c=0,o=0;r<=t;r++){ref=new ActionReference,ref.putIndex(charIDToTypeID("Lyr "),r);var a=executeActionGet(ref),D=(a.getString(charIDToTypeID("Nm  ")),a.getInteger(stringIDToTypeID("layerID")),a.getEnumerationValue(stringIDToTypeID("layerSection")));D=typeIDToStringID(D);a.getInteger(stringIDToTypeID("visible"));
/* alert(ls +" _ "+ r + " i_ "+ i + " name_ "+layerName); */if("layerSectionEnd"==D&&c++,"layerSectionStart"==D&&o++,0==c-o&&"layerSectionStart"==D){n=r;break}}return n}function myselectPrevious(){for(nbL=getLayersNb(),currINDEX=getActiveLayerIndex(),lastSetIdx=0,lastLayer=1,hasBackground()&&(lastLayer=0),currINDEX==nbL?nextIndex=lastLayer:nextIndex=currINDEX+1,b=getLayersNb(),aa=0;aa<b&&isEndOfSet(nextIndex);aa++)parentIDX=getStartIDXfor(nextIndex),isSetOpened2(parentIDX)?nextIndex++:nextIndex=parentIDX;try{makeActiveByIndex(nextIndex,!1)}catch(e){}if(getActiveLayerIndex()==getLayersNb()){nextIndex++;try{makeActiveByIndex(nextIndex,!1)}catch(e){}}}function addPrevious(){theCurrentSelectionIDX=getSelectedLayersIdx(),makeActiveByIndex(theCurrentSelectionIDX[theCurrentSelectionIDX.length-1],!1),myselectPrevious(),theCurrentSelectionIDX.push(getActiveLayerIndex()),makeActiveByIndex(theCurrentSelectionIDX,!1)}function myselectNextFor(e){for(i=0;i<e;i++)myselectNext()}function getVisible(){var e=new ActionReference;return e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt")),executeActionGet(e).getInteger(stringIDToTypeID("visible"))}function getVisibleforIDX(e){var t=new ActionReference;return t.putIndex(charIDToTypeID("Lyr "),e),executeActionGet(t).getInteger(stringIDToTypeID("visible"))}function toogleVisibility(){if(getVisible()){var e=new ActionDescriptor,t=new ActionList;(r=new ActionReference).putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt")),t.putReference(r),e.putList(charIDToTypeID("null"),t),executeAction(charIDToTypeID("Hd  "),e,DialogModes.NO)}else{var r;e=new ActionDescriptor,t=new ActionList;(r=new ActionReference).putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt")),t.putReference(r),e.putList(charIDToTypeID("null"),t),executeAction(charIDToTypeID("Shw "),e,DialogModes.NO)}}function showOnlyThis(){selectionIDX=getSelectedLayersIdx(),setBack=!1;for(i=0;i<selectionIDX.length;i++)for(par in theParents=loopParentsIDXfor(selectionIDX[i]),theParents)isVisibleIDX(theParents[par])||(selectionIDX.push(theParents[par]));
/* makeActiveByIndex(selectionIDX,false); */if(selectionIDX.length>1){
/* ======================================================= */
var e=charIDToTypeID("Shw "),t=new ActionDescriptor,r=charIDToTypeID("null"),n=new ActionList,c=new ActionReference,o=charIDToTypeID("Lyr "),D=charIDToTypeID("Ordn"),I=charIDToTypeID("Trgt");c.putEnumerated(o,D,I),n.putReference(c),t.putList(r,n);var T=charIDToTypeID("TglO");if(t.putBoolean(T,!0),executeAction(e,t,DialogModes.NO),0==setBack)for(i=0;i<selectionIDX.length;i++)makeVisByIndex(selectionIDX[i],!0);
/*      for(i =selectionIDX.length-1;i>=0;i--){
          if(toDeselect != 0){
            removeFromSel(selectionIDX[i]);
            toDeselect --;
          }else{break};
        }*/else for(a=0;a<selectionIDX.length;a++);}else{
/* ======================================================= */
e=charIDToTypeID("Shw "),t=new ActionDescriptor,r=charIDToTypeID("null"),n=new ActionList,c=new ActionReference,o=charIDToTypeID("Lyr "),D=charIDToTypeID("Ordn"),I=charIDToTypeID("Trgt");c.putEnumerated(o,D,I),n.putReference(c),t.putList(r,n);T=charIDToTypeID("TglO");t.putBoolean(T,!0),executeAction(e,t,DialogModes.NO)}}function removeFromSel(e){var t=new ActionDescriptor,r=new ActionReference;r.putIndex(charIDToTypeID("Lyr "),e),t.putReference(charIDToTypeID("null"),r),t.putEnumerated(stringIDToTypeID("selectionModifier"),stringIDToTypeID("selectionModifierType"),stringIDToTypeID("removeFromSelection"));var n=charIDToTypeID("MkVs");t.putBoolean(n,!1),executeAction(charIDToTypeID("slct"),t,DialogModes.NO)}function makeVisByIndex(e,t){if(1==t)var r=charIDToTypeID("Shw ");else r=charIDToTypeID("Hd  ");var n=new ActionDescriptor,c=new ActionReference;c.putIndex(charIDToTypeID("Lyr "),e),n.putReference(charIDToTypeID("null"),c),executeAction(r,n,DialogModes.NO)}function getSelectedLayersIdx(){var e=new Array;(t=new ActionReference).putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var t,r=executeActionGet(t),n=1;if(hasBackground()&&(n=0),r.hasKey(stringIDToTypeID("targetLayers")))for(var c=(r=r.getList(stringIDToTypeID("targetLayers"))).count,o=(e=new Array,0);o<c;o++)e.push(r.getReference(o).getIndex()+n);else(t=new ActionReference).putProperty(charIDToTypeID("Prpr"),charIDToTypeID("ItmI")),t.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt")),srs=hasBackground()?executeActionGet(t).getInteger(charIDToTypeID("ItmI"))-1:executeActionGet(t).getInteger(charIDToTypeID("ItmI")),e.push(srs);return e}function selectParent(){try{app.activeDocument.activeLayer=app.activeDocument.activeLayer.parent}catch(e){}}function getParentIDXfor(e){xx=!1;var t=getLayersNb();currINDEX=e;var r=currINDEX,n=0,c=1,o=0;try{isLayerSet(e)&&(o=-1)}catch(e){return}for(;r<=t;r++){ref=new ActionReference,ref.putIndex(charIDToTypeID("Lyr "),r);var a=executeActionGet(ref),D=(a.getString(charIDToTypeID("Nm  ")),a.getInteger(stringIDToTypeID("layerID")),a.getEnumerationValue(stringIDToTypeID("layerSection")));D=typeIDToStringID(D);a.getInteger(stringIDToTypeID("visible"));
/* alert(ls +" _ "+x+"-"+y+"="+r+ " idx_ "+ i + " name_ "+layerName); */
if("layerSectionEnd"==D&&c++,"layerSectionStart"==D&&o++,0==c-o&&"layerSectionStart"==D){n=r;break}}return n}function loopParentsIDXfor(e){var t=new Array,r=getLayersNb(),n=getParentIDXfor(e);for(k=0;k<r&&0!=n;k++)t.push(n),n=getParentIDXfor(n);
/* alert(parents); */return t}function hasBackground(){var e=void 0;try{var t=new ActionReference;t.putProperty(cTID("Prpr"),cTID("Nm  ")),t.putIndex(cTID("Lyr "),0),executeActionGet(t).getString(cTID("Nm  ")),e=!0}catch(t){e=!1}return e}function getLayerName(e){var t=new ActionReference;return t.putIndex(cTID("Lyr "),e),executeActionGet(t).getString(charIDToTypeID("Nm  "))}function getSibilings(){theSlIDX=getSelectedLayersIdx();var e=[],t=[];for(a in theSlIDX)t.push(getParentIDXfor(theSlIDX[a]));for(l in t=eliminateDuplicates(t)){parent=t[l],count=getLayersNb();var n=0;for(0==parent?i=count:i=parent-1,hasBackground()||(n=1),x=0,y=0,r=0,i;i>=n;i--){ref=new ActionReference,ref.putIndex(charIDToTypeID("Lyr "),i);var c=executeActionGet(ref),o=(c.getString(charIDToTypeID("Nm  ")),c.getEnumerationValue(stringIDToTypeID("layerSection")));if(o=typeIDToStringID(o),e.push(i),
/* alert(layerName +" _ "+ r+ " - " + i); */
i==theSlIDX[l]&&
/* alert("remove: " + i); */
e.pop(1),0!=r&&i!=theSlIDX[l]&&
/* alert("remove: " + i); */
e.pop(1),"layerSectionStart"==o&&x++,"layerSectionEnd"==o&&(y++,0==r))break;r=x-y}}return e}function getSibilings1(){theSlIDX=getSelectedLayersIdx();var e=[];count=getLayersNb();var t=0,n=count;tempSibilings={},hasBackground()||(t=1),x=0,y=0,r=0,parent=[0],oldParent=0,whatSibilingsMatterO={};var o=[];for(e=[];n>=t;n--){ref=new ActionReference,ref.putIndex(charIDToTypeID("Lyr "),n);var a=executeActionGet(ref).getEnumerationValue(stringIDToTypeID("layerSection"));
/* var layerName = desc.getString(charIDToTypeID( 'Nm  ' )); */a=typeIDToStringID(a),cparent=parent[parent.length-1].toString(),(o=null==tempSibilings[cparent]?[]:tempSibilings[cparent]).push(n),tempSibilings[cparent]=o,"layerSectionStart"==a&&parent.push(n),"layerSectionEnd"==a&&parent.pop(1),n==theSlIDX[theSlIDX.length-1]&&(/*if is the selected one */
theSlIDX.pop(1),whatSibilingsMatterO[cparent]=cparent,tss1=tempSibilings[cparent],tss1.pop(1),/*remove current */
tempSibilings[cparent]=tss1)}for(c in whatSibilingsMatterO)
/* alert(c+" : "+tempSibilings[whatSibilingsMatterO[c]]); */
e=e.concat(tempSibilings[whatSibilingsMatterO[c]]);return e}function addSibilings(){theSelIDX1=getSelectedLayersIdx(),theSibilings=getSibilings1(),makeActiveByIndex(theSelIDX1.concat(theSibilings),!1)}function selectOnlySibilings(){theSibilings=getSibilings1();try{makeActiveByIndex(theSibilings,!1)}catch(e){}}function getParentIndex1(e){ref=new ActionReference,ref.putIndex(charIDToTypeID("Lyr "),e),executeActionGet(ref).hasKey(stringIDToTypeID("targetEnum"))&&alert("parentIDX")}function eliminateDuplicates(e){var t,r=e.length,n=[],c={};for(t=0;t<r;t++)c[e[t]]=0;for(t in c)n.push(t);return n}function eliminateTheSame(e,t){var r,n=e.length,c=t.length,o=[];for(r=0;r<n;r++)for(o.push(e[r]),j=0;j<c;j++)
/* alert(arr1[i] +" - "+arr2[j]); */
if(e[r]==t[j]){
/* alert("brek"); */
o.pop(1);break}
/* alert(out); */return o}function testSelectMultiple(e){makeActiveByIndex([e[0],e[1]],!1);var t=new ActionReference;t.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt")),executeActionGet(t).hasKey(stringIDToTypeID("targetLayers"))&&alert("targetLayers"),alert("startSelMult");var r=new ActionDescriptor;(new ActionReference).putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));new ActionList;
/*     for(i=0;i<arr.length;i++){
               eval("var ref"+i+" = new ActionReference()");
               eval("ref"+i+".putIndex(charIDToTypeID( 'Lyr ' ), "+arr[i]+")");
               eval("list.putReference(ref"+i+")");
             }
       desc.putList(stringIDToTypeID( 'targetLayers' ), list); */executeAction(charIDToTypeID("setd"),r,DialogModes.NO),alert("endSelMult")}function cTID(e){return charIDToTypeID(e)}function sTID(e){return stringIDToTypeID(e)}