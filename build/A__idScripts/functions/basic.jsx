function cTID(e){return app.charIDToTypeID(e)}function sTID(e){return app.stringIDToTypeID(e)}
/* SAVE + SET PREFERENCES ************************/
function prefSave(){startDisplayDialogs=app.displayDialogs,startRulerUnits=app.preferences.rulerUnits}function prefSet(e,t){e||(alert("check prefSet"),e=DialogModes.NO),t||(alert("check prefSet"),t=Units.MM),app.displayDialogs=e,app.preferences.rulerUnits=t}function prefReset(){app.preferences.rulerunits=startRulerUnits,startDisplayDialogs==DialogModes.ERROR&&(startDisplayDialogs=DialogModes.NO),app.displayDialogs=startDisplayDialogs}
/* TODO würde gerne einen anderen Namen haben */
function resetImage(){
/* zurück zur letzten Version */
executeAction(sTID("revert"),void 0,DialogModes.NO),emptyProtocoll()}function emptyProtocoll(){var e=new ActionDescriptor;e.putEnumerated(cTID("null"),cTID("PrgI"),cTID("Al  ")),executeAction(cTID("Prge"),e,DialogModes.NO);for(var t=app.activeDocument.historyStates,n=t.length-1;n>=0;--n)t[n].snapshot&&(app.activeDocument.activeHistoryState=t[n],deleteHistory())}function deleteHistory(){var e=new ActionDescriptor,t=new ActionReference;t.putProperty(charIDToTypeID("HstS"),charIDToTypeID("CrnH")),e.putReference(charIDToTypeID("null"),t),executeAction(charIDToTypeID("Dlt "),e,DialogModes.NO)}
/* DEBUGGING ****************************/
function time_start(){start=(new Date).getTime()}function time_stop(e){var t=(new Date).getTime(),n="Done ("+Number((t-e)/1e3).toFixed(3)+" secs).";alert(n)}function logger(e){debug&&time_start();var t="~/Desktop/SimonScript.log",n=File(t);n.exists||(n=new File(t));var o=new Date,r=("0"+o.getDate()).slice(-2)+"."+("0"+(o.getMonth()+1)).slice(-2)+"."+o.getFullYear()+" - "+(("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2)),i=File(t);i.open("a",void 0,void 0),""!==i&&(i.writeln("-----------------------"),i.writeln(r),i.writeln("Doc: '"+doc.name+"'"),i.writeln("Function: '"+e+"'"),i.writeln(""),i.close()),debug&&time_stop(start)}
/* undoSteps(2) */function undoSteps(e){for(var t=0;t<e;t++)executeAction(charIDToTypeID("undo"),void 0,DialogModes.NO)}
/* LAYER *********************************/
/* createLayer("AutoTonwert", "levels", "normal", "gray", 80, "black", f,f) */
function createLayer(e,t,n,o,r,i,s,c){try{var a=new ActionDescriptor,D=new ActionReference;D.putClass(sTID("adjustmentLayer")),a.putReference(sTID("null"),D);var l=new ActionDescriptor;if(l.putString(sTID("name"),e),l.putUnitDouble(sTID("opacity"),sTID("percentUnit"),r),l.putEnumerated(sTID("mode"),sTID("blendMode"),sTID(n)),l.putEnumerated(sTID("color"),sTID("color"),sTID(o)),l.putBoolean(sTID("group"),s),"levels"==t&&c){var u=new ActionDescriptor;u.putEnumerated(sTID("presetKind"),sTID("presetKindType"),sTID("presetKindDefault"));var p=new ActionList,I=new ActionDescriptor,T=new ActionReference;T.putEnumerated(sTID("channel"),sTID("channel"),sTID("composite")),I.putReference(sTID("channel"),T),I.putBoolean(sTID("auto"),!0),p.putObject(sTID("levelsAdjustment"),I),u.putList(sTID("adjustment"),p),l.putObject(sTID("type"),sTID(t),u)}else l.putClass(sTID("type"),sTID(t));if(a.putObject(sTID("using"),sTID("adjustmentLayer"),l),executeAction(sTID("make"),a,DialogModes.NO),"invert"==i)return void executeAction(sTID("invert"),void 0,DialogModes.NO);if("none"==i)return void deleteMask();if("black"==i||"white"==i||"gray"==i)return void fill(i,"normal",100)}catch(e){logger(arguments.callee.name)}}
/* createColorLayer("Weiss", "normal", "gray", 100, "none", 255, 255, 255); */function createColorLayer(e,t,n,o,r,i,s,c){try{var a=new ActionDescriptor,D=new ActionReference;D.putClass(sTID("contentLayer")),a.putReference(sTID("null"),D);var l=new ActionDescriptor;l.putString(sTID("name"),e),l.putUnitDouble(sTID("opacity"),sTID("percentUnit"),o),l.putEnumerated(sTID("mode"),sTID("blendMode"),sTID(t)),l.putEnumerated(sTID("color"),sTID("color"),sTID(n));var u=new ActionDescriptor,p=new ActionDescriptor;if(p.putDouble(sTID("red"),i),p.putDouble(sTID("green"),s),p.putDouble(sTID("blue"),c),u.putObject(sTID("color"),sTID("RGBColor"),p),l.putObject(sTID("type"),sTID("solidColorLayer"),u),a.putObject(sTID("using"),sTID("contentLayer"),l),executeAction(sTID("make"),a,DialogModes.NO),gotoMask(),"invert"==r)return void executeAction(sTID("invert"),void 0,DialogModes.NO);if("none"==r)return void deleteMask();if("black"==r||"white"==r||"gray"==r)return void fill(r,"normal",100)}catch(e){logger(arguments.callee.name)}}
/* TODO toogle Mask/RGB-Layer //  bisher nur im CreateColorLayer verwendet */function gotoMask(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("channel"),sTID("channel"),sTID("mask")),e.putReference(sTID("null"),t),e.putBoolean(sTID("makeVisible"),!1),executeAction(sTID("select"),e,DialogModes.NO)}function gotoFill(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("channel"),sTID("channel"),sTID("RGB")),e.putReference(sTID("null"),t),e.putBoolean(sTID("makeVisible"),!1),executeAction(sTID("select"),e,DialogModes.NO)}
/* TODO */
/* _direction für  */
/* ElementPlacement.INSIDE */
/* ElementPlacement.PLACEATBEGINNING */
/* ElementPlacement.PLACEATEND */
/* moveLayer("Weiss", "Original", "down");*/function moveLayer(e,t,n){gotoLayer(e);var o=app.activeDocument.activeLayer;gotoLayer(t);var r=app.activeDocument.activeLayer;if("up"==n)var i=ElementPlacement.PLACEBEFORE;else if("down"==n)i=ElementPlacement.PLACEAFTER;o.move(r,i)}
/* up   down     top   bottom */
/* next previous front back */function moveLayer3(e,t){"up"==e&&(e="next"),"down"==e&&(e="previous"),"top"==e&&(e="front"),"bottom"==e&&(e="back");for(var n=0;n<t;n++){var o=new ActionDescriptor,r=new ActionReference,i=new ActionReference;r.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),o.putReference(sTID("null"),r),i.putEnumerated(sTID("layer"),sTID("ordinal"),sTID(e)),o.putReference(sTID("to"),i),executeAction(sTID("move"),o,DialogModes.NO)}}function deleteMask(){try{var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("channel"),sTID("channel"),sTID("mask")),e.putReference(sTID("null"),t),executeAction(sTID("delete"),e,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}function createGroup(e,t,n,o,r){try{var i=new ActionDescriptor,s=new ActionReference;if(s.putClass(sTID("layerSection")),i.putReference(sTID("null"),s),r){var c=new ActionReference;c.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),i.putReference(sTID("from"),c)}var a=new ActionDescriptor;a.putString(sTID("name"),e),a.putUnitDouble(sTID("opacity"),sTID("percentUnit"),o),a.putEnumerated(sTID("color"),sTID("color"),sTID(n)),a.putEnumerated(sTID("mode"),sTID("blendMode"),sTID(t)),i.putObject(sTID("using"),sTID("layerSection"),a),i.putInteger(sTID("layerSectionStart"),351),i.putInteger(sTID("layerSectionEnd"),352),i.putString(sTID("name"),"Gruppe 3"),executeAction(sTID("make"),i,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}
/*
fill("black", "normal", 100)
fill("color", "multiply", 50, 240,50,50)
*/function fill(e,t,n,o,r,i){try{var s=new ActionDescriptor;if(s.putEnumerated(sTID("using"),sTID("fillContents"),sTID(e)),"color"==e){var c=new ActionDescriptor;c.putUnitDouble(sTID("hue"),sTID("angleUnit"),o),c.putDouble(sTID("saturation"),r),c.putDouble(sTID("brightness"),i),s.putObject(sTID("color"),sTID("HSBColorClass"),c)}s.putUnitDouble(sTID("opacity"),sTID("percentUnit"),n),s.putEnumerated(sTID("mode"),sTID("blendMode"),sTID(t)),executeAction(sTID("fill"),s,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}function smartObject(){try{executeAction(stringIDToTypeID("newPlacedLayer"),void 0,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}function rasterSmartObject(){try{var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),e.putReference(sTID("null"),t),executeAction(sTID("rasterizeLayer"),e,DialogModes.NO)}catch(e){logger(arguments.callee.name)}}function nameLayer(e){try{doc.activeLayer.name=e}catch(e){logger(arguments.callee.name)}}function dublicate(e){var t=new ActionDescriptor,n=new ActionReference;n.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),t.putReference(sTID("null"),n),t.putString(sTID("name"),e),t.putInteger(sTID("version"),5),executeAction(sTID("duplicate"),t,DialogModes.NO)}
/* TODO ist das noch in Verwendung, oder kann das weg */function selectLayerUp(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("forwardEnum")),e.putReference(sTID("null"),t),e.putBoolean(sTID("makeVisible"),!1);var n=new ActionList;n.putInteger(108),e.putList(sTID("layerID"),n),executeAction(sTID("select"),e,DialogModes.NO)}function selectLayer(e,t){var n=new ActionDescriptor,o=new ActionReference;"down"!=e?o.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("forwardEnum")):o.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("backwardEnum")),n.putReference(sTID("null"),o),n.putBoolean(sTID("makeVisible"),!1);var r=0;for(r=1;r<=t;r+=1)executeAction(sTID("select"),n,DialogModes.NO)}
/* TODO mit unterer Funktion ersetzt */function selectAll(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),e.putReference(sTID("null"),t),executeAction(sTID("selectAllLayers"),e,DialogModes.NO)}
/* selectNoLayers OR selectAllLayers */function selectLayers(e){var t=new ActionDescriptor,n=new ActionReference;n.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),t.putReference(sTID("null"),n),executeAction(sTID(e),t,DialogModes.NO)}function hasBackground(){var e=new ActionReference;return e.putProperty(charIDToTypeID("Prpr"),charIDToTypeID("Bckg")),e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Back")),executeActionGet(e).getBoolean(charIDToTypeID("Bckg"))}function clearAllGuides(){executeAction(sTID("clearAllGuides"),void 0,DialogModes.NO)}
/* egal ob Idx oder LayerName */function gotoLayer(e){var t=new ActionDescriptor,n=new ActionReference;"number"==typeof e?n.putIndex(charIDToTypeID("Lyr "),e):"string"==typeof e&&n.putName(sTID("layer"),e),t.putReference(sTID("null"),n),t.putBoolean(sTID("makeVisible"),!1),executeAction(sTID("select"),t,DialogModes.NO)}
/** IMAGE *******************************/function SmartObject_edit(){var e=new ActionDescriptor;executeAction(sTID("placedLayerEditContents"),e,DialogModes.NO)}function SmartOject_placeItem(e){var t=new ActionDescriptor;t.putPath(cTID("null"),new File(e)),executeAction(sTID("placedLayerReplaceContents"),t,DialogModes.NO)}function getBitDepth(){var e=doc.bitsPerChannel;return e===BitsPerChannelType.EIGHT?8:e===BitsPerChannelType.SIXTEEN?16:e===BitsPerChannelType.THIRTYTWO&&32}
/* setBitDepth(8); */function setBitDepth(e){var t=charIDToTypeID("CnvM"),n=new ActionDescriptor,o=charIDToTypeID("Dpth");n.putInteger(o,e),executeAction(t,n,DialogModes.NO)}
/* TODO irritierender Name // Vorschläge? */
/* img_resize(10, 300) */
/* img_resize(10, null) */function img_resize(e,t){var n;(prefSave(),prefSet(DialogModes.NO,Units.MM),doc.width>doc.height)?((n=new ActionDescriptor).putUnitDouble(sTID("width"),sTID("distanceUnit"),cm2pt(e)),executeAction(sTID("imageSize"),n,DialogModes.NO)):((n=new ActionDescriptor).putUnitDouble(sTID("height"),sTID("distanceUnit"),cm2pt(e)),executeAction(sTID("imageSize"),n,DialogModes.NO));doc.resolution>t&&t&&doc.resizeImage(void 0,void 0,t,ResampleMethod.PRESERVEDETAILS,0),prefReset()}
/* setMegaPixel(8) */function setMegaPixel(e){prefSave(),prefSet(DialogModes.NO,Units.PIXELS);var t=doc.width,n=doc.height,o=t*n,r=1e6*e,i=r/o;if(r<o)if(t>=n){var s=t*Math.sqrt(i);doc.resizeImage(s,void 0,void 0,ResampleMethod.PRESERVEDETAILS,0)}else{var c=Math.round(n*Math.sqrt(i));doc.resizeImage(void 0,c,void 0,ResampleMethod.PRESERVEDETAILS,0)}return prefReset(),""}
/* getScale(8) */function getScale(e){
/*     prefSave();
    prefSet(DialogModes.NO, Units.PIXELS); */
var t=1e6*e/(doc.width*doc.height);
/*     if (setPixel < getPixel) {
        if (w >= h) {
            var w_neu = w * Math.sqrt(faktor);
            doc.resizeImage(w_neu, undefined, undefined, ResampleMethod.PRESERVEDETAILS, 0);
        } else {
            var h_neu = Math.round(h * Math.sqrt(faktor));
            doc.resizeImage(undefined, h_neu, undefined, ResampleMethod.PRESERVEDETAILS, 0);
        }
    } */
/* prefReset(); */
return Math.sqrt(t)}
/* Convert cm to Point, imageSize need Points */function cm2pt(e){return 28.3464566929*e}function mm2pt(e){return.283464566929*e}function setDpi(e){var t=new ActionDescriptor;t.putUnitDouble(sTID("resolution"),sTID("densityUnit"),e),executeAction(sTID("imageSize"),t,DialogModes.NO)}
/* setSize("width", 100) */function setSize(e,t){var n=new ActionDescriptor;n.putUnitDouble(sTID(e),sTID("distanceUnit"),mm2pt(t)),executeAction(sTID("imageSize"),n,DialogModes.NO)}
/* COLOR ****************************/function noProfile(){if(doc.colorProfileType==ColorProfile.NONE)try{app.bringToFront();var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("document"),sTID("ordinal"),sTID("targetEnum")),e.putReference(sTID("null"),t),e.putBoolean(sTID("manage"),!0),executeAction(sTID("assignProfile"),e,DialogModes.ALL)}catch(e){}}function assignProfile(e){var t=new ActionDescriptor,n=new ActionReference;n.putEnumerated(sTID("document"),sTID("ordinal"),sTID("targetEnum")),t.putReference(sTID("null"),n),t.putString(sTID("profile"),e),executeAction(sTID("assignProfile"),t,DialogModes.NO)}
/* TODO !! Geht Besser ! ****************************/function gray2rgb(){doc.mode==DocumentMode.GRAYSCALE&&doc.convertProfile("eciRGB v2",Intent.RELATIVECOLORIMETRIC,!0,!1)}function cmyk2rgb(){doc.mode==DocumentMode.CMYK&&doc.convertProfile("eciRGB v2",Intent.RELATIVECOLORIMETRIC,!0,!1)}function sRGB2eciRGB(){var e=doc.colorProfileName,t=new RegExp("^sRGB");e.match(t)&&doc.convertProfile("eciRGB v2",Intent.RELATIVECOLORIMETRIC,!0,!1)}
/* WEB-Output ****************************/function GetFileNameOnly(e){var t=e.lastIndexOf(".");return-1==t?e:e.substr(0,t)}function replace__RGB_RZ(e){var t=GetFileNameOnly(doc.name).replace(/(__RGB.*)$/g,e).replace(/(__RZ.*)$/g,e),n=new RegExp(e,"g");if(!t.match(n))t=t+e;return t}function saveRZ(e,t,n,o){
/* Location + Name */
var r=new Folder(e);r.exists||r.create();for(var i=r+"/"+t+(c=replace__RGB_RZ(o))+"."+n,s=File(i);s.exists;){var c;i=r+"/"+t+(c=c+"+")+"."+n,s=File(i)}if("tif"==n)(a=new TiffSaveOptions).alphaChannels=!0,a.byteOrder=ByteOrder.IBM,a.embedColorProfile=!0,a.imageCompression=TIFFEncoding.TIFFLZW,a.layers=!0,a.spotColors=!1,a.transparency=!0,a.annotations=!1;else if("jpg"==n){(a=new JPEGSaveOptions).embedColorProfile=!0,a.formatOptions=FormatOptions.STANDARDBASELINE,a.matte=MatteType.WHITE,a.quality=11}else if("psd"==n){var a;(a=new PhotoshopSaveOptions).alphaChannels=!1,a.annotations=!1,a.embedColorProfile=!0,a.layers=!0,a.spotColors=!1}doc.saveAs(new File(i),a,!1,Extension.LOWERCASE)}
/*=================================================================================*/function selectAllLayers(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),e.putReference(sTID("null"),t),executeAction(sTID("selectAllLayers"),e,DialogModes.NO)}function mergeLayers(){var e=new ActionDescriptor;executeAction(sTID("mergeLayersNew"),e,DialogModes.NO)}function blendif(e,t,n,o){var r=new ActionDescriptor,i=new ActionReference;i.putEnumerated(sTID("layer"),sTID("ordinal"),sTID("targetEnum")),r.putReference(sTID("null"),i);var s=new ActionDescriptor,c=new ActionList,a=new ActionDescriptor,D=new ActionReference;D.putEnumerated(sTID("channel"),sTID("channel"),sTID("gray")),a.putReference(sTID("channel"),D),a.putInteger(sTID("srcBlackMin"),0),a.putInteger(sTID("srcBlackMax"),0),a.putInteger(sTID("srcWhiteMin"),255),a.putInteger(sTID("srcWhiteMax"),255),a.putInteger(sTID("destBlackMin"),e),a.putInteger(sTID("destBlackMax"),t),a.putInteger(sTID("destWhiteMin"),n),a.putInteger(sTID("desaturate"),o),c.putObject(sTID("blendRange"),a),s.putList(sTID("blendRange"),c);var l=new ActionDescriptor;l.putUnitDouble(sTID("scale"),sTID("percentUnit"),100),s.putObject(sTID("layerEffects"),sTID("layerEffects"),l),r.putObject(sTID("to"),sTID("layer"),s),executeAction(sTID("set"),r,DialogModes.NO)}app.documents.length>0&&(doc=app.activeDocument,docs=app.documents,f=!1,t=!0,debug=!1);