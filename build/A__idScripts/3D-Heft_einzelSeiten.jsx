var a_dialog=app.dialogs.add({name:"3D-Heft",canCancel:false});var min_width_left=50;var min_width_right=250;var heft1="11Freunde";var heft2="noSports";var heft3="Chronik";var heft4="Buch-innen_17x24";var heft5="Buch-innen_21x28";var heft6="Beileger_19x26";with(a_dialog){with(dialogColumns.add()){with(borderPanels.add()){with(dialogColumns.add()){staticTexts.add({staticLabel:"Heft:",minWidth:min_width_left})}with(dialogColumns.add()){var heft=radiobuttonGroups.add();with(heft){radiobuttonControls.add({staticLabel:heft1,checkedState:true,minWidth:min_width_right});radiobuttonControls.add({staticLabel:heft2,checkedState:false,minWidth:min_width_right});radiobuttonControls.add({staticLabel:heft3,checkedState:false,minWidth:min_width_right});radiobuttonControls.add({staticLabel:heft4,checkedState:false,minWidth:min_width_right});radiobuttonControls.add({staticLabel:heft5,checkedState:false,minWidth:min_width_right});radiobuttonControls.add({staticLabel:heft6,checkedState:false,minWidth:min_width_right})}}}}}if(a_dialog.show()==false){a_dialog.destroy()}else{if(heft.selectedButton==0){var heft=heft1;var master=new File("~/Arbeit/11Freunde/3D/11F_3D-Heft/Master/3D__11F-innen__MASTER_v5_flach.tif")}else if(heft.selectedButton==1){var heft=heft2;var master=new File("~/Arbeit/11Freunde/3D/11F_3D-Heft/Master/3D__noSports-innen__MASTER.tif")}else if(heft.selectedButton==2){var heft=heft3;var master=new File("~/Arbeit/11Freunde/3D/11F_3D-Heft/Master/3D__Chronik-innen__MASTER_flach.tif")}else if(heft.selectedButton==3){var heft=heft4;var master=new File("~/Arbeit/11Freunde/3D/11F_3D-Heft/Master/3D__Buch-innen_17x24__MASTER.psd")}else if(heft.selectedButton==4){var heft=heft5;var master=new File("~/Arbeit/11Freunde/3D/11F_3D-Heft/Master/3D__Buch-innen_21x28__MASTER.psd")}else if(heft.selectedButton==5){var heft=heft6;var master=new File("~/Arbeit/11Freunde/3D/11F_3D-Heft/Master/3D__190x260-innen__MASTER.psd")}}function errorExit(e){alert(e);exit()}function closeAll(){while(app.documents.length>0){app.activeDocument.close(SaveOptions.DONOTSAVECHANGES)}}function sort_pages(e){var t=e.sort(sortnum).join("\r")+"\r";t=t.replace(/([^\r]+\r)(\1)+/g,"$1");t=t.replace(/\r$/,"");t=t.split("\r");return t}function sortnum(e,t){return e>t}function GetFileNameOnly(e){var t="";var n=e.lastIndexOf(".");if(n==-1){t=e}else{t=e.substr(0,n)}return t}function getPageNumber(e){var t="";var n=e.lastIndexOf(".");if(n==-1){t=e}else{t=e.substr(0,n)}var i=e.replace(/^(\d{3})(-|_{2})(.+)/g,"$1");var r=i-1;var r=("000"+r).slice(-3);var t=r+"-"+i;return t}Folder_single=Folder.selectDialog("Bitte w√§hle den Ordner der EinzelSeiten aus");var Folder_3D=new Folder(Folder_single+"/3D");if(!Folder_3D.exists){Folder_3D.create()}var fileList=Folder_single.getFiles(/.+\.(jpg|tif|psd|bmp|gif|png|)$/i);sort_pages(fileList);var thisSite="";var thisFileName="";var thisPageNumber="";for(var i=0;i<fileList.length;i++){var thisFile=fileList[i];if(i+1&1){var thisSite="links";id2ps_placeItem()}else{var thisSite="rechts";var thisFileName=GetFileNameOnly(thisFile.name);id2ps_placeItem()}}id2ps_schatten();function id2ps_placeItem(){var e=new BridgeTalk;e.target="photoshop";e.body=runPS.toSource()+"("+Folder_3D.toSource()+","+master.toSource()+","+thisFile.toSource()+","+thisSite.toSource()+","+thisFileName.toSource()+","+thisPageNumber.toSource()+");";e.onError=function(e){alert("Error: "+e.body)};e.onResult=function(e){};e.send(100)}function id2ps_schatten(){var e=new BridgeTalk;e.target="photoshop";e.body=runPS_schatten.toSource()+"("+Folder_3D.toSource()+","+master.toSource()+");";e.onError=function(e){alert("Error: "+e.body)};e.onResult=function(e){};e.send(100)}function runPS(e,t,n,i,r,a){function o(e){return app.charIDToTypeID(e)}function s(e){return app.stringIDToTypeID(e)}function l(){startDisplayDialogs=app.displayDialogs;startRulerUnits=app.preferences.rulerUnits}function c(){app.displayDialogs=DialogModes.NO;app.preferences.rulerUnits=Units.MM}function f(){app.preferences.rulerUnits=startRulerUnits;app.displayDialogs=startDisplayDialogs}function p(){var e=new ActionDescriptor;e.putEnumerated(o("null"),o("PrgI"),o("Al  "));executeAction(o("Prge"),e,DialogModes.NO);var t=app.activeDocument.historyStates;for(var n=t.length-1;n>=0;--n){if(t[n].snapshot){app.activeDocument.activeHistoryState=t[n];u()}}}function u(){var e=new ActionDescriptor;var t=new ActionReference;t.putProperty(charIDToTypeID("HstS"),charIDToTypeID("CrnH"));e.putReference(charIDToTypeID("null"),t);executeAction(charIDToTypeID("Dlt "),e,DialogModes.NO)}function d(e){var t=new ActionDescriptor;var n=new ActionReference;if(typeof e=="number"){n.putIndex(charIDToTypeID("Lyr "),e)}else if(typeof e=="string"){n.putName(s("layer"),e)}t.putReference(s("null"),n);t.putBoolean(s("makeVisible"),false);executeAction(s("select"),t,DialogModes.NO)}function h(e){var t=new ActionDescriptor;var n=new ActionReference;n.putEnumerated(s("layer"),s("ordinal"),s("targetEnum"));t.putReference(s("null"),n);try{executeAction(s(e),t,DialogModes.NO)}catch(e){}}function D(e,t){try{var n=new ActionDescriptor;var i=new ActionReference;if(t=="remove"||!t){var r="removeFromSelection"}else{var r="addToSelection"}if(isNaN(e)){i.putName(s("layer"),e)}else{i.putIndex(s("layer"),e)}n.putReference(s("null"),i);n.putEnumerated(s("selectionModifier"),s("selectionModifierType"),s(r));n.putBoolean(s("makeVisible"),false);executeAction(s("select"),n,DialogModes.NO)}catch(e){}}function v(){var e=new ActionDescriptor;executeAction(s("mergeLayersNew"),e,DialogModes.NO)}function g(e){app.activeDocument.activeLayer.name=e}function y(){executeAction(s("revert"),undefined,DialogModes.NO);p()}function m(e,t){var n=new ActionDescriptor;var i=new ActionReference;i.putName(o("Lyr "),e);n.putReference(o("null"),i);n.putBoolean(o("MkVs"),false);executeAction(o("slct"),n,DialogModes.NO);var r=stringIDToTypeID("placedLayerEditContents");var a=new ActionDescriptor;executeAction(r,a,DialogModes.NO);var s=stringIDToTypeID("placedLayerReplaceContents");var l=new ActionDescriptor;var c=charIDToTypeID("null");l.putPath(c,new File(t));executeAction(s,l,DialogModes.NO);var f=charIDToTypeID("save");executeAction(f,undefined,DialogModes.NO);var p=stringIDToTypeID("updatePlacedLayer");executeAction(p,undefined,DialogModes.NO);var u=charIDToTypeID("Cls ");executeAction(u,undefined,DialogModes.NO)}function I(t){var n=new File(e+"/"+t);tiffSaveOptions=new TiffSaveOptions;tiffSaveOptions.embedColorProfile=true;tiffSaveOptions.alphaChannels=false;tiffSaveOptions.layers=false;tiffSaveOptions.byteOrder=ByteOrder.IBM;tiffSaveOptions.annotations=false;tiffSaveOptions.transparency=true;tiffSaveOptions.imageCompression=TIFFEncoding.TIFFLZW;app.activeDocument.saveAs(n,tiffSaveOptions,true,Extension.LOWERCASE)}function _(e,t,n,i,r,a){if(t=="tif"){var o=new TiffSaveOptions;o.alphaChannels=r;o.byteOrder=ByteOrder.IBM;o.embedColorProfile=true;o.imageCompression=TIFFEncoding.TIFFLZW;o.layers=a;o.spotColors=false;o.transparency=true;o.annotations=false}else if(t=="jpg"){var o=new JPEGSaveOptions;o.embedColorProfile=true;o.formatOptions=FormatOptions.STANDARDBASELINE;o.matte=MatteType.WHITE;o.quality=i}else if(t=="psd"){var o=new PhotoshopSaveOptions;o.alphaChannels=r;o.annotations=false;o.embedColorProfile=true;o.layers=a;o.spotColors=false}T(e,o,n)}function T(e,t,n){app.activeDocument.saveAs(e,t,n,Extension.LOWERCASE)}function S(e){try{var t=new ActionDescriptor;var n=new ActionList;var i=new ActionReference;if(typeof e=="number"){i.putIndex(stringIDToTypeID("layer"),e)}else if(typeof e=="string"){if(w(e)){i.putName(stringIDToTypeID("layer"),e)}else{i.putIndex(stringIDToTypeID("layer"),O(e)[0])}}else if(typeof e==="undefined"){i.putEnumerated(stringIDToTypeID("layer"),stringIDToTypeID("ordinal"),stringIDToTypeID("targetEnum"))}n.putReference(i);t.putList(charIDToTypeID("null"),n);executeAction(stringIDToTypeID("show"),t,DialogModes.NO)}catch(e){alert("error makeVisible: "+e)}}function A(){executeAction(charIDToTypeID("FltI"),undefined,DialogModes.NO)}function w(e){try{var t=new ActionReference;t.putProperty(stringIDToTypeID("property"),stringIDToTypeID("itemIndex"));if(typeof e=="number"){t.putIndex(stringIDToTypeID("layer"),e)}else if(typeof e=="string"){t.putName(stringIDToTypeID("layer"),e)}var n=executeActionGet(t).getInteger(stringIDToTypeID("itemIndex"));return true}catch(e){alert("error layer_checkExistence: "+e);return false}}function O(e){var t=1;var n=[];while(w(t)){try{var i=new RegExp(e,"g");if(layer_getName(t).match(i)){n.push(t)}}catch(e){alert("error layer_getIDXbyString: "+e)}t++}return n}l();c();app.open(t);if(i=="links"){m("links",n)}else{m("rechts",n);try{h("selectAllLayers");D("Schatten","remove");v();g("frei");_(new File(e+"/"+r),"psd",true,null,false,true);y()}catch(e){alert(e)}}p();f()}function runPS_schatten(e,t){function n(e){return app.charIDToTypeID(e)}function i(e){return app.stringIDToTypeID(e)}function r(){startDisplayDialogs=app.displayDialogs;startRulerUnits=app.preferences.rulerUnits}function a(){app.displayDialogs=DialogModes.NO;app.preferences.rulerUnits=Units.MM}function o(){app.preferences.rulerUnits=startRulerUnits;app.displayDialogs=startDisplayDialogs}function s(){var t=new ActionDescriptor;var i=new ActionList;var r=new ActionReference;r.putName(n("Lyr "),"Magazin");i.putReference(r);t.putList(n("null"),i);executeAction(n("Hd  "),t,DialogModes.NO);var a=new ActionDescriptor;var o=new ActionList;var s=new ActionReference;s.putName(n("Lyr "),"Schatten");o.putReference(s);a.putList(n("null"),o);executeAction(n("Shw "),a,DialogModes.NO);var l=new File(e+"/_Schatten__11F-innen");tiffSaveOptions=new TiffSaveOptions;tiffSaveOptions.embedColorProfile=true;tiffSaveOptions.alphaChannels=false;tiffSaveOptions.layers=false;tiffSaveOptions.byteOrder=ByteOrder.IBM;tiffSaveOptions.annotations=false;tiffSaveOptions.transparency=false;tiffSaveOptions.imageCompression=TIFFEncoding.TIFFLZW;app.activeDocument.saveAs(l,tiffSaveOptions,true,Extension.LOWERCASE)}function l(){while(documents.length>0){activeDocument.close(SaveOptions.DONOTSAVECHANGES)}}r();a();app.open(t);s();l();o()}