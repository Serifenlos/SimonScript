/*
// BEGIN__HARVEST_EXCEPTION_ZSTRING
<javascriptresource>
<name>[11F] Web-Output</name>
<about>Web-Output | By Simon Adrian | http://www.SimonAdrian.de</about>
<category>11Freunde</category>
</javascriptresource>
// END__HARVEST_EXCEPTION_ZSTRING
*/
/** last edited on 12.02.2025 10:36 **/
//@include "functions/basic.jsx";
//@include "functions/utils.jsx";
//@include "functions/meta.jsx";
//@include "functions/save.jsx";
//@include "functions/loopFiles.jsx";
//@include "functions/layer.jsx";
//@include "functions/ready.jsx";
function info(){alert("Web-Output für 11Freunde\n - Auswahl des Überordner (alle Unterordner werden auch verarbeitet)\n - auf dem Schreibtisch werden ein Ordner erstellt 'Bilder FERTIG'\n - dot werden die fertig bearbeiteten Bilder in der ursprünglichen Größe abgelegt\n\n Bedingungen\n - die originale Bildquelle liegt im Smart-Objekt mit dem Namen 'Original'\n - dem Dateinamen wird zur besseren Sortierbarkeit der Name des urspünglichen InDesign-Dokumentes vorangestellt")}
//@include "./assets/json2.js"
saveFolder="~/Desktop/Bilder FERTIG",saveFolder_WEB="~/Desktop/Bilder WEB",suffix_FERTIG="",suffix_WEB="",maximalMegaPixel=8;var jsonFilePath="~/.ss_settings.json",jsonData=loadJSON(jsonFilePath);function loadJSON(e){var t,r=new File(e);if(!r.exists)return alert("Die JSON-Datei konnte nicht gefunden werden."),null;r.open("r"),t=r.read(),r.close();try{return JSON.parse(t)}catch(e){return alert("Fehler beim Parsen der JSON-Datei:\n"+e),null}}function jsonValue(e){for(var t=0;t<jsonData.length;t++)if(void 0!==jsonData[t][e])return jsonData[t][e];return null}const debug=Boolean(jsonValue("Debug"));function run(){info();var e=[],r=Folder.selectDialog("Wähle den obersten Ordner aus. \nDie Unterordner werden auch mitverarbeitet.");if(null!=r)for(var i in e=function e(t,r){for(var i=Folder(t).getFiles(),n=0;n<i.length;n++){var s=i[n];s instanceof File||(r.push(Folder(s)),e(s.toString(),r))}return r}(r,e),e.unshift(r),e)if(files=[],files=e[i].getFiles(/.+\.(jpg|tif|psd|bmp|gif|png|)$/i),!(files.length<1))for(var n in files){var s="",a=getMeta_3("idDocName");if(a)s=a+"__";else if(r!=e[i])s=e[i].name+"__";var o=files[n],l=new File(o);app.open(l),
//@include "functions/basic.jsx";
//@include "functions/utils.jsx";
//@include "functions/meta.jsx";
//@include "functions/save.jsx";
//@include "functions/loopFiles.jsx";
//@include "functions/layer.jsx";
//@include "functions/ready.jsx";
prefSave(),prefSet(DialogModes.NO,Units.PIXELS);try{gotoLayer("Original");var u=app.activeDocument.width;SmartObject_edit();var c=app.activeDocument.width,p=c/u;app.activeDocument.close(SaveOptions.DONOTSAVECHANGES),doc.resizeImage(c,void 0,void 0,ResampleMethod.PRESERVEDETAILS,0),fixMaskLoop(p)}catch(E){}for(var d=1;layer_checkExistence(d);){try{for(var g=getSmartFilterArray_byIDX(d),D=0;D<g.length;D++)gotoLayer(d),"adaptCorrect"==g[D][1]?adjust_filter_TiefenLichter2(p,g[D][0]+1,g[D][7],g[D][10],g[D][12],g[D][18],g[D][21],g[D][23],g[D][25],g[D][27],g[D][29],g[D][31]):"unsharpMask"==g[D][1]?adjust_filter_UnsharpMask(p,g[D][0]+1,g[D][4],g[D][7],g[D][9]):"gaussianBlur"==g[D][1]?adjust_filter_gaussianBlur(p,g[D][0]+1,g[D][4]):"highPass"==g[D][1]?adjust_filter_highPass(p,g[D][0]+1,g[D][4]):"median"==g[D][1]?adjust_filter_helligkeit_interpolieren(p,g[D][0]+1,g[D][4]):"dustAndScratches"==g[D][1]?adjust_filter_staubKratzer(p,g[D][0]+1,g[D][3],g[D][5]):"motionBlur"==g[D][1]&&adjust_filter_motionBlur(p,g[D][0]+1,g[D][3],g[D][6])}catch(T){g=[]}d++}function y(e,t,r,i){var n=new Folder(e);n.exists||n.create();for(var s=n+"/"+t+(o=h(replace__RGB_RZ(i)))+"."+r,a=File(s);a.exists;){var o;s=n+"/"+t+(o=o+"+")+"."+r,a=File(s)}return decodeURIComponent(t)+o}function h(e){e=e.replace(/^\s+|\s+$/g,"");for(var t="ÄäĀāĂăĄąÀàÁáÂâÇçËëÈèÉéÊêĒēĜĝĠġÏïÎîĨĩÍíÑñŃńÑñÖöÒòÓóÔôõßŠšŜŝŚśÜüÛûŮůŸÿŶŷ·/_,:;'",r=0;r<77;r++)e=e.replace(new RegExp(t.charAt(r),"g"),"AaAaAaAaAaAaAaCcEeEeEeEeEeGgGgIiIiIiIiNnNnNnOoOoOoOoosSsSsSsUuUuUuYyYy-------".charAt(r));return e=e.replace(/[^a-z0-9 -]/gi,"").replace(/[^\w\-]+/gi,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function b(e){var t=new ActionReference;return"number"==typeof e&&t.putIndex(charIDToTypeID("Lyr "),e),"string"==typeof e&&(layer_checkExistence(e)?t.putName(s2t("layer"),e):t.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])),executeActionGet(t).getInteger(stringIDToTypeID("visible"))}try{clearAllGuides()}catch(m){}try{delMeta_3(["softproofProfil","softproofIntent","softproofTK","softproofGroup"]),delMeta_3(["isWoodwing","arbeitsdatei_RGB","woodwing_RGB","woodwing_file","woodwing_imageID"])}catch(_){debug&&alert("ERROR delete metaTags: \n"+_)}try{keywordsArray=doc.info.keywords,keywordsArray.push(getMeta_3("idDocName")),keywordsArray.push(getMeta_3("studioAusgabe")),keywordsArray.push(getMeta_3("studioPublikation")),doc.info.keywords=keywordsArray}catch(w){debug&&alert("ERROR set keyword: \n"+w)}try{getBitDepth(!1)&&setBitDepth(8)}catch(v){}try{doc.layers.getByName("Freisteller helper")&&hide("Freisteller helper")}catch(O){}try{hide("Layout")}catch(F){}try{if(doc.layerSets.getByName("Freisteller")){app.activeDocument.suspendHistory("Freisteller: 2 Ebenen","freisteller_reduce2layers()"),doc.convertProfile("image P3",Intent.RELATIVECOLORIMETRIC,!0,!1);var I=b("frei");b(0);hide("frei"),makeVisible(0),SaveForWeb("JPEG",saveFolder,y(saveFolder,s,"jpg",suffix_FERTIG),!1,f,f,t,t,255,255,255,"Meta_all",66,t,t,0),makeVisible("frei"),hide(0),I?(makeVisible("frei"),hide(0)):(hide("frei"),makeVisible(0));var A=saveFolder+"/"+y(saveFolder,s,"psd",suffix_FERTIG);saveMultiformat(new File(A),"psd",!1,10,!1,!0)}}catch(j){try{doc.flatten()}catch(R){}doc.convertProfile("image P3",Intent.RELATIVECOLORIMETRIC,!0,!1);A=saveFolder+"/"+y(saveFolder,s,"jpg",suffix_FERTIG);saveMultiformat(new File(A),"jpg",!1,10,!1,!1)}prefReset(),doc.close(SaveOptions.DONOTSAVECHANGES)}}function getSmartFilterArray_byIDX(e){filterArray_collect=[];try{var t=new ActionReference;t.putProperty(stringIDToTypeID("property"),stringIDToTypeID("smartObject")),t.putIndex(sTID("layer"),e);var r=executeActionGet(t).getObjectValue(stringIDToTypeID("smartObject")).getList(stringIDToTypeID("filterFX"));filterArray=[];for(var i=0;i<r.count;i++){var n=r.getObjectValue(i),s=n.getObjectValue(stringIDToTypeID("filter")),a=typeIDToStringID(n.getObjectType(stringIDToTypeID("filter")));filterArray_inner=[],filterArray_inner.push(i,a);for(var o=0;o<s.count;o++){getSmartFilterValues(s,o);try{if(s.getObjectValue(s.getKey(o)))for(var l=typeIDToStringID(s.getKey(o)),u=(l=s.getObjectValue(stringIDToTypeID(l)),0);u<l.count;u++)getSmartFilterValues(l,u)}catch(e){}}filterArray_collect.push(filterArray_inner)}}catch(e){}return filterArray_collect}function getSmartFilterValues(e,t){try{var r=filterArray_inner,i=e.getKey(t);if(t2s(i))n=t2s(i);else var n=i;switch(e.getType(e.getKey(t))){case DescValueType.BOOLEANTYPE:var s=e.getBoolean(e.getKey(t));r.push(n,s);break;case DescValueType.CLASSTYPE:s=e.getClass(e.getKey(t));r.push(n,s);break;case DescValueType.DOUBLETYPE:s=e.getDouble(e.getKey(t));r.push(n,s);break;case DescValueType.ENUMERATEDTYPE:var a=typeIDToStringID(e.getEnumerationType(e.getKey(t)));s=typeIDToStringID(e.getEnumerationValue(e.getKey(t)));r.push(n,a,s);break;case DescValueType.INTEGERTYPE:s=e.getInteger(e.getKey(t));r.push(n,s);break;case DescValueType.LISTTYPE:s=e.getList(e.getKey(t));r.push(n,s);break;case DescValueType.OBJECTTYPE:var o=typeIDToStringID(e.getObjectType(e.getKey(t)));s=e.getObjectValue(e.getKey(t));r.push(n,o,s);break;case DescValueType.REFERENCETYPE:s=e.getReference(e.getKey(t));r.push(n,s);break;case DescValueType.STRINGTYPE:s=e.getString(e.getKey(t));r.push(n,s);break;case DescValueType.UNITDOUBLE:var l=typeIDToStringID(e.getUnitDoubleType(e.getKey(t)));s=e.getUnitDoubleValue(e.getKey(t));r.push(n,l,s)}}catch(e){}}function adjust_filter_TiefenLichter2(e,t,r,i,n,s,a,o,l,u,c,p){var d=new ActionDescriptor,f=new ActionDescriptor,g=new ActionDescriptor,D=new ActionDescriptor,y=new ActionDescriptor,h=new ActionReference;h.putIndex(s2t("filterFX"),t),h.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),d.putReference(s2t("null"),h),D.putUnitDouble(s2t("amount"),s2t("percentUnit"),r),D.putUnitDouble(s2t("width"),s2t("percentUnit"),i),D.putInteger(s2t("radius"),Math.round(n*e)),g.putObject(s2t("shadowMode"),s2t("adaptCorrectTones"),D),y.putUnitDouble(s2t("amount"),s2t("percentUnit"),s),y.putUnitDouble(s2t("width"),s2t("percentUnit"),a),y.putInteger(s2t("radius"),Math.round(o*e)),g.putObject(s2t("highlightMode"),s2t("adaptCorrectTones"),y),g.putDouble(s2t("blackClip"),l),g.putDouble(s2t("whiteClip"),u),g.putInteger(s2t("center"),c),g.putInteger(s2t("colorCorrection"),p),f.putObject(s2t("filter"),s2t("adaptCorrect"),g),d.putObject(s2t("filterFX"),s2t("filterFX"),f),executeAction(s2t("set"),d,DialogModes.NO)}function adjust_filter_UnsharpMask(e,t,r,i,n){var s=new ActionDescriptor,a=new ActionDescriptor,o=new ActionDescriptor,l=new ActionReference;l.putIndex(s2t("filterFX"),t),l.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),s.putReference(s2t("null"),l),o.putUnitDouble(s2t("amount"),s2t("percentUnit"),r),o.putUnitDouble(s2t("radius"),s2t("pixelsUnit"),i*e),o.putInteger(s2t("threshold"),n),a.putObject(s2t("filter"),s2t("unsharpMask"),o),s.putObject(s2t("filterFX"),s2t("filterFX"),a),executeAction(s2t("set"),s,DialogModes.NO)}function adjust_filter_gaussianBlur(e,t,r){var i=new ActionDescriptor,n=new ActionDescriptor,s=new ActionDescriptor,a=new ActionReference;a.putIndex(s2t("filterFX"),t),a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),i.putReference(s2t("null"),a),s.putUnitDouble(s2t("radius"),s2t("pixelsUnit"),r*e),n.putObject(s2t("filter"),s2t("gaussianBlur"),s),i.putObject(s2t("filterFX"),s2t("filterFX"),n),executeAction(s2t("set"),i,DialogModes.NO)}function adjust_filter_highPass(e,t,r){var i=new ActionDescriptor,n=new ActionDescriptor,s=new ActionDescriptor,a=new ActionReference;a.putIndex(s2t("filterFX"),t),a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),i.putReference(s2t("null"),a),s.putUnitDouble(s2t("radius"),s2t("pixelsUnit"),r*e),n.putObject(s2t("filter"),s2t("highPass"),s),i.putObject(s2t("filterFX"),s2t("filterFX"),n),executeAction(s2t("set"),i,DialogModes.NO)}function adjust_filter_helligkeit_interpolieren(e,t,r){var i=new ActionDescriptor,n=new ActionDescriptor,s=new ActionDescriptor,a=new ActionReference;a.putIndex(s2t("filterFX"),t),a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),i.putReference(s2t("null"),a),s.putUnitDouble(s2t("radius"),s2t("pixelsUnit"),r*e),n.putObject(s2t("filter"),s2t("median"),s),i.putObject(s2t("filterFX"),s2t("filterFX"),n),executeAction(s2t("set"),i,DialogModes.NO)}function adjust_filter_staubKratzer(e,t,r,i){var n=new ActionDescriptor,s=new ActionDescriptor,a=new ActionDescriptor,o=new ActionReference;o.putIndex(s2t("filterFX"),t),o.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),n.putReference(s2t("null"),o),a.putInteger(s2t("radius"),r*e),a.putInteger(s2t("threshold"),i),s.putObject(s2t("filter"),s2t("dustAndScratches"),a),n.putObject(s2t("filterFX"),s2t("filterFX"),s),executeAction(s2t("set"),n,DialogModes.NO)}function adjust_filter_motionBlur(e,t,r,i){var n=new ActionDescriptor,s=new ActionDescriptor,a=new ActionDescriptor,o=new ActionReference;o.putIndex(s2t("filterFX"),t),o.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),n.putReference(s2t("null"),o),a.putInteger(s2t("angle"),r),a.putUnitDouble(s2t("distance"),s2t("pixelsUnit"),i*e),s.putObject(s2t("filter"),s2t("motionBlur"),a),n.putObject(s2t("filterFX"),s2t("filterFX"),s),executeAction(s2t("set"),n,DialogModes.NO)}run();