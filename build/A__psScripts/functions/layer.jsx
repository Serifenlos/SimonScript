function checkTiefenLichter_create(e){var t=getLayerName(getActiveLayerIndex());if(createGroup("check "+e,"passThrough","none",100,f),createColorLayer("Tiefen_check","normal","none",100,"none",0,0,255),blendif("current",0,0,0+e,0+e),createColorLayer("Lichter_check","normal","none",100,"none",255,0,0),blendif("current",255-e,255-e,255,255),gotoLayer("check "+e),toogleOpenCloseSet(),layer_checkExistence("nachher"))moveLayer("check "+e,"nachher","up"),gotoLayer("check "+e),moveLayer3("down",1);else{for(var r=hasBackground()?0:1;layer_checkExistence(r);)r++;moveLayer("check "+e,parseInt(r-1),"up")}gotoLayer(t)}function checkTiefenLichter_create_button(e){try{if(layer_checkExistenceByRegex("check "))toogleVisibility("check ");else try{doc.suspendHistory("Create checkTiefenLichter","checkTiefenLichter_create("+e+")")}catch(e){alert("Error1:"+e)}}catch(e){alert("Error2:"+e)}}function checkTiefenLichter_edit(e,t){return blendif_check_steps=[],blendif_check_value=[],layer_blendif_edit(e,layer_getIDXbyString("Tiefen_check")[0],0,t),layer_blendif_edit(e,layer_getIDXbyString("Lichter_check")[0],-1*t,0),e?(blendif_check_steps.sort((function(e,t){return e-t})),layer_renameByIDX(layer_getIDXbyString("check ")[0],"check "+blendif_check_steps[0])):t>=0?blendif_check_value.sort((function(e,t){return t-e})):blendif_check_value.sort((function(e,t){return e-t})),blendif_check_value[0]}function checkTiefenLichter_edit_button(e){try{if(layer_checkExistenceByRegex("check"))try{e=parseInt(check_lastProtocolStep())+e;doc.suspendHistory("TiefenLichter Check "+checkTiefenLichter_protocol(checkTiefenLichter_edit(!1,e))+checkTiefenLichter_edit(!1,e)+" ","checkTiefenLichter_edit(true, "+e+");")}catch(e){alert("Error1:"+e)}}catch(e){alert("Error2:"+e)}}var checkTiefenLichter_protocol=function(e){return e>>>0===parseFloat(e)?"+":""},check_lastProtocolStep=function(){var e=doc.historyStates.length,t=doc.historyStates[e-1].name,r=new RegExp("^TiefenLichter Check ");if(t.match(r)){var n=parseInt(t.replace(/(TiefenLichter Check )([-+]\d)/g,"$2"));return undoSteps(1),n}return 0};function fixMask(e,t){try{var r=new ActionReference;r.putIndex(sTID("layer"),e);var n=executeActionGet(r),a=n.getUnitDoubleValue(sTID("userMaskFeather")),c=n.getUnitDoubleValue(sTID("userMaskDensity"));return a>0&&(gotoLayer(e),gotoMask(),setMaskFeatherTo(0),fixMaskFeather(a*t)),c<255&&(gotoLayer(e),gotoMask(),setMaskDensityTo(100),fixMaskDens(-1*(c-255))),!0}catch(n){return!1}}function fixMaskDens(e){var t=new ActionDescriptor,r=new ActionDescriptor,n=new ActionList,a=new ActionList,c=new ActionReference;t.putEnumerated(s2t("presetKind"),s2t("presetKindType"),s2t("presetKindCustom")),c.putEnumerated(s2t("channel"),s2t("ordinal"),s2t("targetEnum")),r.putReference(s2t("channel"),c),a.putInteger(e),a.putInteger(255),r.putList(s2t("output"),a),n.putObject(s2t("levelsAdjustment"),r),t.putList(s2t("adjustment"),n),executeAction(s2t("levels"),t,DialogModes.NO)}function fixMaskFeather(e){var t=new ActionDescriptor;t.putUnitDouble(s2t("radius"),s2t("pixelsUnit"),e),executeAction(s2t("gaussianBlur"),t,DialogModes.NO)}function fixMaskLoop(e){for(var t=getActiveLayerIndex(),r=1;fixMask(r,e);)r++;gotoLayer(t)}function getMaskVisibility(){var e=new ActionReference;return e.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),executeActionGet(e).getBoolean(s2t("userMaskEnabled"))}function layer_blendif_edit(e,t,r,n){var a=layer_blendif_get(t)[2]+n,c=layer_blendif_get(t)[0]+r,s=0;if(a<0){for(s=1;a+s<0;)s++;a=a+s}var i=0;if(c>255){for(i=1;c-i>255;)i++;c=c-i}e&&(blendif(t,c,c,a,a),blendif_check_steps.push(0+a),blendif_check_steps.push(255-c)),blendif_check_value.push(n+s),blendif_check_value.push(-1*(r-i))}function layer_blendif_get(_idx){try{var r=new ActionReference,d=new ActionDescriptor,array=[];r.putProperty(s2t("property"),s2t("json")),isNaN(_idx)?r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")):r.putIndex(s2t("layer"),_idx),d.putReference(s2t("null"),r),eval("var json="+executeAction(s2t("get"),d,DialogModes.NO).getString(s2t("json")));var parents=loopParentsIDXfor(_idx).length;if(0==parents)var call=json.layers[0];else if(1==parents)var call=json.layers[0].layers[0];else if(2==parents)var call=json.layers[0].layers[0].layers[0];else if(3==parents)var call=json.layers[0].layers[0].layers[0].layers[0];else if(4==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0];else if(5==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(6==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(7==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(8==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(9==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];else if(10==parents)var call=json.layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0].layers[0];if(call.blendOptions.blendRange){var data=call.blendOptions.blendRange.toSource(),data=data.replace(/^\[\(/g,"").replace(/\)\]$/g,""),data=data.replace(/([a-zA-Z]+)/g,'"$1"'),data=data.replace(/\"\"gray\"\"/g,'"gray"'),data=JSON.parse(data);for(var i in data)"destBlackMin"!=i&&"destBlackMax"!=i&&"destWhiteMin"!=i&&"desaturate"!=i||array.push(data[i]);return array}}catch(e){alert(e)}}function layer_checkExistence(e){try{var t=new ActionReference;t.putProperty(s2t("property"),s2t("itemIndex")),"number"==typeof e?t.putIndex(s2t("layer"),e):"string"==typeof e&&t.putName(s2t("layer"),e);executeActionGet(t).getInteger(s2t("itemIndex"));return!0}catch(e){return!1}}function layer_checkExistenceByRegex(e){return 0!==layer_getIDXbyString(e).length}function layer_copyLayers(){executeAction(sTID("copyToLayer"),void 0,DialogModes.NO)}function layer_delete(){var e=new ActionDescriptor,t=new ActionReference;t.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),e.putReference(s2t("null"),t),executeAction(s2t("delete"),e,DialogModes.NO)}function layer_getIDXbyName(e){var t=new ActionReference;return t.putProperty(s2t("property"),s2t("itemIndex")),t.putName(s2t("layer"),e),hasBackground()?executeActionGet(t).getInteger(s2t("itemIndex"))-1:executeActionGet(t).getInteger(s2t("itemIndex"))}function layer_getIDXbyString(e){for(var t=1,r=[];layer_checkExistence(t);){try{var n=new RegExp(e,"g");layer_getName(t).match(n)&&r.push(t)}catch(e){}t++}return r}function layer_getName(e){try{var t=new ActionReference;return t.putIndex(charIDToTypeID("Lyr "),e),executeActionGet(t).getString(stringIDToTypeID("name"))}catch(e){return e}}function layer_getSolidFillColor(){var e=[],t=new ActionReference;t.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"));var r=executeActionGet(t).getList(s2t("adjustment")).getObjectValue(0).getObjectValue(s2t("color"));return e.push(Math.round(r.getDouble(s2t("red")))),e.push(Math.round(r.getDouble(s2t("green")))),e.push(Math.round(r.getDouble(s2t("blue")))),e}function layer_mergeLayers(){var e=new ActionDescriptor;executeAction(s2t("mergeLayersNew"),e,DialogModes.NO)}function layer_mergeVisible(e){var t=new ActionDescriptor;t.putBoolean(s2t("duplicate"),e),executeAction(s2t("mergeVisible"),t,DialogModes.NO)}function layer_renameByIDX(e,t){if(0!=e){var r=new ActionDescriptor,n=new ActionReference;n.putIndex(s2t("layer"),e),r.putReference(s2t("null"),n);var a=new ActionDescriptor;a.putString(s2t("name"),t),r.putObject(s2t("to"),s2t("layer"),a),executeAction(s2t("set"),r,DialogModes.NO)}}function layer_selectedIDX_get(){var e=[],t=new ActionReference;t.putEnumerated(stringIDToTypeID("document"),stringIDToTypeID("ordinal"),stringIDToTypeID("targetEnum"));var r=executeActionGet(t);if(r.hasKey(stringIDToTypeID("targetLayers")))for(var n=0,a=(r=r.getList(stringIDToTypeID("targetLayers"))).count;n<a;n++)hasBackground()?e.push(r.getReference(n).getIndex()):e.push(r.getReference(n).getIndex()+1);return e}function layer_selectedIDX_set(e){try{if(selectLayers("selectNoLayers"),e.length>0)for(var r=0;r<e.length;r++)selectLayerBySelector(e[r],t)}catch(e){selectLayers("selectNoLayers")}}function layer_solidColorHSB_change(e,t,r){var n=new ActionDescriptor,a=new ActionDescriptor,c=new ActionDescriptor,s=new ActionReference;s.putEnumerated(s2t("contentLayer"),s2t("ordinal"),s2t("targetEnum")),n.putReference(s2t("null"),s),c.putUnitDouble(s2t("hue"),s2t("angleUnit"),e),c.putDouble(s2t("saturation"),t),c.putDouble(s2t("brightness"),r),a.putObject(s2t("color"),s2t("HSBColorClass"),c),n.putObject(s2t("to"),s2t("solidColorLayer"),a),executeAction(s2t("set"),n,DialogModes.NO)}function layer_transform(e,t,r,n,a,c,s){var i=new ActionDescriptor,o=new ActionDescriptor,l=new ActionReference;if("topleft"==e)var u="QCSCorner0";else if("topcenter"==e)u="QCSSide0";else if("topright"==e)u="QCSCorner1";else if("midleft"==e)u="QCSSide3";else if("midcenter"==e)u="QCSAverage";else if("midright"==e)u="QCSSide1";else if("bottomleft"==e)u="QCSCorner3";else if("bottomcenter"==e)u="QCSSide2";else if("bottomright"==e)u="QCSCorner2";else u="QCSCorner0";if(l.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),i.putReference(s2t("null"),l),i.putEnumerated(s2t("freeTransformCenterState"),s2t("quadCenterState"),s2t(u)),o.putUnitDouble(s2t("horizontal"),s2t("pixelsUnit"),t),o.putUnitDouble(s2t("vertical"),s2t("pixelsUnit"),r),i.putObject(s2t("offset"),s2t("offset"),o),"%_canvas"==c){var p=app.activeDocument.activeLayer.bounds[2]-app.activeDocument.activeLayer.bounds[0],y=app.activeDocument.activeLayer.bounds[3]-app.activeDocument.activeLayer.bounds[1],d=parseFloat(app.activeDocument.width/p*n),f=parseFloat(app.activeDocument.height/y*a);n&&i.putUnitDouble(s2t("width"),s2t("percentUnit"),d),a&&i.putUnitDouble(s2t("height"),s2t("percentUnit"),f)}else if("%_layer"==c){p=app.activeDocument.activeLayer.bounds[2]-app.activeDocument.activeLayer.bounds[0],y=app.activeDocument.activeLayer.bounds[3]-app.activeDocument.activeLayer.bounds[1],d=parseFloat(p/app.activeDocument.width*n*10),f=parseFloat(y/app.activeDocument.height*a*10);n&&i.putUnitDouble(s2t("width"),s2t("percentUnit"),d),a&&i.putUnitDouble(s2t("height"),s2t("percentUnit"),f)}else if("px"==c){d=parseFloat(n/app.activeDocument.width*100),f=parseFloat(a/app.activeDocument.height*100);n&&i.putUnitDouble(s2t("width"),s2t("percentUnit"),d),a&&i.putUnitDouble(s2t("height"),s2t("percentUnit"),f)}(n||a)&&s&&i.putBoolean(s2t("linked"),s),i.putEnumerated(s2t("interfaceIconFrameDimmed"),s2t("interpolationType"),s2t("bicubic")),executeAction(s2t("transform"),i,DialogModes.NO)}function selectLayerBySelector(e,t){try{var r=new ActionDescriptor,n=new ActionReference;if("remove"!=t&&t)a="addToSelection";else var a="removeFromSelection";isNaN(e)?n.putName(s2t("layer"),e):n.putIndex(s2t("layer"),e),r.putReference(s2t("null"),n),r.putEnumerated(s2t("selectionModifier"),s2t("selectionModifierType"),s2t(a)),r.putBoolean(s2t("makeVisible"),!1),executeAction(s2t("select"),r,DialogModes.NO)}catch(e){}}function select_nextLayer(e){var t=app.activeDocument.duplicate(),r=(t.activeLayer,t.layers[t.layers.length-1]),n=d();t.activeLayer=r;var a=r.isBackgroundLayer;a&&(r.isBackgroundLayer=!1);try{f(n)}catch(e){}var c=new ActionDescriptor,s=new ActionReference;s.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt")),c.putReference(cTID("null"),s),executeAction(sTID("selectAllLayers"),c,DialogModes.NO);var i=new ActionDescriptor,o=new ActionList,l=new ActionReference;l.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt")),o.putReference(l),i.putList(cTID("null"),o),executeAction(cTID("Shw "),i,DialogModes.NO),a&&(r.isBackgroundLayer=!0),f(n);try{!function(e){var t;"up"==e||"above"==e?t=cTID("Frwr"):"down"!=e&&"below"!=e||(t=cTID("Bckw"));var r=new ActionDescriptor,n=new ActionReference;n.putEnumerated(cTID("Lyr "),cTID("Ordn"),t),r.putReference(cTID("null"),n),executeAction(cTID("slct"),r,DialogModes.NO)}(e)}catch(e){}var u=d();t.close(SaveOptions.DONOTSAVECHANGES);try{f(u)}catch(e){var p=new ActionDescriptor,y=new ActionReference;y.putName(cTID("Lyr "),"Background"),p.putReference(cTID("null"),y),executeAction(cTID("slct"),p,DialogModes.NO)}function d(){var e=new ActionReference;return e.putProperty(s2t("property"),s2t("layerID")),e.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),executeActionGet(e).getInteger(s2t("layerID"))}function f(e,t){var r=new ActionDescriptor,n=new ActionReference;t=null==t?t=!1:t,n.putIdentifier(cTID("Lyr "),e),r.putReference(cTID("null"),n),t&&r.putEnumerated(sTID("selectionModifier"),sTID("selectionModifierType"),sTID("addToSelection")),r.putBoolean(cTID("MkVs"),!1),executeAction(cTID("slct"),r,DialogModes.NO)}}function select_nextLayer_simple(e,t){var r,n=new ActionDescriptor,a=new ActionReference;"up"==e||"above"==e?r=s2t("forwardEnum"):"down"!=e&&"below"!=e||(r=s2t("backwardEnum")),a.putEnumerated(s2t("layer"),s2t("ordinal"),r),n.putReference(s2t("null"),a),t=null==t?t=!1:t,n.putBoolean(s2t("makeVisible"),t),executeAction(s2t("select"),n,DialogModes.NO)}function setLayerOpacity(e){var t=new ActionDescriptor,r=new ActionDescriptor,n=new ActionReference;n.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),t.putReference(s2t("null"),n),r.putUnitDouble(s2t("opacity"),s2t("percentUnit"),e),t.putObject(s2t("to"),s2t("layer"),r),executeAction(s2t("set"),t,DialogModes.NO)}function setMaskVisibility(e){var t=new ActionDescriptor,r=new ActionDescriptor,n=new ActionReference;if(0==e||"hide"==e)var a=!1;else if(1==e||"show"==e)a=!0;else if("toggle"==e||"X"==e)if(getMaskVisibility())a=!1;else a=!0;try{n.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),t.putReference(s2t("null"),n),r.putBoolean(s2t("userMaskEnabled"),a),t.putObject(s2t("to"),s2t("layer"),r),executeAction(s2t("set"),t,DialogModes.NO)}catch(e){}}