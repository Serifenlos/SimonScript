function fixMask(e,t){try{var n=new ActionReference;n.putIndex(sTID("layer"),e);var r=executeActionGet(n),s=r.getUnitDoubleValue(sTID("userMaskFeather")),o=r.getUnitDoubleValue(sTID("userMaskDensity"));return s>0&&(gotoLayer(e),gotoMask(),setMaskFeatherTo(0),fixMaskFeather(s*t)),o<255&&(gotoLayer(e),gotoMask(),setMaskDensityTo(100),fixMaskDens(-1*(o-255))),!0}catch(r){return!1}}function fixMaskDens(e){var t=new ActionDescriptor,n=new ActionDescriptor,r=new ActionList,s=new ActionList,o=new ActionReference;t.putEnumerated(s2t("presetKind"),s2t("presetKindType"),s2t("presetKindCustom")),o.putEnumerated(s2t("channel"),s2t("ordinal"),s2t("targetEnum")),n.putReference(s2t("channel"),o),s.putInteger(e),s.putInteger(255),n.putList(s2t("output"),s),r.putObject(s2t("levelsAdjustment"),n),t.putList(s2t("adjustment"),r),executeAction(s2t("levels"),t,DialogModes.NO)}function fixMaskFeather(e){var t=new ActionDescriptor;t.putUnitDouble(s2t("radius"),s2t("pixelsUnit"),e),executeAction(s2t("gaussianBlur"),t,DialogModes.NO)}function fixMaskLoop(e){for(var t=getActiveLayerIndex(),n=1;fixMask(n,e);)n++;gotoLayer(t)}function getMaskVisibility(){var e=new ActionReference;return e.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),executeActionGet(e).getBoolean(s2t("userMaskEnabled"))}function layer_checkExistence(e){try{var t=new ActionReference;return t.putProperty(s2t("property"),s2t("itemIndex")),t.putIndex(s2t("layer"),e),executeActionGet(t).getInteger(s2t("itemIndex")),!0}catch(e){return!1}}function layer_getIDXbyString(e){for(var t=1,n=[];layer_checkExistence(t);){try{var r=new RegExp(e,"g");layer_getName(t).match(r)&&n.push(t)}catch(e){}t++}return n}function layer_getName(e){try{var t=new ActionReference;return t.putIndex(charIDToTypeID("Lyr "),e),executeActionGet(t).getString(stringIDToTypeID("name"))}catch(e){return e}}function layer_getSolidFillColor(){var e=[],t=new ActionReference;t.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"));var n=executeActionGet(t).getList(s2t("adjustment")).getObjectValue(0).getObjectValue(s2t("color"));return e.push(Math.round(n.getDouble(s2t("red")))),e.push(Math.round(n.getDouble(s2t("green")))),e.push(Math.round(n.getDouble(s2t("blue")))),e}function layer_selectedIDX_get(){var e=[],t=new ActionReference;t.putEnumerated(stringIDToTypeID("document"),stringIDToTypeID("ordinal"),stringIDToTypeID("targetEnum"));var n=executeActionGet(t);if(n.hasKey(stringIDToTypeID("targetLayers")))for(var r=0,s=(n=n.getList(stringIDToTypeID("targetLayers"))).count;r<s;r++)hasBackground()?e.push(n.getReference(r).getIndex()):e.push(n.getReference(r).getIndex()+1);return e}function layer_selectedIDX_set(e){try{if(selectLayers("selectNoLayers"),e.length>0)for(var n=0;n<e.length;n++)selectLayerBySelector(e[n],t)}catch(e){selectLayers("selectNoLayers")}}function layer_solidColorHSB_change(e,t,n){var r=new ActionDescriptor,s=new ActionDescriptor,o=new ActionDescriptor,a=new ActionReference;a.putEnumerated(s2t("contentLayer"),s2t("ordinal"),s2t("targetEnum")),r.putReference(s2t("null"),a),o.putUnitDouble(s2t("hue"),s2t("angleUnit"),e),o.putDouble(s2t("saturation"),t),o.putDouble(s2t("brightness"),n),s.putObject(s2t("color"),s2t("HSBColorClass"),o),r.putObject(s2t("to"),s2t("solidColorLayer"),s),executeAction(s2t("set"),r,DialogModes.NO)}function layer_transform(e,t,n,r,s,o,a){var i=new ActionDescriptor,c=new ActionDescriptor,u=new ActionReference;if("topleft"==e)var p="QCSCorner0";else p="topcenter"==e?"QCSSide0":"topright"==e?"QCSCorner1":"midleft"==e?"QCSSide3":"midcenter"==e?"QCSAverage":"midright"==e?"QCSSide1":"bottomleft"==e?"QCSCorner3":"bottomcenter"==e?"QCSSide2":"bottomright"==e?"QCSCorner2":"QCSCorner0";if(u.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),i.putReference(s2t("null"),u),i.putEnumerated(s2t("freeTransformCenterState"),s2t("quadCenterState"),s2t(p)),c.putUnitDouble(s2t("horizontal"),s2t("pixelsUnit"),t),c.putUnitDouble(s2t("vertical"),s2t("pixelsUnit"),n),i.putObject(s2t("offset"),s2t("offset"),c),"%_canvas"==o){var l=app.activeDocument.activeLayer.bounds[2]-app.activeDocument.activeLayer.bounds[0],d=app.activeDocument.activeLayer.bounds[3]-app.activeDocument.activeLayer.bounds[1],g=parseFloat(app.activeDocument.width/l*r),D=parseFloat(app.activeDocument.height/d*s);r&&i.putUnitDouble(s2t("width"),s2t("percentUnit"),g),s&&i.putUnitDouble(s2t("height"),s2t("percentUnit"),D)}else"%_layer"==o?(l=app.activeDocument.activeLayer.bounds[2]-app.activeDocument.activeLayer.bounds[0],d=app.activeDocument.activeLayer.bounds[3]-app.activeDocument.activeLayer.bounds[1],g=parseFloat(l/app.activeDocument.width*r*10),D=parseFloat(d/app.activeDocument.height*s*10),r&&i.putUnitDouble(s2t("width"),s2t("percentUnit"),g),s&&i.putUnitDouble(s2t("height"),s2t("percentUnit"),D)):"px"==o&&(g=parseFloat(r/app.activeDocument.width*100),D=parseFloat(s/app.activeDocument.height*100),r&&i.putUnitDouble(s2t("width"),s2t("percentUnit"),g),s&&i.putUnitDouble(s2t("height"),s2t("percentUnit"),D));(r||s)&&a&&i.putBoolean(s2t("linked"),a),i.putEnumerated(s2t("interfaceIconFrameDimmed"),s2t("interpolationType"),s2t("bicubic")),executeAction(s2t("transform"),i,DialogModes.NO)}function selectLayerBySelector(e,t){try{var n=new ActionDescriptor,r=new ActionReference;if("remove"!=t&&t)s="addToSelection";else var s="removeFromSelection";isNaN(e)?r.putName(s2t("layer"),e):r.putIndex(s2t("layer"),e),n.putReference(s2t("null"),r),n.putEnumerated(s2t("selectionModifier"),s2t("selectionModifierType"),s2t(s)),n.putBoolean(s2t("makeVisible"),!1),executeAction(s2t("select"),n,DialogModes.NO)}catch(e){}}function setLayerOpacity(e){var t=new ActionDescriptor,n=new ActionDescriptor,r=new ActionReference;r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),t.putReference(s2t("null"),r),n.putUnitDouble(s2t("opacity"),s2t("percentUnit"),e),t.putObject(s2t("to"),s2t("layer"),n),executeAction(s2t("set"),t,DialogModes.NO)}function setMaskVisibility(e){var t=new ActionDescriptor,n=new ActionDescriptor,r=new ActionReference;if(0==e||"hide"==e)var s=!1;else 1==e||"show"==e?s=!0:"toggle"!=e&&"X"!=e||(s=!getMaskVisibility());try{r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum")),t.putReference(s2t("null"),r),n.putBoolean(s2t("userMaskEnabled"),s),t.putObject(s2t("to"),s2t("layer"),n),executeAction(s2t("set"),t,DialogModes.NO)}catch(e){}}