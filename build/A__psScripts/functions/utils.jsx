function TemporaryAlpha(){activeDocument.selection.store(this.alpha=activeDocument.channels.add());activeDocument.selection.deselect();this.consume=function(){activeDocument.selection.load(this.alpha);this.alpha.remove()}}function activateLayerMask(){var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));e.putReference(cTID("null"),r);try{executeAction(cTID("slct"),e,DialogModes.NO)}catch(e){var t=new TemporaryAlpha;maskFromSelection();activateLayerMask();t.consume()}}function addLayer(){var e=activeDocument.activeLayer;var r=activeDocument.layerSets.add();r.move(e,ElementPlacement.PLACEBEFORE);return r}function addNext(){theCurrentSelectionIDX=getSelectedLayersIdx();makeActiveByIndex(theCurrentSelectionIDX[0],false);myselectNext();theCurrentSelectionIDX.push(getActiveLayerIndex());makeActiveByIndex(theCurrentSelectionIDX,false)}function addPrevious(){theCurrentSelectionIDX=getSelectedLayersIdx();makeActiveByIndex(theCurrentSelectionIDX[theCurrentSelectionIDX.length-1],false);myselectPrevious();theCurrentSelectionIDX.push(getActiveLayerIndex());makeActiveByIndex(theCurrentSelectionIDX,false)}function addSibilings(){theSelIDX1=getSelectedLayersIdx();theSibilings=getSibilings1();var e=theSelIDX1.concat(theSibilings);makeActiveByIndex(e,false)}function addTempLayerSetIn(e){var r=charIDToTypeID("Mk  ");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=stringIDToTypeID("layerSection");n.putClass(c);t.putReference(a,n);executeAction(r,t,DialogModes.NO);var o=charIDToTypeID("setd");var i=new ActionDescriptor;var a=charIDToTypeID("null");var D=new ActionReference;var I=charIDToTypeID("Lyr ");var T=charIDToTypeID("Ordn");var p=charIDToTypeID("Trgt");D.putEnumerated(I,T,p);i.putReference(a,D);var u=charIDToTypeID("T   ");var s=new ActionDescriptor;var y=charIDToTypeID("Nm  ");s.putString(y,"mb-dummy tempTestLayerSetOpen_Closed");var I=charIDToTypeID("Lyr ");i.putObject(u,I,s);executeAction(o,i,DialogModes.NO);var l=charIDToTypeID("move");var v=new ActionDescriptor;var a=charIDToTypeID("null");var f=new ActionReference;var I=charIDToTypeID("Lyr ");var T=charIDToTypeID("Ordn");var p=charIDToTypeID("Trgt");f.putEnumerated(I,T,p);v.putReference(a,f);var u=charIDToTypeID("T   ");var h=new ActionReference;var I=charIDToTypeID("Lyr ");h.putIndex(I,e);v.putReference(u,h);var g=charIDToTypeID("Adjs");v.putBoolean(g,false);var d=charIDToTypeID("Vrsn");v.putInteger(d,5);executeAction(l,v,DialogModes.NO)}function addToSelection(e){var r=new ActionDescriptor;var t=new ActionReference;t.putName(cTID("Lyr "),e);r.putReference(cTID("null"),t);r.putEnumerated(sTID("selectionModifier"),sTID("selectionModifierType"),sTID("addToSelection"));r.putBoolean(cTID("MkVs"),false);try{executeAction(cTID("slct"),r,DialogModes.NO)}catch(e){}}function closeGroup(e){var r=isLocked();var t=isVisible();var a=e.name;var n=e.opacity;var c=e.blendMode;var o=e.linkedLayers;var i=getActiveLayerIndex();var D=getActiveLayerIndex();if(!hasBackground()){D=D-1}var I=getColor();try{var T=hasLayerMask()}catch(e){}try{var p=hasVectorMask()}catch(e){}var I=getColor();var u=false;try{copyLayerStyle();u=true}catch(e){}if(r==true){unlock()}if(t==false){makeVisible()}if(T){try{deselectPath()}catch(e){}var s=isLayerMaskEnabled();duplicateLayerMaskAsAlpha();try{var y=getMaskDensity();var l=getMaskFeather()}catch(e){}var v=isLayerMaskLinked()}if(p){var f=getVectorMaskDensity();var h=getVectorMaskFeather();duplicateVectorMask()}if(e.layers.length<=1){addTempLayerSetIn(D);makeActiveByIndex(i+2,false);ungroup();groupSelected(a);makeActiveByIndex(i+2,false);deleteTempLayerSetbyIdx(currSetIDX+1)}else{makeActiveByIndex(currSetIDX,false);ungroup();groupSelected(a)}var g=activeDocument.activeLayer;g.opacity=n;g.blendMode=c;for(x in o){if(o[x].typename=="LayerSet"){activeDocument.activeLayer.link(o[x])}}if(u)pasteLayerStyle();if(T){setBackTheLayerMask();try{setMaskDensityTo(Math.round(y*100/255));setMaskFeatherTo(l)}catch(e){}setMaskLinked(v);setMaskEnabled(s)}if(p){recreateVectorMask();setVectorMaskDensityTo(Math.round(f*100/255));setVectorMaskFeatherTo(h)}setColorTo(I);if(r==true){lock()}if(t==false){hide()}return g}function copyLayerStyle(){executeAction(s2t("copyEffects"),undefined,DialogModes.NO)}function copypaste_LayerFX(e,r){var t=layer_selectedIDX_get();if(isLayerFXVisible(e)){gotoLayer_bySelector(e);copyLayerStyle();gotoLayer_bySelector(r);pasteLayerStyle()}layer_selectedIDX_set(t)}function deleteActiveLayer(){var e=charIDToTypeID("Dlt ");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Lyr ");var c=charIDToTypeID("Ordn");var o=charIDToTypeID("Trgt");a.putEnumerated(n,c,o);r.putReference(t,a);executeAction(e,r,DialogModes.NO)}function deleteMask(e){if(e){loadSelectionOfMask()}var r=new ActionDescriptor;var t=new ActionReference;t.putEnumerated(cTID("Chnl"),cTID("Ordn"),cTID("Trgt"));r.putReference(cTID("null"),t);try{executeAction(cTID("Dlt "),r,DialogModes.NO)}catch(e){}}function deleteTempLayerSetbyIdx(e){var r=charIDToTypeID("Dlt ");var t=new ActionDescriptor;var a=new ActionReference;a.putIndex(charIDToTypeID("Lyr "),e);t.putReference(charIDToTypeID("null"),a);executeAction(r,t,DialogModes.NO)}function deselectPath(){var e=new ActionDescriptor;var r=new ActionReference;r.putClass(cTID("Path"));e.putReference(cTID("null"),r);executeAction(cTID("Dslc"),e,DialogModes.NO)}function duplicateLayerMaskAsAlpha(){selectLayerMask();var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));e.putReference(cTID("null"),r);e.putBoolean(cTID("MkVs"),true);executeAction(cTID("slct"),e,DialogModes.NO);var t=charIDToTypeID("setd");var a=new ActionDescriptor;var n=charIDToTypeID("null");var c=new ActionReference;var o=charIDToTypeID("Chnl");var i=charIDToTypeID("fsel");c.putProperty(o,i);a.putReference(n,c);var D=charIDToTypeID("T   ");var I=charIDToTypeID("Ordn");var T=charIDToTypeID("Al  ");a.putEnumerated(D,I,T);executeAction(t,a,DialogModes.NO);var p=charIDToTypeID("copy");executeAction(p,undefined,DialogModes.NO);var u=charIDToTypeID("Mk  ");var s=new ActionDescriptor;var y=charIDToTypeID("Nw  ");var l=new ActionDescriptor;var v=charIDToTypeID("ClrI");var f=charIDToTypeID("MskI");var h=charIDToTypeID("MskA");l.putEnumerated(v,f,h);var g=charIDToTypeID("Clr ");var d=new ActionDescriptor;var A=charIDToTypeID("Rd  ");d.putDouble(A,255);var m=charIDToTypeID("Grn ");d.putDouble(m,0);var x=charIDToTypeID("Bl  ");d.putDouble(x,0);var L=charIDToTypeID("RGBC");l.putObject(g,L,d);var S=charIDToTypeID("Opct");l.putInteger(S,50);var o=charIDToTypeID("Chnl");s.putObject(y,o,l);executeAction(u,s,DialogModes.NO);var t=charIDToTypeID("setd");var w=new ActionDescriptor;var n=charIDToTypeID("null");var R=new ActionReference;var o=charIDToTypeID("Chnl");var i=charIDToTypeID("fsel");R.putProperty(o,i);w.putReference(n,R);var D=charIDToTypeID("T   ");var I=charIDToTypeID("Ordn");var T=charIDToTypeID("Al  ");w.putEnumerated(D,I,T);executeAction(t,w,DialogModes.NO);var k=charIDToTypeID("past");var O=new ActionDescriptor;var b=charIDToTypeID("AntA");var M=charIDToTypeID("Annt");var E=charIDToTypeID("Anno");O.putEnumerated(b,M,E);executeAction(k,O,DialogModes.NO);var t=charIDToTypeID("setd");var N=new ActionDescriptor;var n=charIDToTypeID("null");var G=new ActionReference;var o=charIDToTypeID("Chnl");var i=charIDToTypeID("fsel");G.putProperty(o,i);N.putReference(n,G);var D=charIDToTypeID("T   ");var I=charIDToTypeID("Ordn");var X=charIDToTypeID("None");N.putEnumerated(D,I,X);executeAction(t,N,DialogModes.NO);var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Ordn"),cTID("Trgt"));e.putReference(cTID("null"),r);var C=new ActionDescriptor;C.putString(cTID("Nm  "),"mbTemp_alpha");e.putObject(cTID("T   "),cTID("Chnl"),C);executeAction(cTID("setd"),e,DialogModes.NO);var P=new ActionDescriptor;var B=new ActionReference;B.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("RGB "));P.putReference(cTID("null"),B);P.putBoolean(cTID("MkVs"),false);executeAction(cTID("slct"),P,DialogModes.NO)}function duplicateVectorMask(){var e=charIDToTypeID("slct");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Path");var n=charIDToTypeID("Path");var c=stringIDToTypeID("vectorMask");a.putEnumerated(n,n,c);var o=charIDToTypeID("Lyr ");var i=charIDToTypeID("Ordn");var D=charIDToTypeID("Trgt");a.putEnumerated(o,i,D);r.putReference(t,a);executeAction(e,r,DialogModes.NO);var I=charIDToTypeID("Mk  ");var T=new ActionDescriptor;var t=charIDToTypeID("null");var p=new ActionReference;var n=charIDToTypeID("Path");p.putClass(n);T.putReference(t,p);var u=charIDToTypeID("From");var s=new ActionReference;var n=charIDToTypeID("Path");var n=charIDToTypeID("Path");var c=stringIDToTypeID("vectorMask");s.putEnumerated(n,n,c);var o=charIDToTypeID("Lyr ");var i=charIDToTypeID("Ordn");var D=charIDToTypeID("Trgt");s.putEnumerated(o,i,D);T.putReference(u,s);executeAction(I,T,DialogModes.NO);var y=charIDToTypeID("Rnm ");var l=new ActionDescriptor;var t=charIDToTypeID("null");var v=new ActionReference;var n=charIDToTypeID("Path");var i=charIDToTypeID("Ordn");var D=charIDToTypeID("Trgt");v.putEnumerated(n,i,D);l.putReference(t,v);var f=charIDToTypeID("T   ");l.putString(f,"mbTemp_path");executeAction(y,l,DialogModes.NO);var h=charIDToTypeID("Dslc");var g=new ActionDescriptor;var t=charIDToTypeID("null");var d=new ActionReference;var n=charIDToTypeID("Path");d.putClass(n);g.putReference(t,d);executeAction(h,g,DialogModes.NO)}function eliminateDuplicates(e){var r,t=e.length,a=[],n={};for(r=0;r<t;r++){n[e[r]]=0}for(r in n){a.push(r)}return a}function eliminateTheSame(e,r){var t,a=e.length,n=r.length,c=[],o={};for(t=0;t<a;t++){c.push(e[t]);for(j=0;j<n;j++){if(e[t]==r[j]){c.pop(1);break}}}return c}function getActiveLayerIndex(){var e=new ActionReference;e.putProperty(charIDToTypeID("Prpr"),charIDToTypeID("ItmI"));e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));return hasBackground()?executeActionGet(e).getInteger(charIDToTypeID("ItmI"))-1:executeActionGet(e).getInteger(charIDToTypeID("ItmI"))}function getClosedSets(){var e=[];var r=1;while(layer_checkExistence(r)){if(isLayerSet(r)){if(!isSetOpened2(r)){e.push(r)}}r++}return e}function getColor(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);a=r.getEnumerationValue(cTID("Clr "));return typeIDToCharID(a)}function getFristLayerSetChildVisible(){xx=false;var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e).getInteger(charIDToTypeID("Cnt "));var t=executeActionGet(e).getInteger(stringIDToTypeID("layerID"));var a=[];var n=0;var c=0;var o=0;currINDEX=getActiveLayerIndex();var i=currINDEX;for(i;i>0;i--){e=new ActionReference;e.putIndex(charIDToTypeID("Lyr "),i);var D=executeActionGet(e);var I=D.getString(charIDToTypeID("Nm  "));var T=D.getInteger(stringIDToTypeID("layerID"));var p=D.getEnumerationValue(stringIDToTypeID("layerSection"));p=typeIDToStringID(p);var u=D.getInteger(stringIDToTypeID("visible"));if(p=="layerSectionStart"){n++}if(u==1&&T!=t&&o!=0){var s={id:T,lname:I,idx:i};xx=true;a.push(s);break}var y=new RegExp("^</Layer group");if(I.match(y)){c++;o=n-c;if(o==0&&p=="layerSectionEnd"){break}continue}}return a}function getLastChildIdx(){xx=false;var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e).getInteger(charIDToTypeID("Cnt "));var t=executeActionGet(e).getInteger(stringIDToTypeID("layerID"));currINDEX=getActiveLayerIndex();var a=currINDEX;var n=0;var c=0;var o=0;var i=0;for(a;a>0;a--){e=new ActionReference;e.putIndex(charIDToTypeID("Lyr "),a);var D=executeActionGet(e);var I=D.getString(charIDToTypeID("Nm  "));var T=D.getInteger(stringIDToTypeID("layerID"));var p=D.getEnumerationValue(stringIDToTypeID("layerSection"));p=typeIDToStringID(p);var u=D.getInteger(stringIDToTypeID("visible"));if(p=="layerSectionStart"){n++}var s=new RegExp("^</Layer group");if(I.match(s)){c++;o=n-c;if(o==0&&p=="layerSectionEnd"){i=a;break}}}return i}function getLayerName(e){var r=new ActionReference;r.putIndex(cTID("Lyr "),e);var t=executeActionGet(r);return t.getString(charIDToTypeID("Nm  "))}function getLayersNb(){var e=new ActionReference;e.putProperty(charIDToTypeID("Prpr"),stringIDToTypeID("numberOfLayers"));e.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e);var t=r.getInteger(stringIDToTypeID("numberOfLayers"));return t}function getMaskDensity(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getUnitDoubleValue(sTID("userMaskDensity"))}function getMaskFeather(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getUnitDoubleValue(sTID("userMaskFeather"))}function getNamesPlusIDsOfLayerSet(){var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e).getInteger(charIDToTypeID("Cnt "));var t=executeActionGet(e).getInteger(stringIDToTypeID("layerID"));var a=[];var n=0;var c=0;var o=0;currINDEX=getActiveLayerIndex();var i=currINDEX;for(i;i>0;i--){e=new ActionReference;e.putIndex(charIDToTypeID("Lyr "),i);var D=executeActionGet(e);var I=D.getString(charIDToTypeID("Nm  "));var T=D.getInteger(stringIDToTypeID("layerID"));var p=D.getEnumerationValue(stringIDToTypeID("layerSection"));p=typeIDToStringID(p);if(p=="layerSectionStart"){n++}var u=new RegExp("^</Layer group");if(I.match(u)){c++;o=n-c;if(o==0&&p=="layerSectionEnd"){break}continue}if(p=="layerSectionContent"){makeActiveByIndex(i,false);break}var s=typeIDToStringID(D.getEnumerationValue(stringIDToTypeID("layerSection")));var y=s=="layerSectionContent"?false:true;a.push([[T],[I],[y]])}return a}function getNbOfChilds(){xx=false;var e=new ActionReference;e.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var r=executeActionGet(e).getInteger(charIDToTypeID("Cnt "));var t=executeActionGet(e).getInteger(stringIDToTypeID("layerID"));currINDEX=getActiveLayerIndex();var a=currINDEX;var n=0;var c=0;var o=0;var i=0;for(a;a>0;a--){e=new ActionReference;e.putIndex(charIDToTypeID("Lyr "),a);var D=executeActionGet(e);var I=D.getString(charIDToTypeID("Nm  "));var T=D.getInteger(stringIDToTypeID("layerID"));var p=D.getEnumerationValue(stringIDToTypeID("layerSection"));p=typeIDToStringID(p);var u=D.getInteger(stringIDToTypeID("visible"));if(p=="layerSectionStart"){c++}var s=new RegExp("^</Layer group");if(I.match(s)){o++;i=c-o;if(i==0&&p=="layerSectionEnd"){break}continue}n++}return n}function getParentIDXfor(e){xx=false;var r=getLayersNb();currINDEX=e;var t=currINDEX;var a=0;var n=1;var c=0;try{if(isLayerSet(e)){c=-1}}catch(e){return}var o=0;for(t;t<=r;t++){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),t);var i=executeActionGet(ref);var D=i.getString(charIDToTypeID("Nm  "));var I=i.getInteger(stringIDToTypeID("layerID"));var T=i.getEnumerationValue(stringIDToTypeID("layerSection"));T=typeIDToStringID(T);var p=i.getInteger(stringIDToTypeID("visible"));if(T=="layerSectionEnd"){n++}if(T=="layerSectionStart"){c++}o=n-c;if(o==0&&T=="layerSectionStart"){a=t;break}}return a}function getParentIndex1(e){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),e);var r=executeActionGet(ref);if(r.hasKey(stringIDToTypeID("targetEnum"))){alert("parentIDX")}}function getSelectedLayersIdx(){var e=new Array;var r=new ActionReference;r.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var t=executeActionGet(r);var a=1;if(hasBackground()){a=0}if(t.hasKey(stringIDToTypeID("targetLayers"))){t=t.getList(stringIDToTypeID("targetLayers"));var n=t.count;var e=new Array;for(var c=0;c<n;c++){e.push(t.getReference(c).getIndex()+a)}}else{var r=new ActionReference;r.putProperty(charIDToTypeID("Prpr"),charIDToTypeID("ItmI"));r.putEnumerated(charIDToTypeID("Lyr "),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));srs=hasBackground()?executeActionGet(r).getInteger(charIDToTypeID("ItmI"))-1:executeActionGet(r).getInteger(charIDToTypeID("ItmI"));e.push(srs)}return e}function getSibilings(){theSlIDX=getSelectedLayersIdx();var e=[];var t=[];for(a in theSlIDX){t.push(getParentIDXfor(theSlIDX[a]))}t=eliminateDuplicates(t);for(l in t){parent=t[l];count=getLayersNb();var n=0;if(parent==0){i=count}else{i=parent-1}if(!hasBackground()){n=1}x=0;y=0;r=0;for(i;i>=n;i--){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),i);var c=executeActionGet(ref);var o=c.getString(charIDToTypeID("Nm  "));var D=c.getEnumerationValue(stringIDToTypeID("layerSection"));D=typeIDToStringID(D);e.push(i);if(i==theSlIDX[l]){e.pop(1)}if(r!=0&&i!=theSlIDX[l]){e.pop(1)}if(D=="layerSectionStart"){x++}if(D=="layerSectionEnd"){y++;if(r==0){break}}r=x-y}}return e}function getSibilings1(){theSlIDX=getSelectedLayersIdx();var e=[];var t=[];count=getLayersNb();var a=0;var n=count;tempSibilings={};if(!hasBackground()){a=1}x=0;y=0;r=0;parent=[0];oldParent=0;whatSibilingsMatterO={};var o=[];e=[];for(n;n>=a;n--){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),n);var i=executeActionGet(ref);var D=i.getEnumerationValue(stringIDToTypeID("layerSection"));D=typeIDToStringID(D);cparent=parent[parent.length-1].toString();if(tempSibilings[cparent]==undefined){o=[]}else{o=tempSibilings[cparent]}o.push(n);tempSibilings[cparent]=o;if(D=="layerSectionStart"){parent.push(n)}if(D=="layerSectionEnd"){parent.pop(1)}if(n==theSlIDX[theSlIDX.length-1]){theSlIDX.pop(1);whatSibilingsMatterO[cparent]=cparent;tss1=tempSibilings[cparent];tss1.pop(1);tempSibilings[cparent]=tss1}}for(c in whatSibilingsMatterO){e=e.concat(tempSibilings[whatSibilingsMatterO[c]])}return e}function getStartIDXfor(e){xx=false;var r=getLayersNb();currINDEX=e;var t=currINDEX;var a=0;var n=0;var c=0;var o=0;for(t;t<=r;t++){ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),t);var i=executeActionGet(ref);var D=i.getString(charIDToTypeID("Nm  "));var I=i.getInteger(stringIDToTypeID("layerID"));var T=i.getEnumerationValue(stringIDToTypeID("layerSection"));T=typeIDToStringID(T);var p=i.getInteger(stringIDToTypeID("visible"));if(T=="layerSectionEnd"){n++}if(T=="layerSectionStart"){c++}o=n-c;if(o==0&&T=="layerSectionStart"){a=t;break}}return a}function getVectorMaskDensity(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getInteger(sTID("vectorMaskDensity"))}function getVectorMaskFeather(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getUnitDoubleValue(sTID("vectorMaskFeather"))}function getVisible(e){try{var r=new ActionReference;if(typeof e=="number"){r.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){r.putName(s2t("layer"),e)}else{r.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}var t=executeActionGet(r).getInteger(s2t("visible"));return t}catch(e){}}function getVisibleforIDX(e){var r=new ActionReference;r.putIndex(charIDToTypeID("Lyr "),e);var t=executeActionGet(r).getInteger(stringIDToTypeID("visible"));return t}function groupSelected(e){var r=new ActionDescriptor;var t=new ActionReference;t.putClass(sTID("layerSection"));r.putReference(cTID("null"),t);var a=new ActionReference;a.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt"));r.putReference(cTID("From"),a);var n=new ActionDescriptor;n.putString(cTID("Nm  "),e);r.putObject(cTID("Usng"),sTID("layerSection"),n);executeAction(cTID("Mk  "),r,DialogModes.NO);return activeDocument.activeLayer}function hasBackground(){var e=undefined;try{var r=new ActionReference;r.putProperty(cTID("Prpr"),cTID("Nm  "));r.putIndex(cTID("Lyr "),0);executeActionGet(r).getString(cTID("Nm  "));e=true}catch(r){e=false}return e}function hasLayerMask(e){var r=new ActionReference;if(typeof e=="number"){r.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){r.putName(s2t("layer"),e)}else{r.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}var t=executeActionGet(r);return t.hasKey(cTID("Usrs"))}function hasVectorMask(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getBoolean(sTID("hasVectorMask"))}function hide(e){try{var r=new ActionDescriptor;var t=new ActionList;var a=new ActionReference;if(typeof e=="number"){a.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){a.putName(s2t("layer"),e)}else{a.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}t.putReference(a);r.putList(c2t("null"),t);executeAction(s2t("hide"),r,DialogModes.NO)}catch(e){}}function isEndOfSet(e){xx=false;ref=new ActionReference;ref.putIndex(charIDToTypeID("Lyr "),e);var r=executeActionGet(ref);var t=r.getString(charIDToTypeID("Nm  "));var a=r.getInteger(stringIDToTypeID("layerID"));var n=r.getEnumerationValue(stringIDToTypeID("layerSection"));n=typeIDToStringID(n);var c=r.getInteger(stringIDToTypeID("visible"));var o=new RegExp("^</Layer group");if(t.match(o)){if(n=="layerSectionEnd"){xx=true}}return xx}function isLayerFXVisible(e){var r=new ActionReference;if(typeof e=="number"){r.putIndex(s2t("layer"),e)}if(typeof e=="string"){if(layer_checkExistence(e)){r.putName(s2t("layer"),e)}else{r.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}if(typeof e==="undefined"){r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}try{return executeActionGet(r).getBoolean(s2t("layerFXVisible"))}catch(e){if(debug)alert("ERROR - gotoLayer_bySelector: \n"+e)}}function isLayerMaskEnabled(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getBoolean(cTID("UsrM"))}function isLayerMaskLinked(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getBoolean(cTID("Usrs"))}function isLayerSet(e){var r=stringIDToTypeID("layerSection");var t=new ActionReference;t.putProperty(charIDToTypeID("Prpr"),r);t.putIndex(charIDToTypeID("Lyr "),e);var a=executeActionGet(t);var n=a.getEnumerationValue(r);var c=typeIDToStringID(n);return c=="layerSectionStart"?true:false}function isLocked(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);a=r.getObjectValue(sTID("layerLocking"));return a.getBoolean(sTID("protectAll"))}function isSetOpened1(e){app.activeDocument.activeLayer=e;mb_Locked=isLocked();mb_visible=isVisible();if(mb_Locked==true){unlock()}xx=true;currSetIDX=getActiveLayerIndex();currSetIDX1=getActiveLayerIndex();if(!hasBackground()){currSetIDX1=currSetIDX1-1}addTempLayerSetIn(currSetIDX1);var r=getActiveLayerIndex();makeActiveByIndex(currSetIDX+2,false);if(r==getActiveLayerIndex()){xx=false}deleteTempLayerSetbyIdx(currSetIDX+1);if(mb_Locked==true){lock()}if(mb_visible==false){hide()}return xx}function isSetOpened2(e){var r=new ActionReference;r.putIndex(app.stringIDToTypeID("layer"),e);var t=executeActionGet(r);var a=t.getBoolean(app.stringIDToTypeID("layerSectionExpanded"));return a}function isVectorMaskEnabled(){var e=new ActionReference;e.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);if(r.hasKey(967)){alert("VE")}return r.getBoolean(967)}function isVectorMaskLinked(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);if(r.hasKey(968)){alert("VE")}return r.getBoolean(968)}function isVisible(){var e=new ActionReference;e.putEnumerated(sTID("layer"),cTID("Ordn"),cTID("Trgt"));var r=executeActionGet(e);return r.getBoolean(sTID("visible"))}function isVisibleIDX(e){var r=new ActionReference;r.putIndex(sTID("layer"),e);var t=executeActionGet(r);return t.getBoolean(sTID("visible"))}function loadSelectionOfMask(){const e=workingProfile_get("Gray");const r=doc.colorProfileName;gamma_L=["eciRGB v2","eciRGB v2 ICCv4"];gamma_18=["sRGB IEC61966-2.1","ProPhoto RGB","Display P3","image P3","Apple RGB","ColorMatch RGB"];gamma_22=["Adobe RGB (1998)","BestRGB","Beta RGB","DonRGB4.icm","MaxRGB","Russell RGB"];if(array_contains(gamma_18,r)){if(e!="Gray Gamma 1.8"){workingProfile_set("Gray","Gray Gamma 1.8")}}if(array_contains(gamma_22,r)){if(e!="Gray Gamma 2.2"){workingProfile_set("Gray","Gray Gamma 2.2")}}if(array_contains(gamma_L,r)){workingProfile_set("Gray","Gray-elle-V4-labl.icc")}if(!array_contains(gamma_18,r)&&!array_contains(gamma_22,r)&&!array_contains(gamma_L,r)){alert("Vorsicht\nDie Helligkeitsverteilung könnte fehlerhaft sein.\nfehlende Info zum Gamma von '"+r+"'")}selectLayerMask();var t=new ActionDescriptor;var a=new ActionReference;a.putProperty(cTID("Chnl"),cTID("fsel"));t.putReference(cTID("null"),a);var n=new ActionReference;n.putEnumerated(cTID("Chnl"),cTID("Ordn"),cTID("Trgt"));t.putReference(cTID("T   "),n);try{executeAction(cTID("setd"),t,DialogModes.NO)}catch(e){}if(e!=workingProfile_get("Gray")){workingProfile_set("Gray",e)}}function lock(){var e=charIDToTypeID("setd");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Lyr ");var c=charIDToTypeID("Ordn");var o=charIDToTypeID("Trgt");a.putEnumerated(n,c,o);r.putReference(t,a);var i=charIDToTypeID("T   ");var D=new ActionDescriptor;var I=stringIDToTypeID("layerLocking");var T=new ActionDescriptor;var p=stringIDToTypeID("protectAll");T.putBoolean(p,true);var I=stringIDToTypeID("layerLocking");D.putObject(I,I,T);var n=charIDToTypeID("Lyr ");r.putObject(i,n,D);executeAction(e,r,DialogModes.NO)}function loopParentsIDXfor(e){var r=new Array;var t=getLayersNb();var a=getParentIDXfor(e);for(k=0;k<t;k++){if(a!=0){r.push(a)}else{break}a=getParentIDXfor(a)}return r}function makeActiveByIndex(e,r){if(e.constructor!=Array)e=[e];for(var t=0;t<e.length;t++){var a=new ActionDescriptor;var n=new ActionReference;n.putIndex(charIDToTypeID("Lyr "),e[t]);a.putReference(charIDToTypeID("null"),n);if(t>0){var c=stringIDToTypeID("selectionModifier");var o=stringIDToTypeID("selectionModifierType");var i=stringIDToTypeID("addToSelection");a.putEnumerated(c,o,i)}a.putBoolean(charIDToTypeID("MkVs"),r);executeAction(charIDToTypeID("slct"),a,DialogModes.NO)}}function makeVisByIndex(e,r){if(r==true){var t=charIDToTypeID("Shw ")}else{var t=charIDToTypeID("Hd  ")}var a=new ActionDescriptor;var n=new ActionReference;n.putIndex(charIDToTypeID("Lyr "),e);a.putReference(charIDToTypeID("null"),n);executeAction(t,a,DialogModes.NO)}function makeVisible(e){try{var r=new ActionDescriptor;var t=new ActionList;var a=new ActionReference;if(typeof e=="number"){a.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){a.putName(s2t("layer"),e)}else{a.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}t.putReference(a);r.putList(c2t("null"),t);executeAction(s2t("show"),r,DialogModes.NO)}catch(e){}}function maskFromSelection(){if(!hasLayerMask()){var e=new ActionDescriptor;e.putClass(cTID("Nw  "),cTID("Chnl"));var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));e.putReference(cTID("At  "),r);e.putEnumerated(cTID("Usng"),cTID("UsrM"),cTID("RvlS"));try{executeAction(cTID("Mk  "),e,DialogModes.NO)}catch(e){activeDocument.selection.selectAll();maskFromSelection()}}else{if(confirm("Delete existing mask?",true,"Warning")){activateLayerMask();deleteMask()}}}function myselectNext(){currINDEX=getActiveLayerIndex();lastSetIdx=0;lastLayer=0;testIDX=1;if(hasBackground()){lastLayer=-1;testIDX=0}if(isLayerSet(currINDEX)){if(getNbOfChilds()>1){if(!isSetOpened2(currINDEX)){lastSetIdx=getLastChildIdx();currINDEX=lastSetIdx}}else{currINDEX=currINDEX-1}}nextIndex=currINDEX-1;if(nextIndex<=lastLayer){nextIndex=getLayersNb()}var e=new RegExp("^</Layer group");if(getLayerName(nextIndex).match(e)){bb=nextIndex-1;for(bb;bb>0;bb--){var e=new RegExp("^</Layer group");if(getLayerName(bb).match(e)){nextIndex--}else{break}}}try{makeActiveByIndex(nextIndex,false)}catch(e){}if(currINDEX!=testIDX){if(getActiveLayerIndex()==getLayersNb()){try{makeActiveByIndex(nextIndex-1,false)}catch(e){}}}}function myselectNextFor(e){for(i=0;i<e;i++){myselectNext()}}function myselectPrevious(){nbL=getLayersNb();currINDEX=getActiveLayerIndex();lastSetIdx=0;lastLayer=1;if(hasBackground()){lastLayer=0}if(currINDEX==nbL){nextIndex=lastLayer}else{nextIndex=currINDEX+1}b=getLayersNb();for(aa=0;aa<b;aa++){if(isEndOfSet(nextIndex)){parentIDX=getStartIDXfor(nextIndex);if(!isSetOpened2(parentIDX)){nextIndex=parentIDX}else{nextIndex++}}else{break}}try{makeActiveByIndex(nextIndex,false)}catch(e){}if(getActiveLayerIndex()==getLayersNb()){nextIndex++;try{makeActiveByIndex(nextIndex,false)}catch(e){}}}function openGroup1(e){currSetIDX=getActiveLayerIndex();if(isLayerSet(currSetIDX)){getNamesPlusIDsOfLayerSet()}makeActiveByIndex(currSetIDX,false)}function openGroup1byIDX(e){if(isLayerSet(e)){getNamesPlusIDsOfLayerSet()}makeActiveByIndex(e,false)}function pasteLayerStyle(){var e=charIDToTypeID("PaFX");var r=new ActionDescriptor;var t=stringIDToTypeID("allowPasteFXOnLayerSet");r.putBoolean(t,true);executeAction(e,r,DialogModes.NO)}function recreateVectorMask(){var e=charIDToTypeID("slct");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Path");a.putName(n,"mbTemp_path");r.putReference(t,a);executeAction(e,r,DialogModes.NO);var c=charIDToTypeID("Mk  ");var o=new ActionDescriptor;var t=charIDToTypeID("null");var i=new ActionReference;var n=charIDToTypeID("Path");i.putClass(n);o.putReference(t,i);var D=charIDToTypeID("At  ");var I=new ActionReference;var n=charIDToTypeID("Path");var n=charIDToTypeID("Path");var T=stringIDToTypeID("vectorMask");I.putEnumerated(n,n,T);o.putReference(D,I);var p=charIDToTypeID("Usng");var u=new ActionReference;var n=charIDToTypeID("Path");var s=charIDToTypeID("Ordn");var y=charIDToTypeID("Trgt");u.putEnumerated(n,s,y);o.putReference(p,u);executeAction(c,o,DialogModes.NO);var l=new ActionDescriptor;var v=new ActionReference;v.putName(charIDToTypeID("Path"),"mbTemp_path");l.putReference(charIDToTypeID("null"),v);executeAction(charIDToTypeID("Dlt "),l,DialogModes.NO)}function removeFromSel(e){var r=new ActionDescriptor;var t=new ActionReference;t.putIndex(charIDToTypeID("Lyr "),e);r.putReference(charIDToTypeID("null"),t);r.putEnumerated(stringIDToTypeID("selectionModifier"),stringIDToTypeID("selectionModifierType"),stringIDToTypeID("removeFromSelection"));var a=charIDToTypeID("MkVs");r.putBoolean(a,false);executeAction(charIDToTypeID("slct"),r,DialogModes.NO)}function selectLayerMask(){var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));e.putReference(cTID("null"),r);e.putBoolean(cTID("MkVs"),false);try{executeAction(cTID("slct"),e,DialogModes.NO)}catch(e){}}function selectOnlySibilings(){theSibilings=getSibilings1();try{makeActiveByIndex(theSibilings,false)}catch(e){}}function selectParent(){try{app.activeDocument.activeLayer=app.activeDocument.activeLayer.parent}catch(e){}}function setBackTheLayerMask(){var e=charIDToTypeID("Mk  ");var r=new ActionDescriptor;var t=charIDToTypeID("Nw  ");var a=charIDToTypeID("Chnl");r.putClass(t,a);var n=charIDToTypeID("At  ");var c=new ActionReference;var a=charIDToTypeID("Chnl");var a=charIDToTypeID("Chnl");var o=charIDToTypeID("Msk ");c.putEnumerated(a,a,o);r.putReference(n,c);var i=charIDToTypeID("Usng");var D=charIDToTypeID("UsrM");var I=charIDToTypeID("RvlA");r.putEnumerated(i,D,I);executeAction(e,r,DialogModes.NO);var T=cTID("slct");var p=new ActionDescriptor;var u=cTID("null");var s=new ActionReference;var a=cTID("Chnl");s.putName(a,"mbTemp_alpha");p.putReference(u,s);executeAction(T,p,DialogModes.NO);var y=cTID("setd");var l=new ActionDescriptor;var u=cTID("null");var v=new ActionReference;var a=cTID("Chnl");var f=cTID("fsel");v.putProperty(a,f);l.putReference(u,v);var h=cTID("T   ");var g=cTID("Ordn");var d=cTID("Al  ");l.putEnumerated(h,g,d);executeAction(y,l,DialogModes.NO);var A=cTID("copy");executeAction(A,undefined,DialogModes.NO);selectLayerMask();var m=new ActionDescriptor;var x=new ActionReference;x.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("Msk "));m.putReference(cTID("null"),x);m.putBoolean(cTID("MkVs"),true);executeAction(cTID("slct"),m,DialogModes.NO);var L=charIDToTypeID("PstI");var S=new ActionDescriptor;var w=charIDToTypeID("AntA");var R=charIDToTypeID("Annt");var k=charIDToTypeID("Anno");S.putEnumerated(w,R,k);executeAction(L,S,DialogModes.NO);var O=new ActionDescriptor;var b=new ActionReference;b.putEnumerated(cTID("Chnl"),cTID("Chnl"),cTID("RGB "));O.putReference(cTID("null"),b);O.putBoolean(cTID("MkVs"),false);executeAction(cTID("slct"),O,DialogModes.NO);var y=charIDToTypeID("setd");var M=new ActionDescriptor;var u=charIDToTypeID("null");var E=new ActionReference;var a=charIDToTypeID("Chnl");var f=charIDToTypeID("fsel");E.putProperty(a,f);M.putReference(u,E);var h=charIDToTypeID("T   ");var g=charIDToTypeID("Ordn");var N=charIDToTypeID("None");M.putEnumerated(h,g,N);executeAction(y,M,DialogModes.NO);var m=new ActionDescriptor;var x=new ActionReference;x.putName(charIDToTypeID("Chnl"),"mbTemp_alpha");m.putReference(charIDToTypeID("null"),x);executeAction(charIDToTypeID("Dlt "),m,DialogModes.NO)}function setColorTo(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("Clr ");var T=charIDToTypeID("Clr ");var p=charIDToTypeID(e);I.putEnumerated(T,T,p);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setMaskDensityTo(e){var r=new ActionDescriptor;var t=new ActionDescriptor;var a=new ActionReference;a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"));r.putReference(c2t("null"),a);t.putUnitDouble(s2t("userMaskDensity"),s2t("percentUnit"),e);r.putObject(s2t("to"),s2t("layer"),t);executeAction(s2t("set"),r,DialogModes.NO)}function setMaskEnabled(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("UsrM");I.putBoolean(T,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setMaskFeatherTo(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=stringIDToTypeID("userMaskFeather");var p=charIDToTypeID("#Prc");I.putUnitDouble(T,p,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setMaskLinked(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("Usrs");I.putBoolean(T,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setVectorMaskDensityTo(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=stringIDToTypeID("vectorMaskDensity");var p=charIDToTypeID("#Prc");I.putUnitDouble(T,p,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setVectorMaskEnabled(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("vectorMaskEnabled");I.putBoolean(T,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setVectorMaskFeatherTo(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=stringIDToTypeID("vectorMaskFeather");var p=charIDToTypeID("#Prc");I.putUnitDouble(T,p,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function setVectorMaskLinked(e){var r=charIDToTypeID("setd");var t=new ActionDescriptor;var a=charIDToTypeID("null");var n=new ActionReference;var c=charIDToTypeID("Lyr ");var o=charIDToTypeID("Ordn");var i=charIDToTypeID("Trgt");n.putEnumerated(c,o,i);t.putReference(a,n);var D=charIDToTypeID("T   ");var I=new ActionDescriptor;var T=charIDToTypeID("vectorMaskLinked");I.putBoolean(T,e);var c=charIDToTypeID("Lyr ");t.putObject(D,c,I);executeAction(r,t,DialogModes.NO)}function showOnlyThis(){selectionIDX=getSelectedLayersIdx();setBack=false;var e=0;for(i=0;i<selectionIDX.length;i++){theParents=loopParentsIDXfor(selectionIDX[i]);for(par in theParents){if(!isVisibleIDX(theParents[par])){e++;selectionIDX.push(theParents[par])}}}if(selectionIDX.length>1){var r=charIDToTypeID("Shw ");var t=new ActionDescriptor;var n=charIDToTypeID("null");var c=new ActionList;var o=new ActionReference;var D=charIDToTypeID("Lyr ");var I=charIDToTypeID("Ordn");var T=charIDToTypeID("Trgt");o.putEnumerated(D,I,T);c.putReference(o);t.putList(n,c);var p=charIDToTypeID("TglO");t.putBoolean(p,true);executeAction(r,t,DialogModes.NO);if(setBack==false){for(i=0;i<selectionIDX.length;i++){makeVisByIndex(selectionIDX[i],true)}}else{for(a=0;a<selectionIDX.length;a++){}}}else{var r=charIDToTypeID("Shw ");var t=new ActionDescriptor;var n=charIDToTypeID("null");var c=new ActionList;var o=new ActionReference;var D=charIDToTypeID("Lyr ");var I=charIDToTypeID("Ordn");var T=charIDToTypeID("Trgt");o.putEnumerated(D,I,T);c.putReference(o);t.putList(n,c);var p=charIDToTypeID("TglO");t.putBoolean(p,true);executeAction(r,t,DialogModes.NO)}}function testSelectMultiple(e){makeActiveByIndex([e[0],e[1]],false);var r=new ActionReference;r.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var t=executeActionGet(r);if(t.hasKey(stringIDToTypeID("targetLayers"))){alert("targetLayers")}alert("startSelMult");var a=new ActionDescriptor;var n=new ActionReference;n.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt"));var c=new ActionList;executeAction(charIDToTypeID("setd"),a,DialogModes.NO);alert("endSelMult")}function toogleOpenCloseSet(){app.activeDocument.suspendHistory("toogleOpenCloseSet","toogleOpenCloseSet_inner()")}function toogleOpenCloseSet_inner(){myALayerIDX=getActiveLayerIndex();myGroupP=app.activeDocument.activeLayer;if(!isLayerSet(myALayerIDX)){myGroupP=app.activeDocument.activeLayer.parent;try{app.activeDocument.activeLayer=myGroupP}catch(e){return}if(getNbOfChilds()>1){if(myGroupP.typename!="Document"){if(isSetOpened1(myGroupP)){closeGroup(myGroupP)}else{openGroup1(myGroupP)}}}}else{if(getNbOfChilds()>1){if(isSetOpened1(myGroupP)){closeGroup(myGroupP)}else{openGroup1(myGroupP)}}}}function toogleOpenCloseSet_byIDX(e){try{toogleOpenCloseSet_byIDX_inner(e)}catch(e){alert("toogleOpenCloseSet_byIDX: "+e)}}function toogleOpenCloseSet_byIDX_inner(e){try{gotoLayer(e);myALayerIDX=getActiveLayerIndex();myGroupP=app.activeDocument.activeLayer;if(!isLayerSet(myALayerIDX)){myGroupP=app.activeDocument.activeLayer.parent;try{app.activeDocument.activeLayer=myGroupP}catch(e){return}if(getNbOfChilds()>1){if(myGroupP.typename!="Document"){if(isSetOpened1(myGroupP)){closeGroup(myGroupP)}else{openGroup1(myGroupP)}}}}else{if(getNbOfChilds()>1){if(isSetOpened1(myGroupP)){closeGroup(myGroupP)}else{openGroup1(myGroupP)}}}}catch(e){alert("toogleOpenCloseSet_byIDX_inner: "+e)}}function toogleOpenCloseSet_byIDX_byArray(e){for(var r=0;r<e.length;r++){toogleOpenCloseSet_byIDX(e[r])}}function toogleVisibility(e){try{var r=new ActionDescriptor;var t=new ActionList;var a=new ActionReference;if(getVisible(e)){if(typeof e=="number"){a.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){a.putName(s2t("layer"),e)}else{a.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}t.putReference(a);r.putList(c2t("null"),t);executeAction(s2t("hide"),r,DialogModes.NO)}else{if(typeof e=="number"){a.putIndex(s2t("layer"),e)}else if(typeof e=="string"){if(layer_checkExistence(e)){a.putName(s2t("layer"),e)}else{a.putIndex(s2t("layer"),layer_getIDXbyString(e)[0])}}else if(typeof e==="undefined"){a.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"))}t.putReference(a);r.putList(c2t("null"),t);executeAction(s2t("show"),r,DialogModes.NO)}}catch(e){alert("Error by toogleVisibility: "+e)}}function ungroup(){var e=new ActionDescriptor;var r=new ActionReference;r.putEnumerated(cTID("Lyr "),cTID("Ordn"),cTID("Trgt"));e.putReference(cTID("null"),r);try{executeAction(sTID("ungroupLayersEvent"),e,DialogModes.NO)}catch(e){}}function unlock(){var e=charIDToTypeID("setd");var r=new ActionDescriptor;var t=charIDToTypeID("null");var a=new ActionReference;var n=charIDToTypeID("Lyr ");var c=charIDToTypeID("Ordn");var o=charIDToTypeID("Trgt");a.putEnumerated(n,c,o);r.putReference(t,a);var i=charIDToTypeID("T   ");var D=new ActionDescriptor;var I=stringIDToTypeID("layerLocking");var T=new ActionDescriptor;var p=stringIDToTypeID("protectNone");T.putBoolean(p,true);var I=stringIDToTypeID("layerLocking");D.putObject(I,I,T);var n=charIDToTypeID("Lyr ");r.putObject(i,n,D);executeAction(e,r,DialogModes.NO)}