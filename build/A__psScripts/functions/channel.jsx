function bildberechnung(e,n,a,r){var t=new ActionDescriptor,c=new ActionDescriptor,l=new ActionReference;l.putName(s2t("channel"),e),c.putReference(s2t("to"),l),c.putBoolean(s2t("invert"),a),c.putEnumerated(s2t("calculation"),s2t("calculationType"),s2t(n)),c.putBoolean(s2t("preserveTransparency"),r),t.putObject(s2t("with"),s2t("calculation"),c);try{executeAction(s2t("applyImageEvent"),t,DialogModes.NO)}catch(e){}}function channel2image(e,n){layer_create(n+" ("+e+")",100,!1,"normal"),bildberechnung(e,"normal",f,f)}function channel2mask(e,n){for(var a=1;layer_checkExistence(layer_getIDXbyString(n+" "+a)[0]);)a++;createGroup(n+" "+a,"passThrough","none",100,f),createMask(),channel_select(e,!1),select_all(),copy(),channel_select("mask",!0),paste_into(),channel_select("RGB",!1),selection_deselect()}function channel2selection(e){var n=new ActionDescriptor,a=new ActionReference,r=new ActionReference;a.putProperty(s2t("channel"),s2t("selection")),n.putReference(s2t("null"),a),r.putName(s2t("channel"),e),n.putReference(s2t("to"),r),executeAction(s2t("set"),n,DialogModes.NO)}function channel_checkExistenceByName(e){for(var n=app.activeDocument.channels,a=!1,r=0;r<n.length;r++){var t=n[r];if(t.name==e&&t.kind==ChannelType.MASKEDAREA){a=!0;break}}return a}function channel_delete(e){var n=new ActionDescriptor,a=new ActionReference;a.putName(s2t("channel"),e),n.putReference(s2t("null"),a);try{executeAction(s2t("delete"),n,DialogModes.NO)}catch(e){return}try{channel_delete(e)}catch(e){return}}function channel_name(e){var n=new ActionDescriptor,a=new ActionDescriptor,r=new ActionReference;r.putEnumerated(s2t("channel"),s2t("ordinal"),s2t("targetEnum")),n.putReference(s2t("null"),r),a.putString(s2t("name"),e),n.putObject(s2t("to"),s2t("channel"),a),executeAction(s2t("set"),n,DialogModes.NO)}function channel_select(e,n){var a=new ActionDescriptor,r=new ActionReference;e&&("red"==e||"grain"==e||"blue"==e||"RGB"==e||"mask"==e||"cyan"==e||"magenta"==e||"yellow"==e||"black"==e||"CMYK"==e||"lightness"==e||"a"==e||"b"==e||"lab"==e?r.putEnumerated(s2t("channel"),s2t("channel"),s2t(e)):r.putName(s2t("channel"),e),a.putReference(s2t("null"),r),a.putBoolean(s2t("makeVisible"),n),executeAction(s2t("select"),a,DialogModes.NO))}function channel_setSaturation(e,n){var a="difference";kanalberechnung("red",f,"grain",f,e,a,"rg","RGB"),kanalberechnung("red",f,"blue",f,e,a,"rb","RGB"),kanalberechnung("rg",f,"rb",f,"this",n,"R","RGB"),channel_delete("rg"),channel_delete("rb"),kanalberechnung("grain",f,"red",f,e,a,"gr","RGB"),kanalberechnung("grain",f,"blue",f,e,a,"gb","RGB"),kanalberechnung("gr",f,"gb",f,"this",n,"G","RGB"),channel_delete("gr"),channel_delete("gb"),kanalberechnung("blue",f,"red",f,e,a,"br","RGB"),kanalberechnung("blue",f,"grain",f,e,a,"bg","RGB"),kanalberechnung("br",f,"bg",f,"this",n,"B","RGB"),channel_delete("br"),channel_delete("bg"),kanalberechnung("R",f,"G",f,"this",n,"RG","RGB"),kanalberechnung("RG",f,"B",f,"this",n,"saturation","RGB"),channel_delete("R"),channel_delete("G"),channel_delete("B"),channel_delete("RG")}function channel_setSaturation_singleColors(e,n){var a="subtract";kanalberechnung("red",t,"grain",t,e,a,"rg","RGB"),kanalberechnung("red",t,"blue",t,e,a,"rb","RGB"),kanalberechnung("grain",t,"red",t,e,a,"gr","RGB"),kanalberechnung("grain",t,"blue",t,e,a,"gb","RGB"),kanalberechnung("blue",t,"red",t,e,a,"br","RGB"),kanalberechnung("blue",t,"grain",t,e,a,"bg","RGB"),kanalberechnung("rg",f,"rb",f,"this",n,"R","RGB"),kanalberechnung("br",f,"bg",f,"this",n,"B","RGB"),kanalberechnung("gb",f,"gr",f,"this",n,"G","RGB"),kanalberechnung("gb",f,"gr",f,"this",a,"C","RGB"),kanalberechnung("br",f,"bg",f,"this",a,"M","RGB"),kanalberechnung("rg",f,"rb",f,"this",a,"Y","RGB"),kanalberechnung("R",f,"Y",f,"this",n,"RY_temp","RGB"),kanalberechnung("RY_temp",f,"RY_temp",f,"this","colorDodge","RY","RGB"),channel_delete("RY_temp"),kanalberechnung("Y",f,"G",f,"this",n,"YG_temp","RGB"),kanalberechnung("YG_temp",f,"YG_temp",f,"this","colorDodge","YG","RGB"),channel_delete("YG_temp"),kanalberechnung("G",f,"C",f,"this",n,"GC_temp","RGB"),kanalberechnung("GC_temp",f,"GC_temp",f,"this","colorDodge","GC","RGB"),channel_delete("GC_temp"),kanalberechnung("C",f,"B",f,"this",n,"CB_temp","RGB"),kanalberechnung("CB_temp",f,"CB_temp",f,"this","colorDodge","CB","RGB"),channel_delete("CB_temp"),kanalberechnung("B",f,"M",f,"this",n,"BM_temp","RGB"),kanalberechnung("BM_temp",f,"BM_temp",f,"this","colorDodge","BM","RGB"),channel_delete("BM_temp"),kanalberechnung("R",f,"M",f,"this",n,"RM_temp","RGB"),kanalberechnung("RM_temp",f,"RM_temp",f,"this","colorDodge","RM","RGB"),channel_delete("RM_temp")}function channel_setSaturation_singleColors_v2(_source,__foldername){if(!layer_checkExistence(_source))with(layer_count()>1?layer_mergeVisible(!0):(selectLayers("selectAllLayers"),layer_copyLayers()),nameLayer(_source),activeDocument)activeLayer.move(layers[0],ElementPlacement.PLACEBEFORE);function quick_farbfelder(e,n,a,r){selection_deselect(),gotoFill(),channel2selection(e),createColorLayer(e,"multiply","none",100,"xx",n,a,r),gotoFill()}function check_enger(e,n,a){kanalberechnung(e,f,a,f,"merged","subtract",a+"-","RGB"),kanalberechnung(n,f,a,f,"merged","subtract","-"+a,"RGB"),channel_delete(a),kanalberechnung(a+"-",f,"-"+a,f,"merged","darken",a,"RGB"),channel_delete(a+"-"),channel_delete("-"+a)}function adjustLayer_sat(__source,_hue){var startID=layer_selectedID_get();with(layer_duplicateLayer(__source,__source+" temp"),layer_sat_set(!1,_hue,0,0),activeDocument)activeLayer.move(layers[0],ElementPlacement.PLACEBEFORE);layer_selectedID_set(startID)}function layer_sat_set(e,n,a,r){var t=new ActionDescriptor,c=new ActionDescriptor,l=new ActionList;t.putEnumerated(s2t("presetKind"),s2t("presetKindType"),s2t("presetKindCustom")),t.putBoolean(s2t("colorize"),e),c.putInteger(s2t("hue"),n),c.putInteger(s2t("saturation"),a),c.putInteger(s2t("lightness"),r),l.putObject(s2t("hueSatAdjustmentV2"),c),t.putList(s2t("adjustment"),l),executeAction(s2t("hueSaturation"),t,DialogModes.NO)}function layer_duplicateLayer(e,n){var a=new ActionDescriptor,r=new ActionReference;if("number"==typeof e)r.putIndex(s2t("layer"),e);else if("string"==typeof e)if(layer_checkExistence(e))r.putName(s2t("layer"),e);else{var t=layer_getIDXbyString(e);r.putIndex(s2t("layer"),t[0])}else r.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("targetEnum"));a.putReference(s2t("null"),r),a.putString(s2t("name"),n),executeAction(s2t("duplicate"),a,DialogModes.NO)}function layer_count(){function e(e){var n=new ActionReference;return n.putProperty(charIDToTypeID("Prpr"),stringIDToTypeID("layerSection")),n.putIndex(charIDToTypeID("Lyr "),e),typeIDToStringID(executeActionGet(n).getEnumerationValue(stringIDToTypeID("layerSection")))}var n,a=((n=new ActionReference).putProperty(charIDToTypeID("Prpr"),charIDToTypeID("NmbL")),n.putEnumerated(charIDToTypeID("Dcmn"),charIDToTypeID("Ordn"),charIDToTypeID("Trgt")),executeActionGet(n).getInteger(charIDToTypeID("NmbL"))),r=a;if(activeDocument.layers[activeDocument.layers.length-1].isBackgroundLayer){var t=0;r++}else t=1;for(;t<a;t++){"layerSectionEnd"==e(t)&&r--}return r}kanalberechnung("red",f,"grain",f,_source,"subtract","RG","RGB"),kanalberechnung("red",f,"blue",f,_source,"subtract","RB","RGB"),kanalberechnung("grain",f,"red",f,_source,"subtract","GR","RGB"),kanalberechnung("grain",f,"blue",f,_source,"subtract","GB","RGB"),kanalberechnung("blue",f,"red",f,_source,"subtract","BR","RGB"),kanalberechnung("blue",f,"grain",f,_source,"subtract","BG","RGB"),kanalberechnung("GR",f,"BR",f,_source,"darken","0","RGB"),check_enger("GB","BG","0"),kanalberechnung("BR",f,"BG",f,_source,"darken","60","RGB"),check_enger("RG","GR","60"),kanalberechnung("RG",f,"BG",f,_source,"darken","120","RGB"),check_enger("RB","BR","120"),kanalberechnung("RG",f,"RB",f,_source,"darken","180","RGB"),check_enger("GB","BG","180"),kanalberechnung("RB",f,"GB",f,_source,"darken","240","RGB"),check_enger("RG","GR","240"),kanalberechnung("GR",f,"GB",f,_source,"darken","300","RGB"),check_enger("BR","RB","300"),channel_delete("RG"),channel_delete("RB"),channel_delete("GR"),channel_delete("GB"),channel_delete("BR"),channel_delete("BG"),adjustLayer_sat(_source,-15),kanalberechnung("red",f,"grain",f,_source+" temp","subtract","RG","RGB"),kanalberechnung("red",f,"blue",f,_source+" temp","subtract","RB","RGB"),kanalberechnung("grain",f,"red",f,_source+" temp","subtract","GR","RGB"),kanalberechnung("grain",f,"blue",f,_source+" temp","subtract","GB","RGB"),kanalberechnung("blue",f,"red",f,_source+" temp","subtract","BR","RGB"),kanalberechnung("blue",f,"grain",f,_source+" temp","subtract","BG","RGB"),kanalberechnung("GR",f,"BR",f,_source+" temp","darken","15","RGB"),check_enger("GB","BG","15"),kanalberechnung("BR",f,"BG",f,_source+" temp","darken","75","RGB"),check_enger("RG","GR","75"),kanalberechnung("RG",f,"BG",f,_source+" temp","darken","135","RGB"),check_enger("RB","BR","135"),kanalberechnung("RG",f,"RB",f,_source+" temp","darken","195","RGB"),check_enger("GB","BG","195"),kanalberechnung("RB",f,"GB",f,_source+" temp","darken","255","RGB"),check_enger("RG","GR","255"),kanalberechnung("GR",f,"GB",f,_source+" temp","darken","315","RGB"),check_enger("BR","RB","315"),layer_delete(_source+" temp"),channel_delete("RG"),channel_delete("RB"),channel_delete("GR"),channel_delete("GB"),channel_delete("BR"),channel_delete("BG"),adjustLayer_sat(_source,-30),kanalberechnung("red",f,"grain",f,_source+" temp","subtract","RG","RGB"),kanalberechnung("red",f,"blue",f,_source+" temp","subtract","RB","RGB"),kanalberechnung("grain",f,"red",f,_source+" temp","subtract","GR","RGB"),kanalberechnung("grain",f,"blue",f,_source+" temp","subtract","GB","RGB"),kanalberechnung("blue",f,"red",f,_source+" temp","subtract","BR","RGB"),kanalberechnung("blue",f,"grain",f,_source+" temp","subtract","BG","RGB"),kanalberechnung("GR",f,"BR",f,_source+" temp","darken","30","RGB"),check_enger("GB","BG","30"),kanalberechnung("BR",f,"BG",f,_source+" temp","darken","90","RGB"),check_enger("RG","GR","90"),kanalberechnung("RG",f,"BG",f,_source+" temp","darken","150","RGB"),check_enger("RB","BR","150"),kanalberechnung("RG",f,"RB",f,_source+" temp","darken","210","RGB"),check_enger("GB","BG","210"),kanalberechnung("RB",f,"GB",f,_source+" temp","darken","270","RGB"),check_enger("RG","GR","270"),kanalberechnung("GR",f,"GB",f,_source+" temp","darken","330","RGB"),check_enger("BR","RB","330"),layer_delete(_source+" temp"),channel_delete("RG"),channel_delete("RB"),channel_delete("GR"),channel_delete("GB"),channel_delete("BR"),channel_delete("BG"),adjustLayer_sat(_source,-45),kanalberechnung("red",f,"grain",f,_source+" temp","subtract","RG","RGB"),kanalberechnung("red",f,"blue",f,_source+" temp","subtract","RB","RGB"),kanalberechnung("grain",f,"red",f,_source+" temp","subtract","GR","RGB"),kanalberechnung("grain",f,"blue",f,_source+" temp","subtract","GB","RGB"),kanalberechnung("blue",f,"red",f,_source+" temp","subtract","BR","RGB"),kanalberechnung("blue",f,"grain",f,_source+" temp","subtract","BG","RGB"),kanalberechnung("GR",f,"BR",f,_source+" temp","darken","45","RGB"),check_enger("GB","BG","45"),kanalberechnung("BR",f,"BG",f,_source+" temp","darken","105","RGB"),check_enger("RG","GR","105"),kanalberechnung("RG",f,"BG",f,_source+" temp","darken","165","RGB"),check_enger("RB","BR","165"),kanalberechnung("RG",f,"RB",f,_source+" temp","darken","225","RGB"),check_enger("GB","BG","225"),kanalberechnung("RB",f,"GB",f,_source+" temp","darken","285","RGB"),check_enger("RG","GR","285"),kanalberechnung("GR",f,"GB",f,_source+" temp","darken","345","RGB"),check_enger("BR","RB","345"),layer_delete(_source+" temp"),layer_delete("helper_mergeVisibleLayer"),channel_delete("RG"),channel_delete("RB"),channel_delete("GR"),channel_delete("GB"),channel_delete("BR"),channel_delete("BG"),createGroup(__foldername,"passThrough","none",100,f),createColorLayer("Weiss","normal","none",100,"none",255,255,255),quick_farbfelder("345",255,0,63),quick_farbfelder("330",255,0,127),quick_farbfelder("315",255,0,191),quick_farbfelder("300",255,0,255),quick_farbfelder("285",191,0,255),quick_farbfelder("270",127,0,255),quick_farbfelder("255",63,0,255),quick_farbfelder("240",0,0,255),quick_farbfelder("225",0,63,255),quick_farbfelder("210",0,127,255),quick_farbfelder("195",0,191,255),quick_farbfelder("180",0,255,255),quick_farbfelder("165",0,255,191),quick_farbfelder("150",0,255,127),quick_farbfelder("135",0,255,63),quick_farbfelder("120",0,255,0),quick_farbfelder("105",63,255,0),quick_farbfelder("90",127,255,0),quick_farbfelder("75",191,255,0),quick_farbfelder("60",255,255,0),quick_farbfelder("45",255,191,0),quick_farbfelder("30",255,127,0),quick_farbfelder("15",255,63,0),quick_farbfelder("0",255,0,0),channel_delete("345"),channel_delete("330"),channel_delete("315"),channel_delete("300"),channel_delete("285"),channel_delete("270"),channel_delete("255"),channel_delete("240"),channel_delete("225"),channel_delete("210"),channel_delete("195"),channel_delete("180"),channel_delete("165"),channel_delete("150"),channel_delete("135"),channel_delete("120"),channel_delete("105"),channel_delete("90"),channel_delete("75"),channel_delete("60"),channel_delete("45"),channel_delete("30"),channel_delete("15"),channel_delete("0"),channel_delete("RG"),channel_delete("RB"),channel_delete("GR"),channel_delete("GB"),channel_delete("BR"),channel_delete("BG"),createLayer("Maske Preview","colorLookup","normal","none",100,"none",f,f),LUT_maske_preview(),createLayer("Maske Gradation","curves","normal","none",100,"none",f,f)}function kanalberechnung(e,n,a,r,t,c,l,o){var u=new ActionDescriptor,s=new ActionDescriptor,_=(new ActionDescriptor,new ActionReference),h=new ActionReference;new ActionReference;u.putClass(s2t("new"),s2t("channel")),"red"==e||"grain"==e||"blue"==e||"gray"==e?_.putEnumerated(s2t("channel"),s2t("channel"),s2t(e)):_.putName(s2t("channel"),e),"merged"==t?_.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("merged")):"this"!=t&&_.putName(s2t("layer"),t),s.putReference(s2t("to"),_),s.putBoolean(s2t("invert"),n),s.putEnumerated(s2t("calculation"),s2t("calculationType"),s2t(c)),"red"==a||"grain"==a||"blue"==a||"gray"==a?h.putEnumerated(s2t("channel"),s2t("channel"),s2t(a)):h.putName(s2t("channel"),a),"merged"==t?h.putEnumerated(s2t("layer"),s2t("ordinal"),s2t("merged")):"this"!=t&&h.putName(s2t("layer"),t),s.putReference(s2t("source2"),h),s.putBoolean(s2t("invertSource2"),r),u.putObject(s2t("using"),s2t("calculation"),s),executeAction(s2t("make"),u,DialogModes.NO),channel_name(l),channel_select(o,!1)}function mask_farbmaske_viaSaturation(_folder,_toleranz){with(createGroup(_folder,"passThrough","none",100,f),activeDocument)activeLayer.move(layers[0],ElementPlacement.PLACEBEFORE);createLayer("Sattigung","hueSaturation","normal","none",100,"none",f,f),createLayer("Farbe maskieren","hueSaturation","difference","none",100,"none",f,f),createLayer("invert + gradation","curves","normal","none",100,"none",f,f),adjustLayer_curves_set(0,255,255,0),createLayer("Maske Preview","colorLookup","normal","none",100,"none",f,f),LUT_maske_preview(),gotoLayer("Farbe maskieren");var color1=app_getColor("hsb","vordergrund"),color2=app_getColor("hsb","hintergrund");if(0!=color1[1]&&0!=color1[2]||0==color2[1]||0==color2[2]){if(0==color1[1]||0==color1[2])var color1=[0,100,100]}else var color1=color2;if(0==color2[1]||0==color2[2])var color2=color1;var colors=[color1,color2];colors.sort((function(e,n){return e[0]-n[0]}));var color1=colors[0],color2=colors[1];adjustLayer_sat_set(1,adjustHue(color1[0],-_toleranz),color1[0],color2[0],adjustHue(color2[0],_toleranz),f,f,100)}function mask_setSaturation_singleColors(e){function n(e,n,a,r){selection_deselect(),gotoFill(),channel2selection(e),createColorLayer(e,"multiply","none",100,"xx",n,a,r),gotoFill()}channel_setSaturation_singleColors("merged","darken"),createGroup(e,"passThrough","none",100,f),createColorLayer("Weiss","normal","none",100,"none",255,255,255),n("RM",255,0,127),n("M",255,0,255),n("BM",127,0,255),n("B",0,0,255),n("CB",0,127,255),n("C",0,255,255),n("GC",0,255,127),n("G",0,255,0),n("YG",127,255,0),n("Y",255,255,0),n("RY",255,127,0),n("R",255,0,0),createLayer("Maske Preview","colorLookup","normal","none",100,"none",f,f),LUT_maske_preview(),createLayer("Maske Gradation","curves","normal","none",100,"none",f,f),channel_delete("rg"),channel_delete("rb"),channel_delete("gr"),channel_delete("gb"),channel_delete("br"),channel_delete("bg"),channel_delete("R"),channel_delete("G"),channel_delete("B"),channel_delete("C"),channel_delete("M"),channel_delete("Y"),channel_delete("RY"),channel_delete("YG"),channel_delete("GC"),channel_delete("CB"),channel_delete("BM"),channel_delete("RM")}function mask_setSaturation_singleColors_create(_foldername,_version){if(layer_checkExistence(_foldername))makeVisible("Maske Preview"),select_luminance(),layer_delete(_foldername),layer_selectedID_set(getMeta_2("startID")),delMeta_2("startID");else if(setMeta_2("startID",layer_selectedID_get()),"v1"==_version?selection_loop((function(){mask_setSaturation_singleColors(_foldername)})):"v3"==_version?selection_loop((function(){mask_farbmaske_viaSaturation(_foldername,30)})):"v2"==_version&&selection_loop((function(){channel_setSaturation_singleColors_v2("helper_mergeVisibleLayer",_foldername)})),"v3"!=_version){with(gotoLayer(_foldername),activeDocument)activeLayer.move(layers[0],ElementPlacement.PLACEBEFORE);gotoLayer("Maske Gradation")}}function RemoveAlphaChannels(){for(var e=doc.channels,n=[],a=0;a<e.length;a++){(r=e[a]).kind!=ChannelType.COMPONENT&&n.push(r)}for(;n.length;){var r;(r=n.pop()).remove()}}